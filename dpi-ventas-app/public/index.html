<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPI Publicidad - Sistema de Ventas Profesional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0FA795; 
            --secondary-color: #8BC34A; 
            --danger-color: #dc3545;
            --warning-color: #ffc107; 
            --info-color: #17a2b8; 
            --success-color: #28a745;
            --dark-color: #2c3e50; 
            --light-color: #ffffff; 
            --white-color: #ffffff;
            --bg-color: #f4f7f6; 
            --border-color: #e3e8ee;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            min-height: 100vh; 
            padding: 10px; 
            font-size: 15px; 
            color: var(--dark-color); 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            transition: filter 0.3s ease; 
        }
        .header { 
            text-align: center; 
            color: var(--dark-color); 
            margin-bottom: 20px; 
        }
        .header h1 { 
            font-size: 2em; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        .header p { 
            font-size: 1em; 
            color: #7f8c8d; 
        }
        .header .status { 
            background-color: rgba(0,0,0,0.05); 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-size: 0.85em; 
            margin-top: 10px; 
            display: inline-block; 
            transition: all 0.3s ease; 
            border: 1px solid var(--border-color); 
        }
        .header .status.online { 
            background-color: var(--success-color); 
            color: white; 
            border-color: var(--success-color); 
        }
        .header .status.offline { 
            background-color: var(--danger-color); 
            color: white; 
            border-color: var(--danger-color); 
        }
        .mode-switcher-wrapper { 
            text-align: center; 
            margin-bottom: 20px; 
        }
        .mode-switcher { 
            background: #e0e5ec; 
            border-radius: 30px; 
            display: inline-flex; 
            padding: 4px; 
            box-shadow: inset 3px 3px 6px #caced4, inset -3px -3px 6px #f8f9fa; 
        }
        .mode-btn { 
            background: transparent; 
            color: #555; 
            border: none; 
            padding: 8px 20px; 
            border-radius: 25px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-size: 0.9em;
        }
        .mode-btn.active { 
            background: var(--primary-color); 
            color: white; 
            box-shadow: 0 4px 15px rgba(15, 167, 149, 0.3); 
        }
        .panel { 
            background: var(--light-color); 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06); 
            margin-bottom: 20px; 
        }
        .panel h2 { 
            font-size: 1.3em; 
            font-weight: 600; 
            margin-bottom: 15px; 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 10px; 
        }
        .loading, .empty-state { 
            text-align: center; 
            padding: 40px 20px; 
            color: #7f8c8d; 
        }
        
        /* üîç B√öSQUEDA MEJORADA PARA M√ìVIL */
        .search-box { 
            position: relative; 
            padding-bottom: 15px; 
            width: 100%;
        }
        .search-input { 
            width: 100%; 
            padding: 12px 15px 12px 40px; 
            border: 2px solid var(--border-color); 
            border-radius: 10px; 
            font-size: 0.95em; 
            max-width: 100%;
            box-sizing: border-box;
        }
        .search-input:focus { 
            outline: none; 
            border-color: var(--primary-color); 
        }
        .search-box::before { 
            content: 'üîç'; 
            position: absolute; 
            left: 15px; 
            top: 12px; 
            color: #aaa; 
            font-size: 1.1em; 
            pointer-events: none; 
        }
        .search-results { 
            position: absolute; 
            top: calc(100% - 5px); 
            left: 0; 
            right: 0; 
            background: var(--light-color); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            max-height: 300px; 
            overflow-y: auto; 
            z-index: 1000; 
            display: none; 
        }
        .search-results.active { 
            display: block; 
        }
        .search-result-item { 
            padding: 10px 12px; 
            border-bottom: 1px solid #f1f3f4; 
            cursor: pointer; 
            font-size: 0.9em;
        }
        .search-result-item:hover {
            background-color: var(--bg-color);
        }
        .search-result-category {
            font-size: 0.75em;
            color: var(--primary-color);
            font-weight: 600;
            text-transform: uppercase;
        }
        mark { 
            background: #fff3cd; 
        }
        
        /* üö¶ SEM√ÅFORO DE CALIFICACI√ìN */
        .semaforo-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .semaforo-light {
            border-radius: 12px;
            padding: 20px;
            color: white;
            font-weight: 600;
            position: relative;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .semaforo-light:hover {
            transform: translateY(-3px);
        }
        
        .semaforo-light:hover .semaforo-icon {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.4);
        }
        
        .semaforo-light.verde {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }
        
        .semaforo-light.amarillo {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.3);
        }
        
        .semaforo-light.rojo {
            background: linear-gradient(135deg, #F44336, #EF5350);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3);
        }
        
        .semaforo-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            margin-bottom: 12px;
            align-self: flex-start;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        
        .semaforo-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .semaforo-description {
            font-style: italic;
            margin-bottom: 15px;
            opacity: 0.95;
            line-height: 1.3;
            font-size: 0.95em;
        }
        
        .semaforo-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .semaforo-list li {
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9em;
        }
        
        .semaforo-list li::before {
            content: '‚úì';
            font-weight: bold;
            font-size: 1em;
        }
        
        .semaforo-light.amarillo .semaforo-list li::before {
            content: '!';
        }
        
        .semaforo-light.rojo .semaforo-list li::before {
            content: '‚Ä¢';
        }
        
        /* üìã PROCESO DE PRE-CALIFICACI√ìN */
        .precalificacion-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
        }
        
        .precalificacion-header p {
            margin-bottom: 12px;
            font-size: 1em;
        }
        
        .proceso-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .proceso-btn:hover {
            background: white;
            color: #667eea;
        }
        
        .proceso-panel {
            border-left: 4px solid var(--primary-color);
        }
        
        .etapas-container {
            display: grid;
            gap: 20px;
        }
        
        .etapa {
            background: var(--bg-color);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .etapa:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .etapa-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .etapa-numero {
            background: var(--primary-color);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .etapa-header h3 {
            flex: 1;
            margin: 0;
            color: var(--dark-color);
            font-size: 1.1em;
        }
        
        .etapa-tiempo {
            background: var(--warning-color);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .etapa-content {
            display: grid;
            gap: 12px;
        }
        
        .objetivo {
            background: rgba(15, 167, 149, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            font-size: 0.9em;
        }
        
        .preguntas-clave {
            background: rgba(255, 193, 7, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--warning-color);
            font-size: 0.9em;
        }
        
        .preguntas-clave ul, .objetivo ul {
            margin: 8px 0 0 16px;
        }
        
        .preguntas-clave li, .objetivo li {
            margin: 4px 0;
            font-style: italic;
            font-size: 0.85em;
        }
        
        .se√±ales-alerta {
            background: rgba(220, 53, 69, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--danger-color);
            font-size: 0.9em;
        }
        
        .alerta {
            display: inline-block;
            background: var(--danger-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75em;
            margin: 2px;
        }
        
        .validacion-presupuesto {
            background: rgba(40, 167, 69, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--success-color);
            font-style: italic;
            font-size: 0.9em;
        }
        
        .usar-script-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            justify-self: start;
            font-size: 0.85em;
        }
        
        .usar-script-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }
        
        .decision-matrix {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .decision-verde, .decision-amarillo, .decision-rojo {
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }
        
        .decision-verde {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid var(--success-color);
        }
        
        .decision-amarillo {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid var(--warning-color);
        }
        
        .decision-rojo {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid var(--danger-color);
        }
        
        .decision-btn {
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 8px;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .decision-btn.verde {
            background: var(--success-color);
            color: white;
        }
        
        .decision-btn.amarillo {
            background: var(--warning-color);
            color: white;
        }
        
        .decision-btn.rojo {
            background: var(--danger-color);
            color: white;
        }
        
        .decision-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .proceso-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .cerrar-proceso-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .tiempo-total {
            font-weight: 600;
            color: var(--info-color);
            font-size: 0.9em;
        }
        
        /* üîç FILTROS DE CLIENTES IDEALES */
        .filtros-cliente {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .filtro-grupo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filtro-grupo label {
            font-weight: 600;
            font-size: 0.85em;
            color: var(--dark-color);
        }
        
        .filtro-grupo select {
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.85em;
            background: white;
        }
        
        .perfil-count {
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        /* üìã CARDS COMPACTAS DE PERFILES */
        .perfil-card-compacta {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .perfil-card-compacta:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }
        
        .perfil-card-compacta.expandida {
            border-color: var(--primary-color);
            box-shadow: 0 6px 20px rgba(15, 167, 149, 0.15);
        }
        
        .perfil-header-compacto {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .perfil-nombre-compacto {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .perfil-tipo-compacto {
            background: var(--warning-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .perfil-resumen {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .perfil-resumen-item {
            font-size: 0.85em;
        }
        
        .perfil-resumen-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 2px;
        }
        
        .perfil-tags-compacto {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .perfil-tag-compacto {
            background: var(--info-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 600;
        }
        
        .perfil-tag-compacto.presupuesto-bajo { background: #6c757d; }
        .perfil-tag-compacto.presupuesto-medio { background: #ffc107; }
        .perfil-tag-compacto.presupuesto-alto { background: #28a745; }
        .perfil-tag-compacto.urgencia-baja { background: #17a2b8; }
        .perfil-tag-compacto.urgencia-media { background: #fd7e14; }
        .perfil-tag-compacto.urgencia-alta { background: #dc3545; }
        
        .perfil-expandir-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
        }
        
        .perfil-expandir-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .perfil-detalles {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .perfil-detalles.visible {
            display: block;
        }
        
        .perfil-detalle-item {
            margin-bottom: 12px;
            font-size: 0.9em;
        }
        
        .perfil-detalle-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 4px;
        }
        
        .perfil-acciones-compacto {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }
        
        .perfil-acciones-compacto button {
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .perfil-editar-btn {
            background: var(--info-color);
            color: white;
        }
        
        .perfil-editar-btn:hover {
            background: #138496;
        }
        
        .perfil-eliminar-btn {
            background: var(--danger-color);
            color: white;
        }
        
        .perfil-eliminar-btn:hover {
            background: #c82333;
        }
        
        /* Responsive para filtros */
        @media (max-width: 768px) {
            .filtros-cliente {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
            }
            
            .perfil-resumen {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .perfil-header-compacto {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .section-header h3 {
            margin: 0;
            font-size: 1.1em;
        }
        
        .agregar-cliente-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }
        
        .agregar-cliente-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }
        
        .section-description {
            background: rgba(255, 193, 7, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.85em;
            border-left: 3px solid var(--warning-color);
        }
        
        .formulario-cliente {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .form-header h4 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1em;
        }
        
        .cerrar-form-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
            font-size: 0.85em;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 8px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.85em;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 70px;
        }
        
        .form-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .guardar-cliente-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .guardar-cliente-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .cancelar-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .clientes-potenciales-lista {
            display: grid;
            gap: 12px;
        }
        
        .cliente-potencial-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .cliente-potencial-card:hover {
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        
        .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .cliente-nombre {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1em;
        }
        
        .cliente-tipo {
            background: var(--warning-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7em;
            font-weight: 600;
        }
        
        .cliente-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .cliente-field {
            font-size: 0.8em;
        }
        
        .cliente-field strong {
            color: var(--primary-color);
        }
        
        .cliente-descripcion {
            background: var(--bg-color);
            padding: 8px;
            border-radius: 5px;
            font-size: 0.85em;
            margin-bottom: 8px;
            font-style: italic;
        }
        
        .cliente-tags {
            display: flex;
            gap: 4px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .cliente-tag {
            background: var(--info-color);
            color: white;
            padding: 1px 5px;
            border-radius: 8px;
            font-size: 0.65em;
            font-weight: 600;
        }
        
        .cliente-tag.presupuesto-bajo { background: #dc3545; }
        .cliente-tag.presupuesto-medio { background: #ffc107; }
        .cliente-tag.presupuesto-alto { background: #28a745; }
        .cliente-tag.urgencia-baja { background: #6c757d; }
        .cliente-tag.urgencia-media { background: #fd7e14; }
        .cliente-tag.urgencia-alta { background: #dc3545; }
        
        .cliente-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
            font-size: 0.75em;
            color: #7f8c8d;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .cliente-actions {
            display: flex;
            gap: 4px;
        }
        
        .editar-cliente-btn, .eliminar-cliente-btn {
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .editar-cliente-btn {
            background: var(--info-color);
            color: white;
        }
        
        .eliminar-cliente-btn {
            background: var(--danger-color);
            color: white;
        }
        
        .cliente-empty {
            text-align: center;
            padding: 30px 15px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        /* TABS MEJORADOS PARA M√ìVIL */
        .tabs { 
            display: flex; 
            border-bottom: 2px solid var(--border-color); 
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .tabs::-webkit-scrollbar {
            display: none;
        }
        .tab { 
            padding: 10px 16px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 0.85em; 
            color: #7f8c8d; 
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: max-content;
        }
        .tab:after { 
            content: ''; 
            position: absolute; 
            bottom: -2px; 
            left: 0; 
            right: 0; 
            height: 3px; 
            background-color: var(--primary-color); 
            transform: scaleX(0); 
            transition: transform 0.3s ease; 
        }
        .tab.active { 
            color: var(--primary-color); 
        }
        .tab.active:after { 
            transform: scaleX(1); 
        }
        .script-card { 
            background: var(--bg-color); 
            border: 1px solid var(--border-color); 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 12px;
            transition: background-color 0.5s ease;
        }
        .script-title { 
            font-weight: 600; 
            font-size: 1em; 
            color: var(--dark-color); 
            display: flex; 
            align-items: center; 
            gap: 8px;
            flex-wrap: wrap;
        }
        .script-text { 
            line-height: 1.5; 
            margin: 12px 0; 
            white-space: pre-line; 
            font-size: 0.9em;
        }
        .script-badge { 
            padding: 3px 8px; 
            border-radius: 10px; 
            font-size: 0.7em; 
            color: var(--white-color); 
        }
        .usage-stats { 
            display: flex; 
            gap: 12px; 
            font-size: 0.75em; 
            color: #7f8c8d; 
            flex-wrap: wrap;
        }
        .script-actions { 
            margin-top: 12px; 
        }
        .copy-btn { 
            background: var(--primary-color); 
            color: var(--white-color); 
            border: none; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: background-color 0.3s ease;
            font-size: 0.85em;
        }
        .copy-btn.copied { 
            background: var(--success-color); 
        }
        .admin-mode { 
            display: none; 
        }
        .stats-bar { 
            display: flex; 
            justify-content: space-around; 
            background: var(--dark-color); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
            gap: 10px;
        }
        .stats-item { 
            text-align: center; 
        }
        .stats-number { 
            font-size: 1.5em; 
            font-weight: 700; 
        }
        .stats-label { 
            font-size: 0.8em; 
            opacity: 0.8; 
        }
        .admin-controls { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 20px; 
        }
        .form-group label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 6px; 
        }
        .form-group select, .form-group input, .form-group textarea { 
            width: 100%; 
            padding: 10px; 
            border: 2px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 0.9em; 
            font-family: 'Inter', sans-serif;
        }
        .form-group textarea { 
            height: 120px; 
            resize: vertical; 
        }
        .admin-btn { 
            padding: 10px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            border: none; 
            transition: all 0.2s ease; 
            margin-right: 8px;
            font-size: 0.9em;
        }
        .admin-btn.success { 
            background-color: var(--success-color); 
            color: white; 
        }
        .admin-btn.danger { 
            background-color: var(--danger-color); 
            color: white; 
        }
        .scripts-list { 
            max-height: 400px; 
            overflow-y: auto; 
        }
        .script-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px; 
            background: var(--bg-color); 
            border-radius: 6px; 
            margin-bottom: 8px; 
        }
        .script-item h4 {
            margin: 0;
            flex: 1;
            font-size: 0.9em;
        }
        .script-item-actions button { 
            color: white; 
            font-size: 0.8em; 
            padding: 6px 12px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-left: 4px; 
        }
        .edit-btn { 
            background: var(--info-color); 
        }
        .delete-btn { 
            background: var(--danger-color); 
        }
        .auth-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(8px); 
            z-index: 9999; 
            display: none; 
            justify-content: center; 
            align-items: center; 
        }
        .auth-overlay.active { 
            display: flex; 
        }
        .auth-modal { 
            background: var(--light-color); 
            border-radius: 12px; 
            padding: 30px; 
            width: 90%; 
            max-width: 350px; 
            text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
        }
        .auth-error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 8px; 
            border-radius: 6px; 
            margin-bottom: 12px; 
            display: none; 
            font-size: 0.85em;
        }
        .auth-input { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 8px; 
            border: 2px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 0.9em; 
        }
        .connection-status { 
            position: fixed; 
            bottom: 8px; 
            right: 8px; 
            padding: 6px 12px; 
            border-radius: 15px; 
            z-index: 1000; 
            font-weight: 600; 
            font-size: 0.8em;
        }
        .connection-status.online { 
            background: #d4edda; 
            color: #155724; 
        }
        .connection-status.offline { 
            background: #f8d7da; 
            color: #721c24; 
        }
        .hidden { 
            display: none; 
        }
        .alert { 
            padding: 10px; 
            border-radius: 5px; 
            margin-bottom: 12px; 
            font-weight: bold; 
            font-size: 0.9em;
        }
        .alert.success { 
            background: #d4edda; 
            color: #155724; 
        }
        .alert.error { 
            background: #f8d7da; 
            color: #721c24; 
        }
        
        .loading::after { 
            content: ''; 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid rgba(0,0,0,0.1); 
            border-top-color: var(--primary-color); 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-left: 10px; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-message { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 12px; 
            border-radius: 6px; 
            text-align: center; 
            font-size: 0.9em;
        }
        
        /* RESPONSIVE MEJORADO */
        @media (min-width: 768px) {
            body { padding: 20px; }
            .header h1 { font-size: 2.5em; }
            .header p { font-size: 1.1em; }
            .panel { padding: 25px; }
            .panel h2 { font-size: 1.4em; }
            .mode-btn { padding: 10px 25px; font-size: 1em; }
            .semaforo-container { grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
            .semaforo-light { min-height: 200px; padding: 25px; }
            .form-row { grid-template-columns: 1fr 1fr; }
            .cliente-info { grid-template-columns: 1fr 1fr; }
            .admin-controls { grid-template-columns: 1fr 1.2fr; }
            .stats-bar { padding: 20px; }
            .stats-number { font-size: 2em; }
            .decision-matrix { grid-template-columns: 1fr 1fr 1fr; }
            .search-input { padding: 15px 20px 15px 50px; font-size: 1em; }
            .search-box::before { left: 20px; top: 15px; font-size: 1.2em; }
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            .header h1 { font-size: 1.8em; }
            .panel { padding: 15px; }
            .semaforo-light { min-height: 140px; padding: 15px; }
            .semaforo-title { font-size: 1.1em; }
            .tab { padding: 8px 12px; font-size: 0.8em; }
            .form-actions { flex-direction: column; }
            .proceso-footer { flex-direction: column; text-align: center; }
            .section-header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status offline">üî¥ Conectando...</div>
    
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>üîê Acceso Administrativo</h2>
            <p>Ingresa tus credenciales para continuar</p>
            <div id="authError" class="auth-error">Usuario o Contrase√±a incorrectos</div>
            <form id="authForm" style="margin-top: 20px;">
                <input type="text" id="authUsername" class="auth-input" placeholder="Usuario" required>
                <input type="password" id="authPassword" class="auth-input" placeholder="Contrase√±a" required>
                <button type="submit" class="admin-btn success">Ingresar</button>
                <button type="button" class="admin-btn danger" onclick="cancelAuth()">Cancelar</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainContent">
        <div class="header">
            <h1>DPI Publicidad - Sistema Railway</h1>
            <p>R√≥tulos ‚Ä¢ Material POP ‚Ä¢ Stands ‚Ä¢ Banners ‚Ä¢ Viniles</p>
            <div class="status" id="systemStatus">Conectando al servidor...</div>
        </div>

        <div class="mode-switcher-wrapper">
            <div class="mode-switcher">
                <button class="mode-btn active" onclick="switchMode('ventas')">üì± Modo Ventas</button>
                <button class="mode-btn" onclick="switchMode('admin')">‚öôÔ∏è Modo Admin</button>
            </div>
        </div>

        <div class="ventas-mode" id="ventasMode">
            <div class="panel">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar scripts..." autocomplete="off">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <!-- üö¶ SEM√ÅFORO DE CALIFICACI√ìN -->
            <div class="panel">
                <h2>üö¶ Proceso de Pre-Calificaci√≥n</h2>
                <div class="precalificacion-header">
                    <p><strong>‚ö†Ô∏è IMPORTANTE:</strong> Completa esta pre-calificaci√≥n antes de hacer cotizaci√≥n formal</p>
                    <button class="proceso-btn" onclick="iniciarProceso()">üéØ Iniciar Proceso de Calificaci√≥n</button>
                </div>
                <div class="semaforo-container">
                    <div class="semaforo-light verde" onclick="handleSemaforoClick('verde')">
                        <div class="semaforo-icon">üü¢</div>
                        <div>
                            <div class="semaforo-title">LUZ VERDE: COTIZAR</div>
                            <div class="semaforo-description">
                                El cliente se siente escuchado, conf√≠a en nosotros y entiende el valor.
                            </div>
                            <ul class="semaforo-list">
                                <li>Entendimos su "porqu√©"</li>
                                <li>Validamos su presupuesto</li>
                                <li>Confirm√≥ que le gusta la idea</li>
                                <li>El decisor est√° involucrado</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="semaforo-light amarillo" onclick="handleSemaforoClick('amarillo')">
                        <div class="semaforo-icon">üü°</div>
                        <div>
                            <div class="semaforo-title">LUZ AMARILLA: INVESTIGAR</div>
                            <div class="semaforo-description">
                                A√∫n no entendemos la necesidad real. Es momento de preguntar, no de proponer.
                            </div>
                            <ul class="semaforo-list">
                                <li>Habla solo de precio</li>
                                <li>No tiene claro el objetivo</li>
                                <li>Pide "ideas" sin contexto</li>
                                <li>No es el decisor final</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="semaforo-light rojo" onclick="handleSemaforoClick('rojo')">
                        <div class="semaforo-icon">üî¥</div>
                        <div>
                            <div class="semaforo-title">LUZ ROJA: PAUSAR</div>
                            <div class="semaforo-description">
                                Riesgo alto de ser una "cotizaci√≥n fantasma". Invertir tiempo aqu√≠ es costoso.
                            </div>
                            <ul class="semaforo-list">
                                <li>"Solo para tener una idea"</li>
                                <li>Sin presupuesto ni urgencia</li>
                                <li>No responde preguntas clave</li>
                                <li>"Env√≠eme lo que tengas"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üìã PROCESO DE CALIFICACI√ìN PASO A PASO -->
            <div class="panel proceso-panel" id="procesoPanel" style="display: none;">
                <h2>üìã Proceso de Calificaci√≥n por Etapas</h2>
                <div class="etapas-container">
                    <div class="etapa" data-etapa="1">
                        <div class="etapa-header">
                            <span class="etapa-numero">1</span>
                            <h3>üé¨ Apertura & Rapport</h3>
                            <span class="etapa-tiempo">2-3 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Generar confianza y entender la situaci√≥n general
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas Clave:</strong>
                                <ul>
                                    <li>"¬øC√≥mo nos conociste?"</li>
                                    <li>"¬øQu√© te lleva a buscar publicidad en este momento?"</li>
                                    <li>"¬øCu√°l es tu negocio/empresa?"</li>
                                </ul>
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('bienvenida')">üìù Ver Scripts de Apertura</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="2">
                        <div class="etapa-header">
                            <span class="etapa-numero">2</span>
                            <h3>üîç Investigaci√≥n & Necesidad</h3>
                            <span class="etapa-tiempo">5-7 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Entender el PORQU√â real detr√°s de su necesidad
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas OBLIGATORIAS:</strong>
                                <ul>
                                    <li>"¬øQu√© quieres lograr con esta publicidad?"</li>
                                    <li>"¬øQu√© pasar√≠a si no haces nada?"</li>
                                    <li>"¬øPara cu√°ndo necesitas tenerlo?"</li>
                                    <li>"¬øHas cotizado con alguien m√°s?"</li>
                                </ul>
                            </div>
                            <div class="se√±ales-alerta">
                                <strong>üö® Se√±ales de Alerta:</strong>
                                <span class="alerta">"Solo quiero precios"</span>
                                <span class="alerta">"No tengo prisa"</span>
                                <span class="alerta">"Para tener una idea"</span>
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('calificacion')">üîç Ver Scripts de Investigaci√≥n</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="3">
                        <div class="etapa-header">
                            <span class="etapa-numero">3</span>
                            <h3>üí∞ Presupuesto & Decisi√≥n</h3>
                            <span class="etapa-tiempo">3-5 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Validar presupuesto real y proceso de decisi√≥n
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas CR√çTICAS:</strong>
                                <ul>
                                    <li>"¬øTienes presupuesto definido para esto?"</li>
                                    <li>"¬øEn qu√© rango est√°s pensando?"</li>
                                    <li>"¬øEres t√∫ quien autoriza la inversi√≥n?"</li>
                                    <li>"¬øQu√© necesitas para tomar la decisi√≥n?"</li>
                                </ul>
                            </div>
                            <div class="validacion-presupuesto">
                                <strong>üí° Validaci√≥n:</strong> "Para darte la mejor propuesta, nuestros proyectos van desde $X hasta $Y, ¬øest√°s dentro de ese rango?"
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('calificacion')">üí∞ Ver Scripts de Presupuesto</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="4">
                        <div class="etapa-header">
                            <span class="etapa-numero">4</span>
                            <h3>üéØ Evaluaci√≥n & Pr√≥ximos Pasos</h3>
                            <span class="etapa-tiempo">2-3 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="decision-matrix">
                                <div class="decision-verde">
                                    <strong>üü¢ COTIZAR SI:</strong>
                                    <ul>
                                        <li>‚úÖ Necesidad clara y urgente</li>
                                        <li>‚úÖ Presupuesto validado</li>
                                        <li>‚úÖ Decisor identificado</li>
                                        <li>‚úÖ Timeline definido</li>
                                    </ul>
                                    <button class="decision-btn verde" onclick="tomarDecision('verde')">üéØ Proceder a Cotizaci√≥n</button>
                                </div>
                                <div class="decision-amarillo">
                                    <strong>üü° INVESTIGAR M√ÅS SI:</strong>
                                    <ul>
                                        <li>‚ö†Ô∏è Informaci√≥n incompleta</li>
                                        <li>‚ö†Ô∏è Presupuesto vago</li>
                                        <li>‚ö†Ô∏è No es el decisor</li>
                                    </ul>
                                    <button class="decision-btn amarillo" onclick="tomarDecision('amarillo')">üîç Programar Segunda Llamada</button>
                                </div>
                                <div class="decision-rojo">
                                    <strong>üî¥ PAUSAR SI:</strong>
                                    <ul>
                                        <li>‚ùå "Solo cotizaci√≥n"</li>
                                        <li>‚ùå Sin presupuesto</li>
                                        <li>‚ùå Sin urgencia</li>
                                    </ul>
                                    <button class="decision-btn rojo" onclick="tomarDecision('rojo')">‚è∏Ô∏è Pausar y Calificar M√°s</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="proceso-footer">
                    <button class="cerrar-proceso-btn" onclick="cerrarProceso()">‚ùå Cerrar Proceso</button>
                    <div class="tiempo-total">‚è±Ô∏è Tiempo total estimado: 12-18 minutos</div>
                </div>
            </div>
            
            <div class="panel">
                <div class="tabs" id="categoryTabs"></div>
                <div class="tab-content" id="scriptsContainer">
                    <div class="loading">Cargando scripts...</div>
                </div>
            </div>

            <!-- üë§ PERFILES DE CLIENTES IDEALES -->
            <div class="panel">
                <h2>üë§ Base de Conocimiento - Perfiles de Clientes Ideales</h2>
                <div class="cliente-ideal-container">
                    <div class="perfil-section neutral">
                        <div class="section-header">
                            <h3>üéØ Perfiles de Clientes IDEALES</h3>
                            <button class="agregar-cliente-btn" onclick="abrirFormularioCliente()">‚ûï Agregar Perfil</button>
                        </div>
                        <p class="section-description">
                            <strong>üí° Prop√≥sito:</strong> Arquetipos de clientes exitosos para consulta r√°pida del equipo.
                        </p>

                        <!-- Filtros de b√∫squeda estrat√©gicos -->
                        <div class="filtros-cliente">
                            <div class="filtro-grupo">
                                <label>üè¢ Sector:</label>
                                <select id="filtroTipo" onchange="filtrarPerfiles()">
                                    <option value="">Todos los sectores</option>
                                    <option value="restaurante">üçΩÔ∏è Restaurantes</option>
                                    <option value="retail">üè™ Retail/Tiendas</option>
                                    <option value="servicios">üíº Servicios</option>
                                    <option value="clinica">üè• Cl√≠nicas</option>
                                    <option value="empresa">üè¢ Empresas</option>
                                    <option value="otro">üìã Otros</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>üí∞ Presupuesto:</label>
                                <select id="filtroPresupuesto" onchange="filtrarPerfiles()">
                                    <option value="">Todos los rangos</option>
                                    <option value="bajo">üíµ Bajo ($500-$2K)</option>
                                    <option value="medio">üí¥ Medio ($2K-$5K)</option>
                                    <option value="alto">üí∏ Alto ($5K+)</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>‚ö° Decisi√≥n:</label>
                                <select id="filtroUrgencia" onchange="filtrarPerfiles()">
                                    <option value="">Todos los tipos</option>
                                    <option value="alta">üöÄ Decisi√≥n R√°pida</option>
                                    <option value="media">‚è≥ Decisi√≥n Normal</option>
                                    <option value="baja">ü§î Planifican Mucho</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Formulario para agregar/editar perfil ideal -->
                        <div class="formulario-cliente" id="formularioCliente" style="display: none;">
                            <div class="form-header">
                                <h4 id="tituloFormulario">‚ûï Agregar Nuevo Perfil de Cliente Ideal</h4>
                                <button class="cerrar-form-btn" onclick="cerrarFormularioCliente()">‚úñÔ∏è</button>
                            </div>
                            <form id="clienteForm">
                                <input type="hidden" id="clienteId" value="">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Nombre del Perfil/Arquetipo</label>
                                        <input type="text" id="clienteNombre" required placeholder="Ej: Restaurante Familiar Exitoso">
                                    </div>
                                    <div class="form-group">
                                        <label>Tipo de Negocio</label>
                                        <select id="clienteTipo" required>
                                            <option value="">Seleccionar tipo</option>
                                            <option value="restaurante">Restaurante/Bar</option>
                                            <option value="retail">Tienda/Retail</option>
                                            <option value="servicios">Servicios Profesionales</option>
                                            <option value="clinica">Cl√≠nica/Consultorio</option>
                                            <option value="empresa">Empresa/Corporativo</option>
                                            <option value="otro">Otro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Contacto T√≠pico (Cargo/Rol)</label>
                                        <input type="text" id="clienteContacto" placeholder="Ej: Due√±o/Gerente General">
                                    </div>
                                    <div class="form-group">
                                        <label>Ubicaci√≥n/Zona T√≠pica</label>
                                        <input type="text" id="clienteTelefono" placeholder="Ej: Zona comercial c√©ntrica">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Caracter√≠sticas que los hacen IDEALES</label>
                                    <textarea id="clienteCaracteristicas" required placeholder="Ej: Negocio establecido +2 a√±os, entienden el valor de la imagen, toman decisiones r√°pidas, invierten en calidad..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Qu√© tipo de publicidad necesitan t√≠picamente</label>
                                    <textarea id="clienteNecesidad" required placeholder="Ej: R√≥tulo de fachada de calidad, material POP para promociones, banners estacionales..."></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Rango de Presupuesto T√≠pico</label>
                                        <select id="clientePresupuesto">
                                            <option value="">No especificado</option>
                                            <option value="bajo">Bajo ($500 - $2,000)</option>
                                            <option value="medio">Medio ($2,000 - $5,000)</option>
                                            <option value="alto">Alto ($5,000+)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Ciclo de Decisi√≥n</label>
                                        <select id="clienteUrgencia">
                                            <option value="">No especificado</option>
                                            <option value="baja">Lento (Planifican con tiempo)</option>
                                            <option value="media">Normal (1-2 meses)</option>
                                            <option value="alta">R√°pido (Deciden pronto)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Mejores Estrategias de Approach</label>
                                    <textarea id="clienteProximosPasos" placeholder="Ej: Mostrar portfolio similar, enfocarse en calidad y durabilidad, ofrecer garant√≠a extendida..."></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Vendedor que Identific√≥ el Perfil</label>
                                        <input type="text" id="clienteVendedor" placeholder="Nombre del vendedor">
                                    </div>
                                    <div class="form-group">
                                        <label>Fecha de Documentaci√≥n</label>
                                        <input type="date" id="clienteFecha">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="guardar-cliente-btn">üíæ Guardar Perfil</button>
                                    <button type="button" class="cancelar-btn" onclick="cerrarFormularioCliente()">‚ùå Cancelar</button>
                                </div>
                            </form>
                        </div>

                        <!-- Contador y lista din√°mica de perfiles -->
                        <div class="perfil-count" id="perfilesCount">üìä Cargando perfiles...</div>
                        <div class="clientes-potenciales-lista" id="clientesPotencialesList">
                            <div class="loading">Cargando perfiles de clientes ideales...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-mode" id="adminMode">
            <!-- El contenido del modo admin se generar√° aqu√≠ -->
        </div>
    </div>

    <script>
        // ‚úÖ CONFIGURACI√ìN
        const API_BASE_URL = '';
        
        let SCRIPTS_DATA = {};
        let currentEditingId = null;
        let isAuthenticated = false;
        let debounceTimer = null;
        let connectionInterval = null;
        let CLIENTES_POTENCIALES = [];
        let currentEditingClienteId = null;

        // ‚úÖ FUNCI√ìN DE ALERTAS
        function showAlert(message, type = 'success', containerId = 'alertContainer') {
            let container = document.getElementById(containerId);
            if (!container) {
                container = document.getElementById('mainContent');
                if (!container) return;
            }
            
            const alertEl = document.createElement('div');
            alertEl.className = `alert ${type}`;
            alertEl.textContent = message;
            container.prepend(alertEl);
            
            setTimeout(() => {
                if (alertEl.parentNode) {
                    alertEl.remove();
                }
            }, 4000);
        }

        // ‚úÖ LLAMADAS A API
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                console.log('API Call:', url);
                
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                updateConnectionStatus(true);
                
                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                    } catch {
                        errorData = { error: `Error HTTP: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Error HTTP: ${response.status}`);
                }
                
                const contentType = response.headers.get("content-type");
                if (contentType?.includes("application/json")) {
                    return await response.json();
                } else {
                    return await response.blob();
                }
            } catch (error) {
                console.error('API Error:', error);
                updateConnectionStatus(false);
                showAlert(`Error de conexi√≥n: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // ‚úÖ CARGA DE DATOS
        async function fetchAllData() {
            const container = document.getElementById('scriptsContainer');
            if (container) {
                container.innerHTML = '<div class="loading">Cargando scripts...</div>';
            }
            
            try {
                const data = await apiCall('/api/scripts');
                SCRIPTS_DATA = data;
                renderVentasUI();
                updateSystemStatus();
            } catch (error) {
                if (container) {
                    container.innerHTML = `
                        <div class="error-message">
                            ‚ùå Error al cargar scripts: ${error.message}
                            <br><br>
                            <button onclick="fetchAllData()" class="copy-btn">üîÑ Reintentar</button>
                        </div>
                    `;
                }
            }
        }

        // ‚úÖ CARGA DE CLIENTES POTENCIALES
        async function cargarClientesPotenciales() {
            try {
                const data = await apiCall('/api/clientes-potenciales');
                CLIENTES_POTENCIALES = data;
                renderClientesPotenciales();
            } catch (error) {
                console.error('Error al cargar perfiles de clientes ideales:', error);
                const container = document.getElementById('clientesPotencialesList');
                if (container) {
                    container.innerHTML = `
                        <div class="error-message">
                            ‚ùå Error al cargar perfiles: ${error.message}
                            <br><br>
                            <button onclick="cargarClientesPotenciales()" class="copy-btn">üîÑ Reintentar</button>
                        </div>
                    `;
                }
            }
        }
        
        // ‚úÖ AUTENTICACI√ìN
        function handleAuth(e) {
            e.preventDefault();
            const username = document.getElementById('authUsername')?.value;
            const password = document.getElementById('authPassword')?.value;
            const errorEl = document.getElementById('authError');
            
            if (!username || !password) {
                if (errorEl) {
                    errorEl.textContent = 'Por favor ingresa usuario y contrase√±a';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            if (username === 'admin' && password === 'DPI2025Admin') {
                isAuthenticated = true;
                document.getElementById('authOverlay')?.classList.remove('active');
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.style.filter = 'none';
                }
                switchMode('admin', true);
                
                document.getElementById('authForm')?.reset();
                if (errorEl) errorEl.style.display = 'none';
            } else {
                if (errorEl) {
                    errorEl.textContent = 'Usuario o contrase√±a incorrectos';
                    errorEl.style.display = 'block';
                }
            }
        }

        function cancelAuth() {
            const overlay = document.getElementById('authOverlay');
            const mainContent = document.getElementById('mainContent');
            
            if (overlay) overlay.classList.remove('active');
            if (mainContent) mainContent.style.filter = 'none';
            
            document.getElementById('authForm')?.reset();
            const errorEl = document.getElementById('authError');
            if (errorEl) errorEl.style.display = 'none';
        }

        function showAuthModal() {
            const overlay = document.getElementById('authOverlay');
            const mainContent = document.getElementById('mainContent');
            
            if (overlay) {
                overlay.classList.add('active');
                if (mainContent) mainContent.style.filter = 'blur(5px)';
                
                setTimeout(() => {
                    const usernameInput = document.getElementById('authUsername');
                    if (usernameInput) usernameInput.focus();
                }, 100);
            }
        }

        // ‚úÖ CAMBIO DE MODO
        function switchMode(mode, fromAuth = false) {
            const ventasMode = document.getElementById('ventasMode');
            const adminMode = document.getElementById('adminMode');
            const modeButtons = document.querySelectorAll('.mode-btn');

            if (mode === 'admin' && !fromAuth) { 
                showAuthModal(); 
                return; 
            }
            
            modeButtons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'ventas') {
                if (ventasMode) ventasMode.style.display = 'block';
                if (adminMode) adminMode.style.display = 'none';
                if (modeButtons[0]) modeButtons[0].classList.add('active');
            } else if (mode === 'admin') {
                if (ventasMode) ventasMode.style.display = 'none';
                if (adminMode) adminMode.style.display = 'block';
                if (modeButtons[1]) modeButtons[1].classList.add('active');
                loadAdminData();
            }
        }

        // ‚úÖ RENDERIZADO DE UI
        function renderVentasUI() {
            const tabsContainer = document.getElementById('categoryTabs');
            const scriptsContainer = document.getElementById('scriptsContainer');
            
            if (!tabsContainer || !scriptsContainer) return;
            
            tabsContainer.innerHTML = '';
            scriptsContainer.innerHTML = '';
            
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(categoryNames).forEach((category, index) => {
                const tab = document.createElement('button');
                tab.className = `tab ${index === 0 ? 'active' : ''}`;
                tab.textContent = categoryNames[category];
                tab.onclick = (e) => showTab(category, e.target);
                tabsContainer.appendChild(tab);
                
                const section = document.createElement('div');
                section.id = category;
                section.className = `tab-section ${index > 0 ? 'hidden' : ''}`;
                
                if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].length > 0) {
                    section.innerHTML = SCRIPTS_DATA[category].map(createScriptCardHTML).join('');
                } else {
                    section.innerHTML = `<div class="empty-state">No hay scripts en esta categor√≠a.</div>`;
                }
                
                scriptsContainer.appendChild(section);
            });
        }
        
        // ‚úÖ CREACI√ìN DE CARDS
        function createScriptCardHTML(script) {
            const badgeHTML = script.badge ? 
                `<span class="script-badge" style="background-color: ${script.badge.color || '#6c757d'}">
                    ${script.badge.icon} ${script.badge.text}
                </span>` : '';
            
            return `
                <div class="script-card" data-script-id="${script.id}">
                    <div class="script-title">
                        ${script.title}
                        ${badgeHTML}
                    </div>
                    <div class="script-text">${script.text}</div>
                    <div class="usage-stats">
                        <span>üìä ${script.usage_30_days || 0} usos (30d)</span>
                        <span>üìà ${script.usage_7_days || 0} usos (7d)</span>
                    </div>
                    <div class="script-actions">
                        <button class="copy-btn" onclick="copyAndTrack(${script.id})">üìã Copiar</button>
                    </div>
                </div>
            `;
        }
        
        // ‚úÖ NAVEGACI√ìN ENTRE TABS
        function showTab(category, clickedTab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-section').forEach(s => s.classList.add('hidden'));
            
            if (clickedTab) clickedTab.classList.add('active');
            
            const section = document.getElementById(category);
            if (section) section.classList.remove('hidden');
        }

        // ‚úÖ ESTADO DEL SISTEMA
        function updateSystemStatus() {
            const totalCount = SCRIPTS_DATA ? 
                Object.values(SCRIPTS_DATA).reduce((sum, cat) => 
                    sum + (Array.isArray(cat) ? cat.length : 0), 0
                ) : 0;
            
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                statusEl.className = 'status online';
                statusEl.innerHTML = `‚úÖ Sistema activo - ${totalCount} scripts disponibles - ${new Date().toLocaleTimeString()}`;
            }
        }

        // ‚úÖ ESTADO DE CONEXI√ìN
        function updateConnectionStatus(isOnline) {
            const statusEl = document.getElementById('connectionStatus');
            const headerStatus = document.getElementById('systemStatus');
            
            if (statusEl) {
                statusEl.textContent = isOnline ? 'üü¢ En l√≠nea' : 'üî¥ Sin conexi√≥n';
                statusEl.className = `connection-status ${isOnline ? 'online' : 'offline'}`;
            }
            
            if (headerStatus) {
                headerStatus.className = `status ${isOnline ? 'online' : 'offline'}`;
                if (!isOnline) {
                    headerStatus.textContent = 'üî¥ Error de Servidor';
                }
            }
        }
        
        // ‚úÖ COPIAR Y RASTREAR
        async function copyAndTrack(scriptId) {
            const card = document.querySelector(`.script-card[data-script-id="${scriptId}"]`);
            if (!card) return;
            
            const textElement = card.querySelector('.script-text');
            const button = card.querySelector('.copy-btn');
            
            if (!textElement || !button) return;
            
            const text = textElement.innerText;
            
            try {
                await navigator.clipboard.writeText(text);
                
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copiado';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                
                try {
                    await apiCall(`/api/scripts/${scriptId}/track`, { method: 'POST' });
                } catch (trackError) {
                    console.warn('Error al rastrear uso:', trackError);
                }
                
            } catch (copyError) {
                console.error('Error al copiar:', copyError);
                showAlert('Error al copiar al portapapeles', 'error');
            }
        }

        // ‚úÖ FUNCIONES DEL PROCESO DE PRE-CALIFICACI√ìN
        function iniciarProceso() {
            const procesoPanel = document.getElementById('procesoPanel');
            if (procesoPanel) {
                procesoPanel.style.display = 'block';
                
                setTimeout(() => {
                    procesoPanel.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
                
                showAlert('üéØ Proceso de calificaci√≥n iniciado. Sigue cada etapa en orden.', 'success');
            }
        }
        
        function cerrarProceso() {
            const procesoPanel = document.getElementById('procesoPanel');
            if (procesoPanel) {
                procesoPanel.style.display = 'none';
                showAlert('üìã Proceso de calificaci√≥n cerrado', 'success');
            }
        }
        
        function irACategoria(categoria) {
            cerrarProceso();
            
            const tabs = Array.from(document.querySelectorAll('.tab'));
            const targetTab = tabs.find(tab => {
                const tabText = tab.textContent.toLowerCase();
                return tabText.includes(categoria);
            });
            
            if (targetTab) {
                showTab(categoria, targetTab);
                
                setTimeout(() => {
                    document.getElementById('categoryTabs').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                }, 100);
                
                showAlert(`üìù Mostrando scripts de ${getCategoryName(categoria)}`, 'success');
            }
        }
        
        function tomarDecision(decision) {
            const messages = {
                'verde': {
                    title: 'üü¢ DECISI√ìN: PROCEDER A COTIZACI√ìN',
                    message: 'Cliente calificado correctamente. Puedes invertir tiempo en una cotizaci√≥n formal.',
                    category: 'cierre'
                },
                'amarillo': {
                    title: 'üü° DECISI√ìN: INVESTIGAR M√ÅS',
                    message: 'Cliente necesita m√°s calificaci√≥n. Programa una segunda llamada con preguntas espec√≠ficas.',
                    category: 'calificacion'
                },
                'rojo': {
                    title: 'üî¥ DECISI√ìN: PAUSAR PROCESO',
                    message: 'Cliente no calificado. No inviertas tiempo en cotizaci√≥n. Usa scripts b√°sicos.',
                    category: 'bienvenida'
                }
            };
            
            const msg = messages[decision];
            showAlert(msg.message, decision === 'verde' ? 'success' : 'error');
            
            if (confirm(`${msg.title}\n\n${msg.message}\n\n¬øQuieres ver los scripts recomendados para esta situaci√≥n?`)) {
                irACategoria(msg.category);
            } else {
                cerrarProceso();
            }
        }

        // ‚úÖ SISTEMA DIN√ÅMICO DE CLIENTES POTENCIALES
        // ‚úÖ RENDERIZADO COMPACTO DE PERFILES
        function renderClientesPotenciales() {
            const container = document.getElementById('clientesPotencialesList');
            if (!container) return;
            
            const perfilesFiltrados = filtrarPerfilesData();
            
            // Mostrar contador
            const countEl = document.getElementById('perfilesCount');
            if (countEl) {
                countEl.textContent = `üìä ${perfilesFiltrados.length} perfil${perfilesFiltrados.length !== 1 ? 'es' : ''} encontrado${perfilesFiltrados.length !== 1 ? 's' : ''}`;
            }
            
            if (perfilesFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="cliente-empty">
                        üìö No hay perfiles que coincidan con los filtros.<br>
                        ${CLIENTES_POTENCIALES.length === 0 ? '¬°Agrega el primer perfil usando el bot√≥n de arriba!' : 'Prueba ajustando los filtros.'}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = perfilesFiltrados.map(cliente => createPerfilCardCompacta(cliente)).join('');
        }
        
        function createPerfilCardCompacta(cliente) {
            const tipoLabels = {
                restaurante: "üçΩÔ∏è Restaurante",
                retail: "üè™ Retail", 
                servicios: "üíº Servicios",
                clinica: "üè• Cl√≠nica",
                empresa: "üè¢ Empresa",
                otro: "üìã Otro"
            };
            
            const presupuestoLabels = {
                bajo: "Bajo ($500-$2K)",
                medio: "Medio ($2K-$5K)", 
                alto: "Alto ($5K+)"
            };
            
            const urgenciaLabels = {
                baja: "Planifican",
                media: "Normal",
                alta: "R√°pidos"
            };
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            return `
                <div class="perfil-card-compacta" id="perfil-${cliente.id}">
                    <div class="perfil-expandir-btn" onclick="togglePerfilDetalle(${cliente.id})">
                        <span id="expand-icon-${cliente.id}">‚ñ∂</span>
                    </div>
                    
                    <div class="perfil-header-compacto">
                        <div class="perfil-nombre-compacto">
                            ${cliente.nombre}
                        </div>
                        <div class="perfil-tipo-compacto">${tipoLabels[cliente.tipo] || cliente.tipo}</div>
                    </div>
                    
                    <div class="perfil-resumen">
                        <div class="perfil-resumen-item">
                            <strong>üë§ Contacto t√≠pico:</strong>
                            ${cliente.contacto || 'No especificado'}
                        </div>
                        <div class="perfil-resumen-item">
                            <strong>üìç Ubicaci√≥n t√≠pica:</strong>
                            ${cliente.telefono || 'No especificado'}
                        </div>
                    </div>
                    
                    <div class="perfil-tags-compacto">
                        ${cliente.presupuesto ? `<span class="perfil-tag-compacto presupuesto-${cliente.presupuesto}">${presupuestoLabels[cliente.presupuesto]}</span>` : ''}
                        ${cliente.urgencia ? `<span class="perfil-tag-compacto urgencia-${cliente.urgencia}">${urgenciaLabels[cliente.urgencia]}</span>` : ''}
                        <span class="perfil-tag-compacto">üìÖ ${fechaContacto ? new Date(fechaContacto).toLocaleDateString() : 'Sin fecha'}</span>
                    </div>
                    
                    <div class="perfil-detalles" id="detalles-${cliente.id}">
                        <div class="perfil-detalle-item">
                            <strong>üéØ Caracter√≠sticas que los hacen IDEALES:</strong>
                            ${cliente.caracteristicas}
                        </div>
                        
                        <div class="perfil-detalle-item">
                            <strong>üì¢ Tipo de publicidad que necesitan:</strong>
                            ${cliente.necesidad}
                        </div>
                        
                        ${proximosPasos ? `
                            <div class="perfil-detalle-item">
                                <strong>üí° Mejores estrategias de approach:</strong>
                                ${proximosPasos}
                            </div>
                        ` : ''}
                        
                        <div class="perfil-detalle-item">
                            <strong>üìù Documentado por:</strong> ${cliente.vendedor || 'No especificado'}
                        </div>
                        
                        <div class="perfil-acciones-compacto">
                            <button class="perfil-editar-btn" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                            <button class="perfil-eliminar-btn" onclick="eliminarCliente(${cliente.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ‚úÖ FUNCIONES DE FILTRADO
        function filtrarPerfilesData() {
            const filtroTipo = document.getElementById('filtroTipo')?.value || '';
            const filtroPresupuesto = document.getElementById('filtroPresupuesto')?.value || '';
            const filtroUrgencia = document.getElementById('filtroUrgencia')?.value || '';
            
            return CLIENTES_POTENCIALES.filter(cliente => {
                const cumpleTipo = !filtroTipo || cliente.tipo === filtroTipo;
                const cumplePresupuesto = !filtroPresupuesto || cliente.presupuesto === filtroPresupuesto;
                const cumpleUrgencia = !filtroUrgencia || cliente.urgencia === filtroUrgencia;
                
                return cumpleTipo && cumplePresupuesto && cumpleUrgencia;
            });
        }
        
        function filtrarPerfiles() {
            renderClientesPotenciales();
        }
        
        // ‚úÖ TOGGLE DE DETALLES
        function togglePerfilDetalle(id) {
            const detalles = document.getElementById(`detalles-${id}`);
            const icon = document.getElementById(`expand-icon-${id}`);
            const card = document.getElementById(`perfil-${id}`);
            
            if (detalles && icon && card) {
                if (detalles.classList.contains('visible')) {
                    detalles.classList.remove('visible');
                    icon.textContent = '‚ñ∂';
                    card.classList.remove('expandida');
                } else {
                    detalles.classList.add('visible');
                    icon.textContent = '‚ñº';
                    card.classList.add('expandida');
                    
                    // Scroll suave al perfil expandido
                    setTimeout(() => {
                        card.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest' 
                        });
                    }, 100);
                }
            }
        }
        
        function createClienteCard(cliente) {
            const tipoLabels = {
                restaurante: "üçΩÔ∏è Restaurante",
                retail: "üè™ Retail", 
                servicios: "üíº Servicios",
                clinica: "üè• Cl√≠nica",
                empresa: "üè¢ Empresa",
                otro: "üìã Otro"
            };
            
            const presupuestoLabels = {
                bajo: "Bajo ($500-$2K)",
                medio: "Medio ($2K-$5K)", 
                alto: "Alto ($5K+)"
            };
            
            const urgenciaLabels = {
                baja: "Planifican con tiempo",
                media: "Decisi√≥n normal",
                alta: "Decisi√≥n r√°pida"
            };
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            return `
                <div class="cliente-potencial-card">
                    <div class="cliente-header">
                        <div class="cliente-nombre">${cliente.nombre}</div>
                        <div class="cliente-tipo">${tipoLabels[cliente.tipo] || cliente.tipo}</div>
                    </div>
                    
                    <div class="cliente-info">
                        <div class="cliente-field">
                            <strong>Contacto t√≠pico:</strong> ${cliente.contacto || 'No especificado'}
                        </div>
                        <div class="cliente-field">
                            <strong>Ubicaci√≥n t√≠pica:</strong> ${cliente.telefono || 'No especificado'}
                        </div>
                    </div>
                    
                    <div class="cliente-descripcion">
                        <strong>Caracter√≠sticas que los hacen IDEALES:</strong><br>
                        ${cliente.caracteristicas}
                    </div>
                    
                    <div class="cliente-descripcion">
                        <strong>Tipo de publicidad que necesitan:</strong><br>
                        ${cliente.necesidad}
                    </div>
                    
                    ${proximosPasos ? `
                        <div class="cliente-descripcion">
                            <strong>Mejores estrategias de approach:</strong><br>
                            ${proximosPasos}
                        </div>
                    ` : ''}
                    
                    <div class="cliente-tags">
                        ${cliente.presupuesto ? `<span class="cliente-tag presupuesto-${cliente.presupuesto}">${presupuestoLabels[cliente.presupuesto]}</span>` : ''}
                        ${cliente.urgencia ? `<span class="cliente-tag urgencia-${cliente.urgencia}">${urgenciaLabels[cliente.urgencia]}</span>` : ''}
                    </div>
                    
                    <div class="cliente-footer">
                        <div>
                            <strong>Documentado por:</strong> ${cliente.vendedor || 'No especificado'} | 
                            <strong>Fecha:</strong> ${fechaContacto ? new Date(fechaContacto).toLocaleDateString() : 'No especificada'}
                        </div>
                        <div class="cliente-actions">
                            <button class="editar-cliente-btn" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                            <button class="eliminar-cliente-btn" onclick="eliminarCliente(${cliente.id})">üóëÔ∏è Eliminar</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function abrirFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                document.getElementById('clienteForm').reset();
                document.getElementById('clienteId').value = '';
                currentEditingClienteId = null;
                
                titulo.textContent = '‚ûï Agregar Nuevo Perfil de Cliente Ideal';
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                showAlert('üìù Formulario abierto. Documenta un perfil de cliente ideal para el equipo.', 'success');
            }
        }
        
        function cerrarFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            if (formulario) {
                formulario.style.display = 'none';
                currentEditingClienteId = null;
            }
        }
        
        function editarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) {
                showAlert('Cliente no encontrado', 'error');
                return;
            }
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            document.getElementById('clienteId').value = cliente.id;
            document.getElementById('clienteNombre').value = cliente.nombre;
            document.getElementById('clienteTipo').value = cliente.tipo;
            document.getElementById('clienteContacto').value = cliente.contacto || '';
            document.getElementById('clienteTelefono').value = cliente.telefono || '';
            document.getElementById('clienteCaracteristicas').value = cliente.caracteristicas;
            document.getElementById('clienteNecesidad').value = cliente.necesidad;
            document.getElementById('clientePresupuesto').value = cliente.presupuesto || '';
            document.getElementById('clienteUrgencia').value = cliente.urgencia || '';
            document.getElementById('clienteProximosPasos').value = proximosPasos || '';
            document.getElementById('clienteVendedor').value = cliente.vendedor || '';
            document.getElementById('clienteFecha').value = fechaContacto || '';
            
            currentEditingClienteId = id;
            
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                titulo.textContent = `‚úèÔ∏è Editando: ${cliente.nombre}`;
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        async function eliminarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            if (!confirm(`¬øEst√°s seguro de que quieres eliminar a "${cliente.nombre}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                await apiCall(`/api/clientes-potenciales/${id}`, { 
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                CLIENTES_POTENCIALES = CLIENTES_POTENCIALES.filter(c => c.id !== id);
                renderClientesPotenciales();
                showAlert('Cliente eliminado exitosamente', 'success');
                
            } catch (error) {
                showAlert(`Error al eliminar cliente: ${error.message}`, 'error');
            }
        }

        // ‚úÖ B√öSQUEDA
        function performSearch(query) {
            const resultsContainer = document.getElementById('searchResults');
            if (!resultsContainer) return;
            
            resultsContainer.innerHTML = `<div class="loading" style="padding:10px;">Buscando...</div>`;
            resultsContainer.classList.add('active');
            
            if (window.searchController) {
                window.searchController.abort();
            }
            
            window.searchController = new AbortController();
            
            apiCall(`/api/scripts/search?q=${encodeURIComponent(query)}`, {
                signal: window.searchController.signal
            })
                .then(results => {
                    if (!results || !Array.isArray(results)) {
                        resultsContainer.innerHTML = `<div class="search-result-item error-message">Error en formato de respuesta</div>`;
                        return;
                    }
                    
                    if (results.length > 0) {
                        resultsContainer.innerHTML = results.map(result => `
                            <div class="search-result-item" onclick="scrollToScript(${result.id})">
                                <div class="search-result-category">${getCategoryName(result.category)}</div>
                                <div>${result.highlightedTitle}</div>
                                <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 5px;">${result.highlightedText || ''}</div>
                            </div>
                        `).join('');
                    } else {
                        resultsContainer.innerHTML = `
                            <div class="search-result-item" style="text-align: center; color: #7f8c8d;">
                                üîç No se encontraron resultados para "${query}"
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    if (error.name === 'AbortError') return;
                    
                    resultsContainer.innerHTML = `
                        <div class="search-result-item error-message">
                            ‚ùå Error en la b√∫squeda: ${error.message}
                        </div>
                    `;
                });
        }
        
        function getCategoryName(category) {
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            return categoryNames[category] || category;
        }

        function scrollToScript(id) {
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.classList.remove('active');
            }
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            
            const card = document.querySelector(`.script-card[data-script-id="${id}"]`);
            if (!card) {
                showAlert('Script no encontrado en la vista actual', 'error');
                return;
            }
            
            let categoryKey = null;
            for (const category in SCRIPTS_DATA) {
                if (SCRIPTS_DATA[category].some(s => s.id == id)) {
                    categoryKey = category;
                    break;
                }
            }
            
            if (categoryKey) {
                const tabs = Array.from(document.querySelectorAll('.tab'));
                const targetTab = tabs.find(tab => {
                    const tabText = tab.textContent.toLowerCase();
                    return tabText.includes(categoryKey) || 
                           tabText.includes(getCategoryName(categoryKey).toLowerCase());
                });
                
                if (targetTab) {
                    showTab(categoryKey, targetTab);
                }
            }
            
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                card.style.transition = 'background-color 0.5s ease';
                card.style.backgroundColor = '#fff3cd';
                
                setTimeout(() => {
                    card.style.backgroundColor = '';
                }, 2000);
            }, 100);
        }

        // ‚úÖ MANEJO DEL SEM√ÅFORO
        function handleSemaforoClick(color) {
            const categoryMap = {
                'verde': 'cierre',
                'amarillo': 'calificacion',
                'rojo': 'bienvenida'
            };
            
            const targetCategory = categoryMap[color];
            
            const messages = {
                'verde': 'üü¢ Cliente LISTO para cotizar ‚Üí Ir a scripts de CIERRE',
                'amarillo': 'üü° Cliente necesita INVESTIGACI√ìN ‚Üí Ir a scripts de CALIFICACI√ìN', 
                'rojo': 'üî¥ Cliente PROBLEM√ÅTICO ‚Üí Usar scripts b√°sicos de BIENVENIDA'
            };
            
            showAlert(messages[color], 'success');
            
            setTimeout(() => {
                const tabs = Array.from(document.querySelectorAll('.tab'));
                const targetTab = tabs.find(tab => {
                    const tabText = tab.textContent.toLowerCase();
                    return tabText.includes(targetCategory);
                });
                
                if (targetTab) {
                    showTab(targetCategory, targetTab);
                    
                    setTimeout(() => {
                        document.getElementById('categoryTabs').scrollIntoView({ 
                            behavior: 'smooth' 
                        });
                    }, 100);
                }
            }, 1500);
        }

        // ‚úÖ CARGA DE DATOS ADMIN
        function loadAdminData() {
            const adminContainer = document.getElementById('adminMode');
            if (!adminContainer) return;
            
            if (!adminContainer.querySelector('.admin-controls')) {
                adminContainer.innerHTML = `
                    <div class="panel stats-bar" id="statsBar">
                        <div class="stats-item">
                            <span class="stats-number">---</span>
                            <span class="stats-label">Cargando...</span>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h2>üìä Analytics</h2>
                        <div id="analyticsContainer">
                            <div class="loading">Cargando analytics...</div>
                        </div>
                    </div>
                    
                    <div class="admin-controls">
                        <div class="panel">
                            <h2 id="formTitle">‚ûï Agregar Script</h2>
                            <div id="alertContainer"></div>
                            <form id="scriptForm">
                                <div class="form-group">
                                    <label>Categor√≠a</label>
                                    <select id="scriptCategory" required>
                                        <option value="">Seleccionar categor√≠a</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="scriptTitle" required placeholder="Ingresa el t√≠tulo del script">
                                </div>
                                <div class="form-group">
                                    <label>Texto</label>
                                    <textarea id="scriptText" required placeholder="Ingresa el contenido del script"></textarea>
                                </div>
                                <button type="submit" class="admin-btn success">üíæ Guardar</button>
                                <button type="button" class="admin-btn danger" onclick="clearForm()">üóëÔ∏è Limpiar</button>
                            </form>
                        </div>
                        
                        <div class="panel">
                            <h2>üìù Scripts Existentes</h2>
                            <div class="form-group">
                                <label>Filtrar por categor√≠a</label>
                                <select id="filterCategory">
                                    <option value="all">Todas las categor√≠as</option>
                                </select>
                            </div>
                            <div class="scripts-list" id="scriptsList">
                                <div class="loading">Cargando scripts...</div>
                            </div>
                        </div>
                    </div>
                `;
                
                const scriptForm = document.getElementById('scriptForm');
                if (scriptForm) {
                    scriptForm.addEventListener('submit', handleAdminFormSubmit);
                }
                
                const filterCategory = document.getElementById('filterCategory');
                if (filterCategory) {
                    filterCategory.addEventListener('change', renderAdminList);
                }
            }
            
            populateCategorySelect('scriptCategory');
            populateCategorySelect('filterCategory');
            renderAdminList();
            loadAnalyticsDashboard();
            updateAdminStats();
        }

        // ‚úÖ POBLAR SELECTS
        function populateCategorySelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '';
            
            if (selectId === 'filterCategory') {
                select.innerHTML = `<option value="all">Todas las categor√≠as</option>`;
            } else {
                select.innerHTML = `<option value="">Seleccionar categor√≠a</option>`;
            }
            
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(categoryNames).forEach(key => {
                select.innerHTML += `<option value="${key}">${categoryNames[key]}</option>`;
            });
            
            if (currentValue && (currentValue === 'all' || categoryNames[currentValue])) {
                select.value = currentValue;
            }
        }

        // ‚úÖ RENDERIZADO LISTA ADMIN
        function renderAdminList() {
            const listContainer = document.getElementById('scriptsList');
            const filterSelect = document.getElementById('filterCategory');
            
            if (!listContainer) return;
            
            const filter = filterSelect ? filterSelect.value : 'all';
            listContainer.innerHTML = '';
            
            let hasScripts = false;
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(SCRIPTS_DATA).forEach(category => {
                if (filter === 'all' || filter === category) {
                    if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].length > 0) {
                        hasScripts = true;
                        
                        if (filter === 'all') {
                            listContainer.innerHTML += `
                                <div style="margin: 20px 0 10px 0; font-weight: 600; color: var(--primary-color);">
                                    ${categoryNames[category] || category}
                                </div>
                            `;
                        }
                        
                        SCRIPTS_DATA[category].forEach(script => {
                            listContainer.innerHTML += `
                                <div class="script-item">
                                    <div>
                                        <h4>${script.title}</h4>
                                        <small style="color: #7f8c8d;">${script.text.substring(0, 60)}...</small>
                                    </div>
                                    <div class="script-item-actions">
                                        <button class="edit-btn" onclick="editScript(${script.id})">‚úèÔ∏è Editar</button>
                                        <button class="delete-btn" onclick="deleteScript(${script.id})">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                }
            });
            
            if (!hasScripts) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        ${filter === 'all' ? 'No hay scripts disponibles.' : `No hay scripts en la categor√≠a "${categoryNames[filter] || filter}".`}
                    </div>
                `;
            }
        }

        // ‚úÖ MANEJO DE FORMULARIO ADMIN
        async function handleAdminFormSubmit(e) {
            e.preventDefault();
            
            const categoryEl = document.getElementById('scriptCategory');
            const titleEl = document.getElementById('scriptTitle');
            const textEl = document.getElementById('scriptText');
            
            if (!categoryEl || !titleEl || !textEl) {
                showAlert('Error: elementos del formulario no encontrados', 'error');
                return;
            }
            
            const category = categoryEl.value.trim();
            const title = titleEl.value.trim();
            const text = textEl.value.trim();
            
            if (!category) {
                showAlert('Por favor selecciona una categor√≠a', 'error');
                categoryEl.focus();
                return;
            }
            
            if (!title) {
                showAlert('Por favor ingresa un t√≠tulo', 'error');
                titleEl.focus();
                return;
            }
            
            if (!text) {
                showAlert('Por favor ingresa el texto del script', 'error');
                textEl.focus();
                return;
            }
            
            const payload = { category, title, text };
            const endpoint = currentEditingId ? `/api/scripts/${currentEditingId}` : '/api/scripts';
            const method = currentEditingId ? 'PUT' : 'POST';
            
            try {
                await apiCall(endpoint, { 
                    method, 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': 'Bearer DPI2025Admin' 
                    }, 
                    body: JSON.stringify(payload) 
                });
                
                const action = currentEditingId ? 'actualizado' : 'creado';
                showAlert(`Script ${action} exitosamente`, 'success');
                
                clearForm();
                await fetchAllData();
                renderAdminList();
                updateAdminStats();
                
            } catch (error) {
                showAlert(`Error al ${currentEditingId ? 'actualizar' : 'crear'} script: ${error.message}`, 'error');
            }
        }

        // ‚úÖ EDICI√ìN
        function editScript(id) {
            let scriptToEdit = null;
            let categoryKey = null;
            
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptToEdit = found;
                    categoryKey = category;
                    break;
                }
            }
            
            if (!scriptToEdit) {
                showAlert('Script no encontrado', 'error');
                return;
            }
            
            currentEditingId = id;
            
            const formTitle = document.getElementById('formTitle');
            const categorySelect = document.getElementById('scriptCategory');
            const titleInput = document.getElementById('scriptTitle');
            const textArea = document.getElementById('scriptText');
            
            if (formTitle) formTitle.textContent = `‚úèÔ∏è Editando: ${scriptToEdit.title}`;
            if (categorySelect) categorySelect.value = categoryKey;
            if (titleInput) titleInput.value = scriptToEdit.title;
            if (textArea) textArea.value = scriptToEdit.text;
            
            if (formTitle) {
                formTitle.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ‚úÖ ELIMINACI√ìN
        async function deleteScript(id) {
            let scriptTitle = `ID ${id}`;
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptTitle = found.title;
                    break;
                }
            }
            
            if (!confirm(`¬øEst√°s seguro de que quieres eliminar el script "${scriptTitle}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                await apiCall(`/api/scripts/${id}`, { 
                    method: 'DELETE', 
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                showAlert('Script eliminado exitosamente', 'success');
                await fetchAllData();
                renderAdminList();
                updateAdminStats();
                
            } catch (error) {
                showAlert(`Error al eliminar script: ${error.message}`, 'error');
            }
        }

        // ‚úÖ LIMPIAR FORMULARIO
        function clearForm() {
            currentEditingId = null;
            
            const form = document.getElementById('scriptForm');
            const formTitle = document.getElementById('formTitle');
            
            if (form) form.reset();
            if (formTitle) formTitle.textContent = '‚ûï Agregar Script';
            
            const alertContainer = document.getElementById('alertContainer');
            if (alertContainer) {
                alertContainer.innerHTML = '';
            }
        }

        // ‚úÖ ANALYTICS
        async function loadAnalyticsDashboard() {
            const container = document.getElementById('analyticsContainer');
            if (!container) return;
            
            container.innerHTML = '<div class="loading">Cargando analytics...</div>';
            
            try {
                const data = await apiCall('/api/analytics', { 
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                let html = '<div style="display: grid; gap: 20px;">';
                
                html += '<div><h4>üèÜ Scripts M√°s Usados (30 d√≠as)</h4>';
                if (data.topScripts && data.topScripts.length > 0) {
                    data.topScripts.forEach((script, index) => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <span>${index + 1}. ${script.title}</span>
                                <strong>${script.uses_30_days} usos</strong>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="color: #7f8c8d; font-style: italic;">No hay datos disponibles</div>';
                }
                html += '</div>';
                
                html += '<div><h4>üìä Uso por Categor√≠a (30 d√≠as)</h4>';
                if (data.categoryStats && data.categoryStats.length > 0) {
                    const categoryNames = {
                        bienvenida: "üí¨ Bienvenida", 
                        calificacion: "üîç Calificaci√≥n", 
                        objeciones: "üõ°Ô∏è Objeciones", 
                        seguimiento: "üìû Seguimiento", 
                        cierre: "üéØ Cierre"
                    };
                    
                    data.categoryStats.forEach(stat => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <span>${categoryNames[stat.category] || stat.category}</span>
                                <strong>${stat.usage_count} usos</strong>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="color: #7f8c8d; font-style: italic;">No hay datos disponibles</div>';
                }
                html += '</div></div>';
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `
                    <div class="error-message">
                        ‚ùå Error al cargar analytics: ${error.message}
                        <br><br>
                        <button onclick="loadAnalyticsDashboard()" class="copy-btn">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        // ‚úÖ ESTAD√çSTICAS ADMIN
        function updateAdminStats() {
            const statsBar = document.getElementById('statsBar');
            if (!statsBar) return;
            
            const totalScripts = SCRIPTS_DATA ? 
                Object.values(SCRIPTS_DATA).reduce((sum, category) => 
                    sum + (Array.isArray(category) ? category.length : 0), 0
                ) : 0;
            
            const lastUpdate = new Date().toLocaleTimeString();
            
            statsBar.innerHTML = `
                <div class="stats-item">
                    <span class="stats-number">${totalScripts}</span>
                    <span class="stats-label">Scripts Totales</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">${Object.keys(SCRIPTS_DATA).length}</span>
                    <span class="stats-label">Categor√≠as</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">${lastUpdate}</span>
                    <span class="stats-label">√öltima Actualizaci√≥n</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">‚úÖ</span>
                    <span class="stats-label">Estado Sistema</span>
                </div>
            `;
        }

        // ‚úÖ INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Iniciando DPI Sistema de Ventas...');
            console.log('üåê API Base URL:', API_BASE_URL);
            
            // Configurar formulario de autenticaci√≥n
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', handleAuth);
            }
            
            // Configurar b√∫squeda con debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    if (debounceTimer) {
                        clearTimeout(debounceTimer);
                    }
                    
                    debounceTimer = setTimeout(() => {
                        const query = e.target.value.trim();
                        const searchResults = document.getElementById('searchResults');
                        
                        if (query.length > 1) {
                            performSearch(query);
                        } else {
                            if (searchResults) {
                                searchResults.classList.remove('active');
                            }
                        }
                    }, 300);
                });
            }

            // Cerrar b√∫squeda al hacer click fuera
            document.addEventListener('click', (e) => {
                const searchBox = e.target.closest('.search-box');
                if (!searchBox) {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        searchResults.classList.remove('active');
                    }
                }
            });

            // Agregar listener para formulario de clientes
            const clienteForm = document.getElementById('clienteForm');
            if (clienteForm) {
                clienteForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const clienteData = {
                        nombre: document.getElementById('clienteNombre').value.trim(),
                        tipo: document.getElementById('clienteTipo').value,
                        contacto: document.getElementById('clienteContacto').value.trim(),
                        telefono: document.getElementById('clienteTelefono').value.trim(),
                        caracteristicas: document.getElementById('clienteCaracteristicas').value.trim(),
                        necesidad: document.getElementById('clienteNecesidad').value.trim(),
                        presupuesto: document.getElementById('clientePresupuesto').value,
                        urgencia: document.getElementById('clienteUrgencia').value,
                        proximosPasos: document.getElementById('clienteProximosPasos').value.trim(),
                        vendedor: document.getElementById('clienteVendedor').value.trim(),
                        fecha: document.getElementById('clienteFecha').value
                    };
                    
                    if (!clienteData.nombre || !clienteData.tipo || !clienteData.caracteristicas || !clienteData.necesidad) {
                        showAlert('Por favor completa todos los campos obligatorios', 'error');
                        return;
                    }
                    
                    try {
                        if (currentEditingClienteId) {
                            await apiCall(`/api/clientes-potenciales/${currentEditingClienteId}`, { 
                                method: 'PUT', 
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer DPI2025Admin' 
                                },
                                body: JSON.stringify(clienteData) 
                            });
                            showAlert('Perfil actualizado exitosamente', 'success');
                        } else {
                            await apiCall('/api/clientes-potenciales', { 
                                method: 'POST', 
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer DPI2025Admin' 
                                },
                                body: JSON.stringify(clienteData) 
                            });
                            showAlert('Perfil de cliente ideal agregado exitosamente', 'success');
                        }
                        
                        await cargarClientesPotenciales();
                        cerrarFormularioCliente();
                        
                    } catch (error) {
                        showAlert(`Error al guardar perfil: ${error.message}`, 'error');
                    }
                });
            }
            
            // Cargar datos iniciales
            fetchAllData();
            cargarClientesPotenciales();
            
            // Configurar monitoreo de conexi√≥n
            connectionInterval = setInterval(() => {
                updateConnectionStatus(navigator.onLine);
            }, 10000);
            
            window.addEventListener('online', () => updateConnectionStatus(true));
            window.addEventListener('offline', () => updateConnectionStatus(false));
            
            console.log('‚úÖ Sistema inicializado correctamente');
        });

        // ‚úÖ LIMPIEZA AL CERRAR
        window.addEventListener('beforeunload', () => {
            if (connectionInterval) {
                clearInterval(connectionInterval);
            }
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }
            if (window.searchController) {
                window.searchController.abort();
            }
        });
    </script>
</body>
</html>
