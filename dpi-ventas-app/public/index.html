<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPI Ventas - Sistema de Calificaci√≥n y Scripts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0FA795;
            --secondary: #8BC34A;
            --success: #00C851;
            --warning: #FFB300;
            --danger: #FF3547;
            --neutral: #6C757D;
            --light: #F8F9FA;
            --dark: #212529;
            --white: #FFFFFF;
            --border: #E9ECEF;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 4px 20px rgba(0, 0, 0, 0.12);
            --border-radius: 12px;
            --border-radius-sm: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.5;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-rows: auto 1fr;
        }

        /* HEADER */
        .header {
            background: linear-gradient(135deg, var(--primary), #0056B3);
            color: var(--white);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header-left h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .header-left p {
            opacity: 0.9;
            font-size: 14px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-stats {
            display: flex;
            gap: 30px;
            font-size: 14px;
        }

        .header-stat {
            text-align: center;
        }

        .stat-number {
            font-size: 20px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 11px;
            text-transform: uppercase;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
        }

        .search-results {
            position: absolute;
            top: calc(100% + 5px);
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-hover);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            color: var(--dark);
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            font-size: 14px;
        }

        .search-result-item:hover {
            background: var(--light);
        }

        .search-result-category {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
        }

        mark {
            background: #fff3cd;
            padding: 1px 2px;
        }



        /* MAIN LAYOUT */
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr 320px;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        /* SIDEBAR IZQUIERDA */
        .sidebar-left {
            background: var(--white);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .action-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .action-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
        }

        .action-card.semaforo::before { background: linear-gradient(180deg, var(--success), var(--warning), var(--danger)); }
        .action-card.proceso::before { background: var(--primary); }
        .action-card.scripts::before { background: var(--neutral); }
        .action-card.clientes::before { background: var(--success); }
        .action-card.admin::before { background: var(--warning); }

        .action-card.active {
            border-color: var(--primary);
            box-shadow: var(--shadow-hover);
            background: #f8fbff;
        }

        .action-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .action-icon {
            font-size: 20px;
            width: 36px;
            height: 36px;
            min-width: 36px;
            min-height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            background: var(--primary);
            flex-shrink: 0;
        }

        .semaforo .action-icon { background: linear-gradient(135deg, var(--success), var(--warning)); }
        .proceso .action-icon { background: var(--primary); }
        .scripts .action-icon { background: var(--neutral); }
        .clientes .action-icon { background: var(--success); }
        .admin .action-icon { background: var(--warning); }

        .action-content h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .action-content p {
            color: var(--neutral);
            font-size: 12px;
            line-height: 1.3;
        }

        .script-count {
            font-size: 11px;
            color: var(--neutral);
            margin-top: 8px;
            display: block;
        }

        /* √ÅREA CENTRAL */
        .content-area {
            background: var(--light);
            padding: 30px;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 25px;
        }

        .content-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .content-subtitle {
            color: var(--neutral);
            font-size: 14px;
        }

        /* WELCOME STATE */
        .welcome-state {
            text-align: center;
            padding: 60px 40px;
        }

        .welcome-icon {
            font-size: 72px;
            margin-bottom: 25px;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 12px;
        }

        .welcome-subtitle {
            color: var(--neutral);
            font-size: 16px;
            margin-bottom: 30px;
        }

        .welcome-instructions {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 25px;
            max-width: 500px;
            margin: 0 auto;
            box-shadow: var(--shadow);
        }

        .welcome-instructions h4 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .welcome-instructions p {
            color: var(--neutral);
            font-size: 14px;
            line-height: 1.6;
        }

        /* SEM√ÅFORO */
        .semaforo-view {
            display: none;
        }

        .semaforo-view.active {
            display: block;
        }

        .semaforo-warning {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
        }

        .semaforo-warning h3 {
            font-size: 18px;
            margin-bottom: 8px;
        }

        .semaforo-warning p {
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .warning-highlight {
            background: rgba(255, 255, 255, 0.15);
            padding: 10px 15px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 14px;
        }

        .semaforo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .semaforo-light {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .semaforo-light:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .semaforo-light.verde {
            border-color: var(--success);
        }

        .semaforo-light.verde:hover {
            background: linear-gradient(135deg, #f8fff8, #f0fff0);
        }

        .semaforo-light.amarillo {
            border-color: var(--warning);
        }

        .semaforo-light.amarillo:hover {
            background: linear-gradient(135deg, #fffef8, #fffacd);
        }

        .semaforo-light.rojo {
            border-color: var(--danger);
        }

        .semaforo-light.rojo:hover {
            background: linear-gradient(135deg, #fff8f8, #ffe4e1);
        }

        .light-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .light-icon {
            width: 50px;
            height: 50px;
            min-width: 50px;
            min-height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--white);
            font-weight: bold;
            flex-shrink: 0;
        }

        .verde .light-icon {
            background: var(--success);
        }

        .amarillo .light-icon {
            background: var(--warning);
        }

        .rojo .light-icon {
            background: var(--danger);
        }

        .light-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .light-action-text {
            font-size: 12px;
            font-weight: 600;
        }

        .verde .light-action-text {
            color: var(--success);
        }

        .amarillo .light-action-text {
            color: var(--warning);
        }

        .rojo .light-action-text {
            color: var(--danger);
        }

        .light-subtitle {
            color: var(--neutral);
            font-size: 13px;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .light-criteria {
            flex: 1;
        }

        .criteria-list {
            list-style: none;
            padding: 0;
        }

        .criteria-list li {
            padding: 5px 0;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark);
        }

        .verde .criteria-list li::before {
            content: '‚úÖ';
        }

        .amarillo .criteria-list li::before {
            content: '‚ö†Ô∏è';
        }

        .rojo .criteria-list li::before {
            content: '‚ùå';
        }

        .light-action {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .semaforo-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .verde .semaforo-btn {
            background: var(--success);
            color: var(--white);
        }

        .amarillo .semaforo-btn {
            background: var(--warning);
            color: var(--dark);
        }

        .rojo .semaforo-btn {
            background: var(--danger);
            color: var(--white);
        }

        .semaforo-btn:hover {
            transform: translateY(-1px);
        }

        /* PROCESO VIEW */
        .proceso-view {
            display: none;
        }

        .proceso-view.active {
            display: block;
        }

        .etapas-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .etapa-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .etapa-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }

        .etapa-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .etapa-numero {
            width: 35px;
            height: 35px;
            min-width: 35px;
            min-height: 35px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }

        .etapa-info h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .etapa-tiempo {
            font-size: 11px;
            color: var(--neutral);
            background: var(--light);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .etapa-description {
            color: var(--neutral);
            margin-bottom: 15px;
            line-height: 1.5;
            font-size: 14px;
        }

        .etapa-btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 10px 16px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .etapa-btn:hover {
            background: #0056B3;
        }

        /* SCRIPTS VIEW */
        .scripts-view {
            display: none;
        }

        .scripts-view.active {
            display: block;
        }

        .scripts-tabs {
            display: flex;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 4px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .script-tab {
            flex: 1;
            background: none;
            border: none;
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 13px;
            white-space: nowrap;
            color: var(--neutral);
        }

        .script-tab.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .scripts-grid {
            display: grid;
            gap: 20px;
        }

        .script-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .script-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .script-card.expanded {
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(15, 167, 149, 0.15);
        }

        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .script-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .script-badge {
            background: var(--primary);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .script-preview {
            color: var(--neutral);
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            white-space: pre-line;
        }

        .script-actions {
            display: flex;
            gap: 10px;
        }

        .btn-copy {
            flex: 1;
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 12px 18px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-copy:hover {
            background: #0056B3;
            transform: translateY(-1px);
        }

        .btn-copy.copied {
            background: var(--success);
        }

        .btn-expand {
            background: var(--light);
            color: var(--neutral);
            border: 1px solid var(--border);
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-expand:hover {
            background: var(--border);
            border-color: var(--neutral);
        }

        .usage-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: var(--neutral);
            margin-bottom: 15px;
        }

        /* CLIENTES VIEW */
        .clientes-view {
            display: none;
        }

        .clientes-view.active {
            display: block;
        }

        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--white);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 10px;
        }

        .view-toggle {
            display: flex;
            background: var(--light);
            border-radius: 20px;
            padding: 3px;
        }

        .view-toggle-btn {
            background: transparent;
            border: none;
            padding: 6px 12px;
            border-radius: 17px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: var(--neutral);
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 2px 8px rgba(15, 167, 149, 0.3);
        }

        .filtros-cliente {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--white);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border);
        }

        .filtro-grupo label {
            font-weight: 600;
            font-size: 12px;
            color: var(--dark);
            margin-bottom: 5px;
            display: block;
        }

        .filtro-grupo select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-size: 13px;
            background: var(--white);
        }

        .clientes-grid {
            display: grid;
            gap: 15px;
        }

        .cliente-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .cliente-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .cliente-nombre {
            font-weight: 700;
            color: var(--dark);
            font-size: 16px;
        }

        .cliente-badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .badge-smart {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-tipo {
            background: var(--primary);
            color: var(--white);
        }

        .badge-presupuesto.alto {
            background: var(--success);
            color: var(--white);
        }

        .badge-presupuesto.medio {
            background: var(--warning);
            color: var(--white);
        }

        .badge-presupuesto.bajo {
            background: var(--neutral);
            color: var(--white);
        }

        .cliente-preview {
            color: var(--neutral);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .cliente-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .action-btn.copy {
            background: var(--primary);
            color: var(--white);
        }

        .action-btn.edit {
            background: var(--warning);
            color: var(--white);
        }

        .action-btn.delete {
            background: var(--danger);
            color: var(--white);
        }

        /* FORMULARIO CLIENTE */
        .formulario-cliente {
            background: var(--white);
            border: 2px solid var(--primary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-hover);
            display: none;
        }

        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .form-header h4 {
            margin: 0;
            color: var(--primary);
            font-size: 18px;
        }

        .cerrar-form-btn {
            background: var(--danger);
            color: var(--white);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
            font-size: 13px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .guardar-cliente-btn {
            background: var(--success);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cancelar-btn {
            background: var(--neutral);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        /* ADMIN VIEW */
        .admin-view {
            display: none;
        }

        .admin-view.active {
            display: block;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .admin-form {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .admin-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 8px;
        }

        .admin-btn.success {
            background: var(--success);
            color: var(--white);
        }

        .admin-btn.danger {
            background: var(--danger);
            color: var(--white);
        }

        /* SIDEBAR DERECHA */
        .sidebar-right {
            background: var(--white);
            border-left: 1px solid var(--border);
            padding: 30px 20px;
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            padding: 20px;
            color: var(--white);
            margin-bottom: 20px;
        }

        .stats-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .quick-decision {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 15px;
        }

        .quick-decision h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .quick-decision p {
            color: var(--neutral);
            font-size: 12px;
            line-height: 1.4;
        }

        /* TOAST */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--dark);
            color: var(--white);
            padding: 16px 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-hover);
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 200;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success { background: var(--success); }
        .toast.warning { background: var(--warning); color: var(--dark); }
        .toast.error { background: var(--danger); }

        .toast-icon { font-size: 18px; }

        /* MODALS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 20px;
        }

        .modal p {
            color: var(--neutral);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .modal-btn.primary {
            background: var(--primary);
            color: var(--white);
        }

        .modal-btn.primary:hover {
            background: #0056B3;
        }

        .modal-btn.danger {
            background: var(--danger);
            color: var(--white);
        }

        .modal-btn.danger:hover {
            background: #dc1f2f;
        }

        .modal-btn.secondary {
            background: var(--light);
            color: var(--neutral);
            border: 1px solid var(--border);
        }

        .modal-btn.secondary:hover {
            background: var(--border);
        }

        /* AUTH MODAL ESPEC√çFICO */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .auth-overlay.active {
            display: flex;
        }

        .auth-modal {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        .auth-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
        }

        .auth-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
            font-size: 14px;
        }

        /* LOADING */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: var(--neutral);
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 280px 1fr 280px;
            }
            
            .header-stats {
                display: none;
            }
            
            .search-box {
                width: 250px;
            }
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar-left {
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 20px;
                overflow-x: auto;
            }
            
            .action-cards {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .sidebar-right {
                display: none;
            }
            
            .semaforo-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .etapas-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-controls {
                grid-template-columns: 1fr;
            }
        }

        /* ANIMATIONS */
        @keyframes slideInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-in {
            animation: slideInUp 0.4s ease-out;
        }

        /* HIDDEN */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">


        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <h1>üéØ DPI Ventas</h1>
                <p>Sistema de Calificaci√≥n y Scripts de Venta</p>
            </div>
            <div class="header-right">
                <div class="header-stats">
                    <div class="header-stat">
                        <span class="stat-number" id="systemStatusIcon">‚úÖ</span>
                        <span class="stat-label">Sistema activo</span>
                    </div>
                    <div class="header-stat">
                        <span class="stat-number" id="scriptCount">0</span>
                        <span class="stat-label">Scripts disponibles</span>
                    </div>
                    <div class="header-stat">
                        <span class="stat-number" id="currentTime">--:--</span>
                        <span class="stat-label">Actualizado</span>
                    </div>
                </div>
                <div class="search-box">
                    <div class="search-icon">üîç</div>
                    <input type="text" class="search-input" placeholder="Buscar scripts..." id="searchInput">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- SIDEBAR IZQUIERDA -->
            <div class="sidebar-left">
                <h3 class="sidebar-title">üéØ Herramientas de Venta</h3>
                <div class="action-cards">
                    <div class="action-card semaforo active" onclick="showView('semaforo')" id="card-semaforo">
                        <div class="action-header">
                            <div class="action-icon">üö¶</div>
                            <div class="action-content">
                                <h3>Sem√°foro de Calificaci√≥n</h3>
                                <p>¬øEl prospecto est√° listo para cotizar?</p>
                            </div>
                        </div>
                        <span class="script-count">Eval√∫a antes de cotizar</span>
                    </div>

                    <div class="action-card proceso" onclick="showView('proceso')" id="card-proceso">
                        <div class="action-header">
                            <div class="action-icon">üìã</div>
                            <div class="action-content">
                                <h3>Proceso de Calificaci√≥n</h3>
                                <p>4 etapas para evaluar correctamente</p>
                            </div>
                        </div>
                        <span class="script-count">Gu√≠a paso a paso</span>
                    </div>

                    <div class="action-card scripts" onclick="showView('scripts')" id="card-scripts">
                        <div class="action-header">
                            <div class="action-icon">üìù</div>
                            <div class="action-content">
                                <h3>Scripts por Situaci√≥n</h3>
                                <p>Scripts probados para cada momento</p>
                            </div>
                        </div>
                        <span class="script-count" id="scriptsCount">Cargando...</span>
                    </div>

                    <div class="action-card clientes" onclick="showView('clientes')" id="card-clientes">
                        <div class="action-header">
                            <div class="action-icon">üë•</div>
                            <div class="action-content">
                                <h3>Clientes Ideales</h3>
                                <p>Perfiles documentados del equipo</p>
                            </div>
                        </div>
                        <span class="script-count" id="clientesCount">Cargando...</span>
                    </div>

                    <div class="action-card admin" onclick="switchMode('admin')" id="card-admin">
                        <div class="action-header">
                            <div class="action-icon">‚öôÔ∏è</div>
                            <div class="action-content">
                                <h3>Panel Administrativo</h3>
                                <p>Gesti√≥n completa del sistema</p>
                            </div>
                        </div>
                        <span class="script-count">Acceso restringido</span>
                    </div>
                </div>
            </div>

            <!-- √ÅREA CENTRAL -->
            <div class="content-area">
                <!-- WELCOME STATE -->
                <div class="welcome-state" id="welcomeState" style="display: none;">
                    <div class="welcome-icon">üéØ</div>
                    <h2 class="welcome-title">Sistema de Calificaci√≥n DPI</h2>
                    <p class="welcome-subtitle">Eval√∫a a tus prospectos antes de invertir tiempo en cotizaciones</p>
                    <div class="welcome-instructions">
                        <h4>üö¶ Flujo de Calificaci√≥n:</h4>
                        <p>
                            1. <strong>Eval√∫a</strong> al prospecto con el sem√°foro<br>
                            2. <strong>Solo cotiza</strong> cuando est√© en VERDE<br>
                            3. <strong>Usa scripts</strong> espec√≠ficos por situaci√≥n<br>
                            4. <strong>Mant√©n</strong> consistencia en el equipo
                        </p>
                    </div>
                </div>

                <!-- SEM√ÅFORO VIEW -->
                <div class="semaforo-view active" id="semaforoView">
                    <div class="content-header">
                        <h2 class="content-title">üö¶ Sem√°foro de Calificaci√≥n</h2>
                        <p class="content-subtitle">Eval√∫a al prospecto antes de invertir tiempo en cotizaci√≥n formal</p>
                    </div>

                    <div class="semaforo-warning">
                        <h3>‚ö†Ô∏è REGLA DE ORO</h3>
                        <p>Solo invierte tiempo en cotizaci√≥n cuando el sem√°foro est√© en VERDE</p>
                        <div class="warning-highlight">
                            Evita las "cotizaciones fantasma" ‚Ä¢ Mant√©n consistencia en el equipo
                        </div>
                    </div>

                    <div class="semaforo-grid">
                        <!-- LUZ VERDE -->
                        <div class="semaforo-light verde" onclick="handleSemaforo('verde')">
                            <div class="light-header">
                                <div class="light-icon">üü¢</div>
                                <div>
                                    <div class="light-title">LUZ VERDE</div>
                                    <div class="light-action-text">‚úÖ COTIZAR AHORA</div>
                                </div>
                            </div>
                            
                            <div class="light-subtitle">
                                El cliente est√° listo. Invierte tu tiempo en la cotizaci√≥n.
                            </div>
                            
                            <div class="light-criteria">
                                <ul class="criteria-list">
                                    <li>Entendimos su "porqu√© real"</li>
                                    <li>Validamos su presupuesto</li>
                                    <li>Confirm√≥ inter√©s genuino</li>
                                    <li>El decisor est√° involucrado</li>
                                    <li>Timeline definido</li>
                                </ul>
                            </div>
                            
                            <div class="light-action">
                                <button class="semaforo-btn">üéØ Scripts de Cierre</button>
                            </div>
                        </div>

                        <!-- LUZ AMARILLA -->
                        <div class="semaforo-light amarillo" onclick="handleSemaforo('amarillo')">
                            <div class="light-header">
                                <div class="light-icon">üü°</div>
                                <div>
                                    <div class="light-title">LUZ AMARILLA</div>
                                    <div class="light-action-text">‚ö†Ô∏è INVESTIGAR M√ÅS</div>
                                </div>
                            </div>
                            
                            <div class="light-subtitle">
                                Necesitas m√°s informaci√≥n. Pregunta, no propongas todav√≠a.
                            </div>
                            
                            <div class="light-criteria">
                                <ul class="criteria-list">
                                    <li>Habla solo de precio</li>
                                    <li>No tiene claro el objetivo</li>
                                    <li>Pide "ideas" sin contexto</li>
                                    <li>No es el decisor final</li>
                                    <li>Timeline vago</li>
                                </ul>
                            </div>
                            
                            <div class="light-action">
                                <button class="semaforo-btn">üîç Scripts de Calificaci√≥n</button>
                            </div>
                        </div>

                        <!-- LUZ ROJA -->
                        <div class="semaforo-light rojo" onclick="handleSemaforo('rojo')">
                            <div class="light-header">
                                <div class="light-icon">üî¥</div>
                                <div>
                                    <div class="light-title">LUZ ROJA</div>
                                    <div class="light-action-text">‚ùå PAUSAR PROCESO</div>
                                </div>
                            </div>
                            
                            <div class="light-subtitle">
                                Alto riesgo de cotizaci√≥n fantasma. No inviertas tiempo aqu√≠.
                            </div>
                            
                            <div class="light-criteria">
                                <ul class="criteria-list">
                                    <li>"Solo para tener una idea"</li>
                                    <li>Sin presupuesto ni urgencia</li>
                                    <li>No responde preguntas clave</li>
                                    <li>"Env√≠eme lo que tengas"</li>
                                    <li>Evade dar informaci√≥n</li>
                                </ul>
                            </div>
                            
                            <div class="light-action">
                                <button class="semaforo-btn">üìû Scripts B√°sicos</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PROCESO VIEW -->
                <div class="proceso-view" id="procesoView">
                    <div class="content-header">
                        <h2 class="content-title">üìã Proceso de Calificaci√≥n</h2>
                        <p class="content-subtitle">4 etapas para evaluar correctamente a cualquier prospecto</p>
                    </div>

                    <div class="etapas-grid">
                        <div class="etapa-card">
                            <div class="etapa-header">
                                <div class="etapa-numero">1</div>
                                <div class="etapa-info">
                                    <h4>üé¨ Apertura & Rapport</h4>
                                    <span class="etapa-tiempo">2-3 minutos</span>
                                </div>
                            </div>
                            <div class="etapa-description">
                                Generar confianza y entender la situaci√≥n general del prospecto. Establecer una base para la conversaci√≥n.
                            </div>
                            <button class="etapa-btn" onclick="showScriptsTab('bienvenida')">Ver Scripts de Apertura</button>
                        </div>

                        <div class="etapa-card">
                            <div class="etapa-header">
                                <div class="etapa-numero">2</div>
                                <div class="etapa-info">
                                    <h4>üîç Investigaci√≥n</h4>
                                    <span class="etapa-tiempo">5-7 minutos</span>
                                </div>
                            </div>
                            <div class="etapa-description">
                                Entender el PORQU√â real detr√°s de su necesidad. Esta es la etapa m√°s importante del proceso.
                            </div>
                            <button class="etapa-btn" onclick="showScriptsTab('calificacion')">Ver Scripts de Investigaci√≥n</button>
                        </div>

                        <div class="etapa-card">
                            <div class="etapa-header">
                                <div class="etapa-numero">3</div>
                                <div class="etapa-info">
                                    <h4>üí∞ Presupuesto & Decisi√≥n</h4>
                                    <span class="etapa-tiempo">3-5 minutos</span>
                                </div>
                            </div>
                            <div class="etapa-description">
                                Validar presupuesto real y proceso de decisi√≥n. Identificar qui√©n autoriza la compra.
                            </div>
                            <button class="etapa-btn" onclick="showScriptsTab('calificacion')">Ver Scripts de Presupuesto</button>
                        </div>

                        <div class="etapa-card">
                            <div class="etapa-header">
                                <div class="etapa-numero">4</div>
                                <div class="etapa-info">
                                    <h4>üéØ Evaluaci√≥n</h4>
                                    <span class="etapa-tiempo">2-3 minutos</span>
                                </div>
                            </div>
                            <div class="etapa-description">
                                Determinar el color del sem√°foro y definir pr√≥ximos pasos seg√∫n la evaluaci√≥n.
                            </div>
                            <button class="etapa-btn" onclick="showView('semaforo')">Ir al Sem√°foro</button>
                        </div>
                    </div>
                </div>

                <!-- SCRIPTS VIEW -->
                <div class="scripts-view" id="scriptsView">
                    <div class="content-header">
                        <h2 class="content-title">üìù Scripts por Situaci√≥n</h2>
                        <p class="content-subtitle">Scripts probados y validados para cada momento del proceso de venta</p>
                    </div>

                    <div class="scripts-tabs" id="scriptsTabs">
                        <!-- Tabs se cargan din√°micamente -->
                    </div>

                    <div class="scripts-grid" id="scriptsGrid">
                        <div class="loading">Cargando scripts...</div>
                    </div>
                </div>

                <!-- CLIENTES VIEW -->
                <div class="clientes-view" id="clientesView">
                    <div class="content-header">
                        <h2 class="content-title">üë• Clientes Ideales</h2>
                        <p class="content-subtitle">Perfiles documentados de clientes exitosos del equipo</p>
                    </div>

                    <div class="view-controls">
                        <div class="view-toggle">
                            <button class="view-toggle-btn active" onclick="cambiarVista('cards')" id="cardsViewBtn">
                                üìã Tarjetas
                            </button>
                            <button class="view-toggle-btn" onclick="cambiarVista('list')" id="listViewBtn">
                                üìÉ Lista
                            </button>
                        </div>
                        
                        <button class="action-btn copy" onclick="abrirFormularioCliente()">‚ûï Agregar Perfil</button>
                    </div>

                    <div class="filtros-cliente">
                        <div class="filtro-grupo">
                            <label>üè¢ Sector:</label>
                            <select id="filtroTipo" onchange="filtrarPerfiles()">
                                <option value="">Todos los sectores</option>
                                <option value="restaurante">üçΩÔ∏è Restaurantes</option>
                                <option value="retail">üè™ Retail/Tiendas</option>
                                <option value="servicios">üíº Servicios</option>
                                <option value="clinica">üè• Cl√≠nicas</option>
                                <option value="empresa">üè¢ Empresas</option>
                                <option value="otro">üìã Otros</option>
                            </select>
                        </div>
                        <div class="filtro-grupo">
                            <label>üí∞ Presupuesto:</label>
                            <select id="filtroPresupuesto" onchange="filtrarPerfiles()">
                                <option value="">Todos los rangos</option>
                                <option value="bajo">üíµ Bajo ($500-$2K)</option>
                                <option value="medio">üí¥ Medio ($2K-$5K)</option>
                                <option value="alto">üí∏ Alto ($5K+)</option>
                            </select>
                        </div>
                        <div class="filtro-grupo">
                            <label>‚ö° Decisi√≥n:</label>
                            <select id="filtroUrgencia" onchange="filtrarPerfiles()">
                                <option value="">Todos los tipos</option>
                                <option value="alta">üöÄ Decisi√≥n R√°pida</option>
                                <option value="media">‚è≥ Decisi√≥n Normal</option>
                                <option value="baja">ü§î Planifican Mucho</option>
                            </select>
                        </div>
                    </div>

                    <!-- Formulario para agregar cliente -->
                    <div class="formulario-cliente" id="formularioCliente">
                        <div class="form-header">
                            <h4 id="tituloFormulario">‚ûï Agregar Nuevo Perfil de Cliente Ideal</h4>
                            <button class="cerrar-form-btn" onclick="cerrarFormularioCliente()">‚úñÔ∏è</button>
                        </div>
                        <form id="clienteForm">
                            <input type="hidden" id="clienteId" value="">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombre del Perfil</label>
                                    <input type="text" id="clienteNombre" required placeholder="Ej: Restaurante Familiar Exitoso">
                                </div>
                                <div class="form-group">
                                    <label>Tipo de Negocio</label>
                                    <select id="clienteTipo" required>
                                        <option value="">Seleccionar tipo</option>
                                        <option value="restaurante">Restaurante/Bar</option>
                                        <option value="retail">Tienda/Retail</option>
                                        <option value="servicios">Servicios Profesionales</option>
                                        <option value="clinica">Cl√≠nica/Consultorio</option>
                                        <option value="empresa">Empresa/Corporativo</option>
                                        <option value="otro">Otro</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Contacto T√≠pico</label>
                                    <input type="text" id="clienteContacto" placeholder="Ej: Due√±o/Gerente">
                                </div>
                                <div class="form-group">
                                    <label>Ubicaci√≥n/Zona</label>
                                    <input type="text" id="clienteTelefono" placeholder="Ej: Zona comercial">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Caracter√≠sticas IDEALES</label>
                                <textarea id="clienteCaracteristicas" required placeholder="Ej: Negocio establecido, entienden el valor, toman decisiones r√°pidas..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Publicidad que necesitan</label>
                                <textarea id="clienteNecesidad" required placeholder="Ej: R√≥tulo de fachada, material POP, banners..."></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Presupuesto T√≠pico</label>
                                    <select id="clientePresupuesto">
                                        <option value="">No especificado</option>
                                        <option value="bajo">Bajo ($500 - $2,000)</option>
                                        <option value="medio">Medio ($2,000 - $5,000)</option>
                                        <option value="alto">Alto ($5,000+)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ciclo de Decisi√≥n</label>
                                    <select id="clienteUrgencia">
                                        <option value="">No especificado</option>
                                        <option value="baja">Lento (Planifican)</option>
                                        <option value="media">Normal (1-2 meses)</option>
                                        <option value="alta">R√°pido (Deciden pronto)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Estrategias de Approach</label>
                                <textarea id="clienteProximosPasos" placeholder="Ej: Mostrar portfolio similar, enfocarse en calidad..."></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Vendedor</label>
                                    <input type="text" id="clienteVendedor" placeholder="Nombre del vendedor">
                                </div>
                                <div class="form-group">
                                    <label>Fecha</label>
                                    <input type="date" id="clienteFecha">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="guardar-cliente-btn">üíæ Guardar Perfil</button>
                                <button type="button" class="cancelar-btn" onclick="cerrarFormularioCliente()">‚ùå Cancelar</button>
                            </div>
                        </form>
                    </div>

                    <div class="clientes-grid" id="clientesGrid">
                        <div class="loading">Cargando perfiles...</div>
                    </div>
                </div>

                <!-- ADMIN VIEW -->
                <div class="admin-view" id="adminView">
                    <div class="content-header">
                        <h2 class="content-title">‚öôÔ∏è Panel Administrativo</h2>
                        <p class="content-subtitle">Gesti√≥n completa del sistema de ventas</p>
                    </div>

                    <div class="admin-controls">
                        <div class="admin-form">
                            <h3 id="formTitle">‚ûï Agregar Script</h3>
                            <form id="scriptForm">
                                <div class="form-group">
                                    <label>Categor√≠a</label>
                                    <select id="scriptCategory" required>
                                        <option value="">Seleccionar categor√≠a</option>
                                        <option value="bienvenida">üí¨ Bienvenida</option>
                                        <option value="calificacion">üîç Calificaci√≥n</option>
                                        <option value="objeciones">üõ°Ô∏è Objeciones</option>
                                        <option value="seguimiento">üìû Seguimiento</option>
                                        <option value="cierre">üéØ Cierre</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="scriptTitle" required placeholder="T√≠tulo del script">
                                </div>
                                <div class="form-group">
                                    <label>Texto</label>
                                    <textarea id="scriptText" required placeholder="Contenido del script"></textarea>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="admin-btn success">üíæ Guardar</button>
                                    <button type="button" class="admin-btn danger" onclick="clearForm()">üóëÔ∏è Limpiar</button>
                                </div>
                            </form>
                        </div>

                        <div class="admin-form">
                            <h3>üìù Scripts Existentes</h3>
                            <div class="form-group">
                                <label>Filtrar por categor√≠a</label>
                                <select id="filterCategory" onchange="renderAdminList()">
                                    <option value="all">Todas las categor√≠as</option>
                                    <option value="bienvenida">üí¨ Bienvenida</option>
                                    <option value="calificacion">üîç Calificaci√≥n</option>
                                    <option value="objeciones">üõ°Ô∏è Objeciones</option>
                                    <option value="seguimiento">üìû Seguimiento</option>
                                    <option value="cierre">üéØ Cierre</option>
                                </select>
                            </div>
                            <div id="scriptsList" style="max-height: 300px; overflow-y: auto;">
                                <div class="loading">Cargando scripts...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR DERECHA -->
            <div class="sidebar-right">
                <!-- TIPS -->
                <div class="sidebar-section">
                    <div class="stats-card">
                        <div class="stats-title">üí° Tip Dale Carnegie</div>
                        <div style="text-align: left;">
                            <h4 style="margin-bottom: 10px; font-size: 14px;">"Muestra inter√©s genuino en la otra persona"</h4>
                            <p style="font-size: 12px; line-height: 1.4; opacity: 0.9;">
                                Antes de hablar de tu producto, pregunta sobre su negocio. La gente compra de quien se preocupa por ellos.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ACTIVIDAD -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">üìä Actividad del Equipo</h3>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--border-radius); border: 1px solid var(--border);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div style="text-align: center;">
                                <div style="font-size: 18px; font-weight: 700; color: var(--primary);" id="usageToday">0</div>
                                <div style="font-size: 10px; color: var(--neutral);">Scripts copiados hoy</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 18px; font-weight: 700; color: var(--success);">üü¢</div>
                                <div style="font-size: 10px; color: var(--neutral);">Sistema activo</div>
                            </div>
                        </div>
                        <div style="text-align: center; padding-top: 10px; border-top: 1px solid var(--border);">
                            <div style="font-size: 11px; color: var(--neutral);">
                                üí™ El equipo est√° activo vendiendo
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RECORDATORIO -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">‚ö° Recordatorio</h3>
                    <div class="quick-decision">
                        <h4>üö¶ Regla de Oro</h4>
                        <p>Solo cotiza cuando el sem√°foro est√© en <strong style="color: var(--success);">VERDE üü¢</strong>. Ahorra tiempo y energ√≠a para prospectos reales.</p>
                    </div>
                </div>

                <!-- T√âCNICA DEL D√çA -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">üéØ T√©cnica del D√≠a</h3>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--border-radius); border-left: 4px solid var(--warning);">
                        <h4 style="color: var(--warning); margin-bottom: 8px; font-size: 14px;">La Regla del 70/30</h4>
                        <p style="font-size: 12px; color: var(--neutral); line-height: 1.4;">
                            Habla solo 30% del tiempo. El otro 70% escucha y haz preguntas. Los mejores vendedores son los mejores oyentes.
                        </p>
                    </div>
                </div>

                <!-- MOTIVACI√ìN -->
                <div class="sidebar-section">
                    <div style="background: linear-gradient(135deg, var(--success), #20c997); color: var(--white); padding: 15px; border-radius: var(--border-radius); text-align: center;">
                        <div style="font-size: 16px; margin-bottom: 5px;">üí™</div>
                        <div style="font-size: 12px; font-weight: 600; line-height: 1.3;">
                            "Cada NO te acerca m√°s al S√ç"
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TOAST -->
        <div class="toast" id="toast">
            <span class="toast-icon">‚úÖ</span>
            <span class="toast-text">Informaci√≥n actualizada</span>
        </div>

        <!-- MODAL PERSONALIZADO -->
        <div class="modal-overlay" id="modalOverlay">
            <div class="modal">
                <h3 id="modalTitle">Confirmar Acci√≥n</h3>
                <p id="modalMessage">¬øEst√°s seguro de que quieres realizar esta acci√≥n?</p>
                <div class="modal-actions">
                    <button class="modal-btn secondary" onclick="closeModal()">Cancelar</button>
                    <button class="modal-btn primary" id="modalConfirmBtn" onclick="confirmModal()">Aceptar</button>
                </div>
            </div>
        </div>

        <!-- AUTH OVERLAY -->
        <div class="auth-overlay" id="authOverlay">
            <div class="auth-modal">
                <h2>üîê Acceso Administrativo</h2>
                <p>Ingresa tus credenciales para continuar</p>
                <div id="authError" class="auth-error">Usuario o Contrase√±a incorrectos</div>
                <form id="authForm">
                    <input type="text" id="authUsername" class="auth-input" placeholder="Usuario" required>
                    <input type="password" id="authPassword" class="auth-input" placeholder="Contrase√±a" required>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="admin-btn success">Ingresar</button>
                        <button type="button" class="admin-btn danger" onclick="cancelAuth()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN
        const API_BASE_URL = 'https://scripts-ventas-dpi.up.railway.app';
        
        let SCRIPTS_DATA = {};
        let CLIENTES_POTENCIALES = [];
        let currentEditingId = null;
        let currentEditingClienteId = null;
        let isAuthenticated = false;
        let debounceTimer = null;
        let currentView = 'semaforo';
        let currentScriptTab = 'bienvenida';
        let currentClienteView = 'cards';
        let modalCallback = null;

        // INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Iniciando DPI Sistema de Ventas...');
            
            // Event listeners
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            document.getElementById('scriptForm').addEventListener('submit', handleAdminFormSubmit);
            document.getElementById('clienteForm').addEventListener('submit', handleClienteFormSubmit);
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', handleSearch);
            
            // Cerrar b√∫squeda al hacer click fuera
            document.addEventListener('click', (e) => {
                const searchBox = e.target.closest('.search-box');
                if (!searchBox) {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        searchResults.classList.remove('active');
                    }
                }
            });
            
            // Inicializar estado
            updateTime();
            setInterval(updateTime, 60000);
            
            // Cargar datos iniciales despu√©s de un peque√±o delay
            setTimeout(() => {
                fetchAllData();
                cargarClientesPotenciales();
            }, 500);
            
            console.log('‚úÖ Sistema inicializado correctamente');
        });

        // MODAL PERSONALIZADO
        function showModal(title, message, type = 'confirm', callback = null) {
            const overlay = document.getElementById('modalOverlay');
            const titleEl = document.getElementById('modalTitle');
            const messageEl = document.getElementById('modalMessage');
            const confirmBtn = document.getElementById('modalConfirmBtn');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Configurar bot√≥n seg√∫n el tipo
            if (type === 'danger') {
                confirmBtn.className = 'modal-btn danger';
                confirmBtn.textContent = 'Eliminar';
            } else {
                confirmBtn.className = 'modal-btn primary';
                confirmBtn.textContent = 'Aceptar';
            }
            
            modalCallback = callback;
            overlay.classList.add('active');
        }

        function closeModal() {
            const overlay = document.getElementById('modalOverlay');
            overlay.classList.remove('active');
            modalCallback = null;
        }

        function confirmModal() {
            closeModal();
            if (modalCallback) {
                modalCallback();
            }
        }

        // ACTUALIZAR TIEMPO
        function updateTime() {
            const timeEl = document.getElementById('currentTime');
            if (timeEl) {
                timeEl.textContent = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            }
        }

        // AUTENTICACI√ìN
        function handleAuth(e) {
            e.preventDefault();
            
            const username = document.getElementById('authUsername')?.value;
            const password = document.getElementById('authPassword')?.value;
            const errorEl = document.getElementById('authError');
            
            if (!username || !password) {
                if (errorEl) {
                    errorEl.textContent = 'Por favor ingresa usuario y contrase√±a';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            if (username === 'admin' && password === 'DPI2025Admin') {
                isAuthenticated = true;
                
                const overlay = document.getElementById('authOverlay');
                if (overlay) overlay.classList.remove('active');
                
                showView('admin');
                
                const form = document.getElementById('authForm');
                if (form) form.reset();
                if (errorEl) errorEl.style.display = 'none';
                
                showToast('‚úÖ Acceso administrativo concedido', 'success');
            } else {
                if (errorEl) {
                    errorEl.textContent = 'Usuario o contrase√±a incorrectos';
                    errorEl.style.display = 'block';
                }
            }
        }

        function cancelAuth() {
            const overlay = document.getElementById('authOverlay');
            if (overlay) overlay.classList.remove('active');
            
            const form = document.getElementById('authForm');
            if (form) form.reset();
            
            const errorEl = document.getElementById('authError');
            if (errorEl) errorEl.style.display = 'none';
        }

        function showAuthModal() {
            const overlay = document.getElementById('authOverlay');
            if (!overlay) {
                showToast('‚ùå Error: Modal de autenticaci√≥n no disponible', 'error');
                return;
            }
            
            overlay.classList.add('active');
            
            setTimeout(() => {
                const usernameInput = document.getElementById('authUsername');
                if (usernameInput) {
                    usernameInput.focus();
                }
            }, 100);
        }

        // SWITCH MODE
        function switchMode(mode) {
            if (mode === 'admin' && !isAuthenticated) { 
                showAuthModal(); 
                return; 
            }
            
            if (mode === 'admin') {
                showView('admin');
            } else if (mode === 'ventas') {
                showView('semaforo');
            }
        }

        // LLAMADAS A API
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                // Actualizar estado del sistema
                updateSystemStatus(true);
                
                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                    } catch {
                        errorData = { error: `Error HTTP: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Error HTTP: ${response.status}`);
                }
                
                const contentType = response.headers.get("content-type");
                if (contentType?.includes("application/json")) {
                    return await response.json();
                } else {
                    return await response.blob();
                }
            } catch (error) {
                console.error('‚ùå Error en API call:', error);
                updateSystemStatus(false);
                throw error;
            }
        }

        function updateSystemStatus(isOnline) {
            const statusIcon = document.getElementById('systemStatusIcon');
            
            if (statusIcon) {
                if (isOnline) {
                    statusIcon.textContent = '‚úÖ';
                    statusIcon.style.color = 'var(--success)';
                } else {
                    statusIcon.textContent = '‚ùå';
                    statusIcon.style.color = 'var(--danger)';
                }
            }
        }

        // CARGA DE DATOS
        async function fetchAllData() {
            console.log('üîÑ Iniciando carga de scripts...');
            
            try {
                showToast('üîÑ Cargando scripts...', 'default');
                const data = await apiCall('/api/scripts');
                
                // Verificar que data es un objeto v√°lido
                if (data && typeof data === 'object') {
                    SCRIPTS_DATA = data;
                    console.log('‚úÖ Scripts cargados exitosamente:', Object.keys(SCRIPTS_DATA));
                    
                    // Solo renderizar si estamos en la vista de scripts
                    if (currentView === 'scripts') {
                        setTimeout(() => renderScripts(), 100);
                    }
                    
                    updateStats();
                    showToast('‚úÖ Scripts cargados exitosamente', 'success');
                } else {
                    throw new Error('Datos inv√°lidos recibidos del servidor');
                }
                
            } catch (error) {
                console.error('‚ùå Error al cargar scripts:', error);
                
                // Inicializar con estructura vac√≠a para evitar errores
                SCRIPTS_DATA = {
                    bienvenida: [],
                    calificacion: [],
                    objeciones: [],
                    seguimiento: [],
                    cierre: []
                };
                
                // Solo renderizar si estamos en la vista de scripts
                if (currentView === 'scripts') {
                    setTimeout(() => renderScripts(), 100);
                }
                
                updateStats();
                showToast('‚ùå Error al cargar scripts. Usando modo offline.', 'error');
            }
        }

        async function cargarClientesPotenciales() {
            console.log('üîÑ Cargando clientes potenciales...');
            
            try {
                const data = await apiCall('/api/clientes-potenciales');
                
                if (Array.isArray(data)) {
                    CLIENTES_POTENCIALES = data;
                    console.log('‚úÖ Clientes cargados:', CLIENTES_POTENCIALES.length);
                    
                    // Solo renderizar si estamos en la vista de clientes
                    if (currentView === 'clientes') {
                        setTimeout(() => renderClientes(), 100);
                    }
                    
                    updateClientesCount();
                } else {
                    throw new Error('Datos de clientes inv√°lidos');
                }
                
            } catch (error) {
                console.error('‚ùå Error al cargar clientes:', error);
                CLIENTES_POTENCIALES = [];
                
                // Solo renderizar si estamos en la vista de clientes
                if (currentView === 'clientes') {
                    setTimeout(() => renderClientes(), 100);
                }
                
                updateClientesCount();
                showToast('‚ùå Error al cargar perfiles de clientes', 'error');
            }
        }

        // NAVEGACI√ìN
        function showView(view) {
            console.log('üéØ Navegando a vista:', view);
            
            // Actualizar navegaci√≥n (excepto para admin)
            if (view !== 'admin') {
                document.querySelectorAll('.action-card').forEach(card => card.classList.remove('active'));
                const cardElement = document.getElementById(`card-${view}`);
                if (cardElement) {
                    cardElement.classList.add('active');
                }
            }
            
            // Ocultar todas las vistas
            document.querySelectorAll('.welcome-state, .semaforo-view, .proceso-view, .scripts-view, .clientes-view, .admin-view').forEach(v => {
                v.classList.remove('active');
                v.style.display = 'none';
            });
            
            // Mostrar vista seleccionada
            const viewElement = document.getElementById(`${view}View`);
            if (viewElement) {
                viewElement.style.display = 'block';
                viewElement.classList.add('active');
            }
            
            currentView = view;
            
            // Cargar datos espec√≠ficos SOLO si es necesario y no estamos ya en esa vista
            if (view === 'scripts' && Object.keys(SCRIPTS_DATA).length > 0) {
                setTimeout(() => renderScripts(), 100);
            } else if (view === 'clientes' && CLIENTES_POTENCIALES.length > 0) {
                setTimeout(() => renderClientes(), 100);
            } else if (view === 'admin') {
                setTimeout(() => renderAdminList(), 100);
            }
        }

        // SEM√ÅFORO
        function handleSemaforo(color) {
            const messages = {
                verde: 'üü¢ Cliente LISTO para cotizar ‚Üí Procede con confianza',
                amarillo: 'üü° Necesita M√ÅS CALIFICACI√ìN ‚Üí Usa scripts de investigaci√≥n',
                rojo: 'üî¥ NO cotizar ‚Üí Invierte tiempo en otros leads'
            };
            
            showToast(messages[color], color === 'verde' ? 'success' : color === 'amarillo' ? 'warning' : 'error');
            
            const scriptMap = {
                verde: 'cierre',
                amarillo: 'calificacion', 
                rojo: 'bienvenida'
            };
            
            setTimeout(() => {
                showView('scripts');
                showScriptsTab(scriptMap[color]);
            }, 2000);
        }

        // SCRIPTS
        function renderScripts() {
            console.log('üìù Renderizando scripts...');
            
            const tabsContainer = document.getElementById('scriptsTabs');
            const scriptsContainer = document.getElementById('scriptsGrid');
            
            if (!tabsContainer || !scriptsContainer) {
                console.warn('‚ö†Ô∏è Contenedores de scripts no encontrados');
                return;
            }
            
            // Verificar si ya se han renderizado los tabs para evitar re-renderizado
            if (tabsContainer.children.length === 0) {
                // Crear tabs solo si no existen
                const categoryNames = {
                    bienvenida: "üí¨ Bienvenida", 
                    calificacion: "üîç Calificaci√≥n", 
                    objeciones: "üõ°Ô∏è Objeciones", 
                    seguimiento: "üìû Seguimiento", 
                    cierre: "üéØ Cierre"
                };
                
                Object.keys(categoryNames).forEach((category, index) => {
                    const tab = document.createElement('button');
                    tab.className = `script-tab ${index === 0 ? 'active' : ''}`;
                    tab.textContent = categoryNames[category];
                    tab.setAttribute('data-category', category);
                    
                    // Usar addEventListener en lugar de onclick para evitar problemas
                    tab.addEventListener('click', () => {
                        showScriptsTab(category);
                    });
                    
                    tabsContainer.appendChild(tab);
                });
            }
            
            // Solo mostrar la primera categor√≠a si no hay una ya seleccionada
            if (scriptsContainer.innerHTML.includes('Cargando scripts...')) {
                showScriptsTabContent('bienvenida');
            }
        }

        function showScriptsTab(category) {
            console.log('üìÇ Cambiando a tab:', category);
            
            // Actualizar tabs activos
            document.querySelectorAll('.script-tab').forEach(t => t.classList.remove('active'));
            
            // Activar tab correcto
            const activeTab = document.querySelector(`[data-category="${category}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Mostrar contenido del tab
            showScriptsTabContent(category);
        }

        function showScriptsTabContent(category) {
            const scriptsContainer = document.getElementById('scriptsGrid');
            if (!scriptsContainer) return;
            
            const scripts = SCRIPTS_DATA[category] || [];
            
            console.log(`üìä Scripts en ${category}:`, scripts.length);
            
            if (scripts.length === 0) {
                scriptsContainer.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--neutral);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìù</div>
                        <h3 style="margin-bottom: 10px;">No hay scripts en esta categor√≠a</h3>
                        <p>Los scripts aparecer√°n aqu√≠ cuando se carguen desde el servidor.</p>
                    </div>
                `;
                return;
            }
            
            scriptsContainer.innerHTML = scripts.map(script => createScriptCard(script)).join('');
            currentScriptTab = category;
        }

        function createScriptCard(script) {
            const badgeHTML = script.badge ? 
                `<span class="script-badge" style="background-color: ${script.badge.color || '#6c757d'}">
                    ${script.badge.icon} ${script.badge.text}
                </span>` : '';
            
            const maxLength = 200;
            const isLongText = script.text.length > maxLength;
            const displayText = isLongText 
                ? script.text.substring(0, maxLength) + '...' 
                : script.text;
            
            const expandButton = isLongText 
                ? `<button class="btn-expand" onclick="toggleScriptText(${script.id})">üìñ Ver ${isLongText ? 'm√°s' : 'menos'}</button>`
                : '';
            
            return `
                <div class="script-card" data-script-id="${script.id}">
                    <div class="script-header">
                        <div class="script-title">${script.title}</div>
                        ${badgeHTML}
                    </div>
                    <div class="usage-stats">
                        <span>üìä ${script.usage_30_days || 0} usos (30d)</span>
                        <span>üìà ${script.usage_7_days || 0} usos (7d)</span>
                    </div>
                    <div class="script-preview" id="text-${script.id}" data-full-text="${script.text.replace(/"/g, '&quot;')}">${displayText}</div>
                    <div class="script-actions">
                        <button class="btn-copy" onclick="copyAndTrack(${script.id})">üìã Copiar</button>
                        ${expandButton}
                    </div>
                </div>
            `;
        }

        function toggleScriptText(scriptId) {
            const textElement = document.getElementById(`text-${scriptId}`);
            const button = document.querySelector(`[onclick="toggleScriptText(${scriptId})"]`);
            const card = document.querySelector(`.script-card[data-script-id="${scriptId}"]`);
            
            if (!textElement || !button) return;
            
            const fullText = textElement.getAttribute('data-full-text');
            const isExpanded = button.textContent.includes('Ver menos');
            
            if (isExpanded) {
                const maxLength = 200;
                textElement.textContent = fullText.substring(0, maxLength) + '...';
                button.textContent = 'üìñ Ver m√°s';
                card?.classList.remove('expanded');
            } else {
                textElement.textContent = fullText;
                button.textContent = 'üìï Ver menos';
                card?.classList.add('expanded');
                
                setTimeout(() => {
                    card?.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest' 
                    });
                }, 100);
            }
        }

        async function copyAndTrack(scriptId) {
            const card = document.querySelector(`.script-card[data-script-id="${scriptId}"]`);
            if (!card) return;
            
            const textElement = card.querySelector('.script-preview');
            const button = card.querySelector('.btn-copy');
            
            if (!textElement || !button) return;
            
            const fullText = textElement.getAttribute('data-full-text') || textElement.textContent;
            
            try {
                await navigator.clipboard.writeText(fullText);
                
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copiado';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                
                // Rastrear uso
                try {
                    await apiCall(`/api/scripts/${scriptId}/track`, { method: 'POST' });
                } catch (trackError) {
                    console.warn('Error al rastrear uso:', trackError);
                }
                
            } catch (copyError) {
                showToast('Error al copiar al portapapeles', 'error');
            }
        }

        // CLIENTES
        function renderClientes() {
            const container = document.getElementById('clientesGrid');
            if (!container) return;
            
            const perfilesFiltrados = filtrarPerfilesData();
            
            if (perfilesFiltrados.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--neutral);">
                        üìö No hay perfiles que coincidan con los filtros.<br>
                        ${CLIENTES_POTENCIALES.length === 0 ? '¬°Agrega el primer perfil!' : 'Prueba ajustando los filtros.'}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = perfilesFiltrados.map(cliente => createClienteCard(cliente)).join('');
        }

        function createClienteCard(cliente) {
            const tipoLabels = {
                restaurante: "üçΩÔ∏è Restaurante",
                retail: "üè™ Retail", 
                servicios: "üíº Servicios",
                clinica: "üè• Cl√≠nica",
                empresa: "üè¢ Empresa",
                otro: "üìã Otro"
            };
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            
            return `
                <div class="cliente-card">
                    <div class="cliente-header">
                        <div class="cliente-nombre">${cliente.nombre}</div>
                        <div class="cliente-badges">
                            <span class="badge-smart badge-tipo">${tipoLabels[cliente.tipo] || cliente.tipo}</span>
                            ${cliente.presupuesto ? `<span class="badge-smart badge-presupuesto ${cliente.presupuesto}">${cliente.presupuesto}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="cliente-preview">
                        <strong>üë§ Contacto:</strong> ${cliente.contacto || 'No especificado'}<br>
                        <strong>üéØ Caracter√≠sticas:</strong> ${cliente.caracteristicas.substring(0, 100)}${cliente.caracteristicas.length > 100 ? '...' : ''}
                    </div>
                    
                    <div class="cliente-actions">
                        <button class="action-btn copy" onclick="copiarPerfil(${cliente.id})">üìã Copiar</button>
                        <button class="action-btn edit" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
                        <button class="action-btn delete" onclick="eliminarCliente(${cliente.id})">üóëÔ∏è Eliminar</button>
                    </div>
                </div>
            `;
        }

        function filtrarPerfilesData() {
            const filtroTipo = document.getElementById('filtroTipo')?.value || '';
            const filtroPresupuesto = document.getElementById('filtroPresupuesto')?.value || '';
            const filtroUrgencia = document.getElementById('filtroUrgencia')?.value || '';
            
            return CLIENTES_POTENCIALES.filter(cliente => {
                const cumpleTipo = !filtroTipo || cliente.tipo === filtroTipo;
                const cumplePresupuesto = !filtroPresupuesto || cliente.presupuesto === filtroPresupuesto;
                const cumpleUrgencia = !filtroUrgencia || cliente.urgencia === filtroUrgencia;
                
                return cumpleTipo && cumplePresupuesto && cumpleUrgencia;
            });
        }

        function filtrarPerfiles() {
            renderClientes();
        }

        function cambiarVista(vista) {
            currentClienteView = vista;
            
            const cardsViewBtn = document.getElementById('cardsViewBtn');
            const listViewBtn = document.getElementById('listViewBtn');
            
            if (vista === 'cards') {
                cardsViewBtn?.classList.add('active');
                listViewBtn?.classList.remove('active');
            } else {
                listViewBtn?.classList.add('active');
                cardsViewBtn?.classList.remove('active');
            }
            
            renderClientes();
        }

        function abrirFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                document.getElementById('clienteForm').reset();
                document.getElementById('clienteId').value = '';
                currentEditingClienteId = null;
                
                titulo.textContent = '‚ûï Agregar Nuevo Perfil de Cliente Ideal';
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                showToast('üìù Formulario abierto para documentar perfil ideal', 'success');
            }
        }
        
        function cerrarFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            if (formulario) {
                formulario.style.display = 'none';
                currentEditingClienteId = null;
            }
        }
        
        function editarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) {
                showToast('Cliente no encontrado', 'error');
                return;
            }
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            document.getElementById('clienteId').value = cliente.id;
            document.getElementById('clienteNombre').value = cliente.nombre;
            document.getElementById('clienteTipo').value = cliente.tipo;
            document.getElementById('clienteContacto').value = cliente.contacto || '';
            document.getElementById('clienteTelefono').value = cliente.telefono || '';
            document.getElementById('clienteCaracteristicas').value = cliente.caracteristicas;
            document.getElementById('clienteNecesidad').value = cliente.necesidad;
            document.getElementById('clientePresupuesto').value = cliente.presupuesto || '';
            document.getElementById('clienteUrgencia').value = cliente.urgencia || '';
            document.getElementById('clienteProximosPasos').value = proximosPasos || '';
            document.getElementById('clienteVendedor').value = cliente.vendedor || '';
            document.getElementById('clienteFecha').value = fechaContacto || '';
            
            currentEditingClienteId = id;
            
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                titulo.textContent = `‚úèÔ∏è Editando: ${cliente.nombre}`;
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        async function eliminarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            showModal(
                'üóëÔ∏è Eliminar Cliente', 
                `¬øEst√°s seguro de que quieres eliminar a "${cliente.nombre}"?\n\nEsta acci√≥n no se puede deshacer.`,
                'danger',
                async () => {
                    try {
                        await apiCall(`/api/clientes-potenciales/${id}`, { 
                            method: 'DELETE',
                            headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                        });
                        
                        CLIENTES_POTENCIALES = CLIENTES_POTENCIALES.filter(c => c.id !== id);
                        renderClientes();
                        updateClientesCount();
                        showToast('‚úÖ Cliente eliminado exitosamente', 'success');
                        
                    } catch (error) {
                        showToast(`‚ùå Error al eliminar cliente: ${error.message}`, 'error');
                    }
                }
            );
        }

        function copiarPerfil(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            const texto = `üéØ PERFIL DE CLIENTE IDEAL: ${cliente.nombre}

üè¢ Tipo: ${cliente.tipo}
üë§ Contacto t√≠pico: ${cliente.contacto || 'No especificado'}
üìç Ubicaci√≥n: ${cliente.telefono || 'No especificado'}

üí∞ Presupuesto: ${cliente.presupuesto || 'No especificado'}
‚ö° Decisi√≥n: ${cliente.urgencia || 'No especificado'}

üéØ CARACTER√çSTICAS IDEALES:
${cliente.caracteristicas}

üì¢ PUBLICIDAD QUE NECESITAN:
${cliente.necesidad}

${proximosPasos ? `üí° ESTRATEGIAS DE APPROACH:
${proximosPasos}` : ''}

üìù Documentado por: ${cliente.vendedor || 'No especificado'}
üìÖ Fecha: ${fechaContacto ? new Date(fechaContacto).toLocaleDateString() : 'No especificada'}

---
Generado por DPI Sistema de Ventas`.trim();
            
            navigator.clipboard.writeText(texto).then(() => {
                showToast('‚úÖ Perfil copiado al portapapeles', 'success');
            }).catch(() => {
                showToast('‚ùå Error al copiar perfil', 'error');
            });
        }

        async function handleClienteFormSubmit(e) {
            e.preventDefault();
            
            const clienteData = {
                nombre: document.getElementById('clienteNombre').value.trim(),
                tipo: document.getElementById('clienteTipo').value,
                contacto: document.getElementById('clienteContacto').value.trim(),
                telefono: document.getElementById('clienteTelefono').value.trim(),
                caracteristicas: document.getElementById('clienteCaracteristicas').value.trim(),
                necesidad: document.getElementById('clienteNecesidad').value.trim(),
                presupuesto: document.getElementById('clientePresupuesto').value,
                urgencia: document.getElementById('clienteUrgencia').value,
                proximosPasos: document.getElementById('clienteProximosPasos').value.trim(),
                vendedor: document.getElementById('clienteVendedor').value.trim(),
                fecha: document.getElementById('clienteFecha').value
            };
            
            if (!clienteData.nombre || !clienteData.tipo || !clienteData.caracteristicas || !clienteData.necesidad) {
                showToast('Por favor completa todos los campos obligatorios', 'error');
                return;
            }
            
            try {
                if (currentEditingClienteId) {
                    await apiCall(`/api/clientes-potenciales/${currentEditingClienteId}`, { 
                        method: 'PUT', 
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer DPI2025Admin' 
                        },
                        body: JSON.stringify(clienteData) 
                    });
                    showToast('Perfil actualizado exitosamente', 'success');
                } else {
                    await apiCall('/api/clientes-potenciales', { 
                        method: 'POST', 
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer DPI2025Admin' 
                        },
                        body: JSON.stringify(clienteData) 
                    });
                    showToast('Perfil de cliente ideal agregado exitosamente', 'success');
                }
                
                await cargarClientesPotenciales();
                cerrarFormularioCliente();
                
            } catch (error) {
                showToast(`Error al guardar perfil: ${error.message}`, 'error');
            }
        }

        // ADMIN
        async function handleAdminFormSubmit(e) {
            e.preventDefault();
            
            const categoryEl = document.getElementById('scriptCategory');
            const titleEl = document.getElementById('scriptTitle');
            const textEl = document.getElementById('scriptText');
            
            if (!categoryEl || !titleEl || !textEl) {
                showToast('Error: elementos del formulario no encontrados', 'error');
                return;
            }
            
            const category = categoryEl.value.trim();
            const title = titleEl.value.trim();
            const text = textEl.value.trim();
            
            if (!category || !title || !text) {
                showToast('Por favor completa todos los campos', 'error');
                return;
            }
            
            const payload = { category, title, text };
            const endpoint = currentEditingId ? `/api/scripts/${currentEditingId}` : '/api/scripts';
            const method = currentEditingId ? 'PUT' : 'POST';
            
            try {
                await apiCall(endpoint, { 
                    method, 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': 'Bearer DPI2025Admin' 
                    }, 
                    body: JSON.stringify(payload) 
                });
                
                const action = currentEditingId ? 'actualizado' : 'creado';
                showToast(`Script ${action} exitosamente`, 'success');
                
                clearForm();
                await fetchAllData();
                renderAdminList();
                
            } catch (error) {
                showToast(`Error al ${currentEditingId ? 'actualizar' : 'crear'} script: ${error.message}`, 'error');
            }
        }

        function clearForm() {
            currentEditingId = null;
            
            const form = document.getElementById('scriptForm');
            const formTitle = document.getElementById('formTitle');
            
            if (form) form.reset();
            if (formTitle) formTitle.textContent = '‚ûï Agregar Script';
        }

        function renderAdminList() {
            const listContainer = document.getElementById('scriptsList');
            const filterSelect = document.getElementById('filterCategory');
            
            if (!listContainer) return;
            
            const filter = filterSelect ? filterSelect.value : 'all';
            listContainer.innerHTML = '';
            
            let hasScripts = false;
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(SCRIPTS_DATA).forEach(category => {
                if (filter === 'all' || filter === category) {
                    if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].length > 0) {
                        hasScripts = true;
                        
                        if (filter === 'all') {
                            listContainer.innerHTML += `
                                <div style="margin: 20px 0 10px 0; font-weight: 600; color: var(--primary); padding: 10px; background: var(--light); border-radius: 5px;">
                                    ${categoryNames[category] || category}
                                </div>
                            `;
                        }
                        
                        SCRIPTS_DATA[category].forEach(script => {
                            listContainer.innerHTML += `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--white); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px;">
                                    <div style="flex: 1;">
                                        <h4 style="margin: 0 0 5px 0; font-size: 14px;">${script.title}</h4>
                                        <small style="color: var(--neutral); font-size: 12px;">${script.text.substring(0, 80)}...</small>
                                    </div>
                                    <div style="display: flex; gap: 5px;">
                                        <button onclick="editScript(${script.id})" style="background: var(--warning); color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">‚úèÔ∏è Editar</button>
                                        <button onclick="deleteScript(${script.id})" style="background: var(--danger); color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                }
            });
            
            if (!hasScripts) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--neutral);">
                        ${filter === 'all' ? 'No hay scripts disponibles.' : `No hay scripts en la categor√≠a "${categoryNames[filter] || filter}".`}
                    </div>
                `;
            }
        }

        function editScript(id) {
            let scriptToEdit = null;
            let categoryKey = null;
            
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptToEdit = found;
                    categoryKey = category;
                    break;
                }
            }
            
            if (!scriptToEdit) {
                showToast('Script no encontrado', 'error');
                return;
            }
            
            currentEditingId = id;
            
            const formTitle = document.getElementById('formTitle');
            const categorySelect = document.getElementById('scriptCategory');
            const titleInput = document.getElementById('scriptTitle');
            const textArea = document.getElementById('scriptText');
            
            if (formTitle) formTitle.textContent = `‚úèÔ∏è Editando: ${scriptToEdit.title}`;
            if (categorySelect) categorySelect.value = categoryKey;
            if (titleInput) titleInput.value = scriptToEdit.title;
            if (textArea) textArea.value = scriptToEdit.text;
            
            if (formTitle) {
                formTitle.scrollIntoView({ behavior: 'smooth' });
            }
        }

        async function deleteScript(id) {
            let scriptTitle = `ID ${id}`;
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptTitle = found.title;
                    break;
                }
            }
            
            showModal(
                'üóëÔ∏è Eliminar Script',
                `¬øEst√°s seguro de que quieres eliminar el script "${scriptTitle}"?\n\nEsta acci√≥n no se puede deshacer.`,
                'danger',
                async () => {
                    try {
                        await apiCall(`/api/scripts/${id}`, { 
                            method: 'DELETE', 
                            headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                        });
                        
                        showToast('‚úÖ Script eliminado exitosamente', 'success');
                        await fetchAllData();
                        renderAdminList();
                        
                    } catch (error) {
                        showToast(`‚ùå Error al eliminar script: ${error.message}`, 'error');
                    }
                }
            );
        }

        // B√öSQUEDA
        function handleSearch(e) {
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }
            
            debounceTimer = setTimeout(() => {
                const query = e.target.value.trim();
                const searchResults = document.getElementById('searchResults');
                
                if (query.length > 1) {
                    performSearch(query);
                } else {
                    if (searchResults) {
                        searchResults.classList.remove('active');
                    }
                }
            }, 300);
        }

        async function performSearch(query) {
            const resultsContainer = document.getElementById('searchResults');
            if (!resultsContainer) return;
            
            resultsContainer.innerHTML = `<div style="padding: 15px; text-align: center; color: var(--neutral);">üîç Buscando...</div>`;
            resultsContainer.classList.add('active');
            
            try {
                const results = await apiCall(`/api/scripts/search?q=${encodeURIComponent(query)}`);
                
                if (!results || !Array.isArray(results)) {
                    resultsContainer.innerHTML = `<div class="search-result-item" style="color: var(--danger);">Error en formato de respuesta</div>`;
                    return;
                }
                
                if (results.length > 0) {
                    resultsContainer.innerHTML = results.map(result => `
                        <div class="search-result-item" onclick="scrollToScript(${result.id})">
                            <div class="search-result-category">${getCategoryName(result.category)}</div>
                            <div>${result.highlightedTitle}</div>
                            <div style="font-size: 12px; color: var(--neutral); margin-top: 5px;">${result.highlightedText || ''}</div>
                        </div>
                    `).join('');
                } else {
                    resultsContainer.innerHTML = `
                        <div class="search-result-item" style="text-align: center; color: var(--neutral);">
                            üîç No se encontraron resultados para "${query}"
                        </div>
                    `;
                }
            } catch (error) {
                resultsContainer.innerHTML = `
                    <div class="search-result-item" style="color: var(--danger);">
                        ‚ùå Error en la b√∫squeda: ${error.message}
                    </div>
                `;
            }
        }

        function getCategoryName(category) {
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            return categoryNames[category] || category;
        }

        function scrollToScript(id) {
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.classList.remove('active');
            }
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Encontrar la categor√≠a del script
            let categoryKey = null;
            for (const category in SCRIPTS_DATA) {
                if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].some(s => s.id == id)) {
                    categoryKey = category;
                    break;
                }
            }
            
            if (categoryKey) {
                // Navegar a scripts si no estamos ah√≠
                if (currentView !== 'scripts') {
                    showView('scripts');
                }
                
                // Cambiar al tab correcto y buscar el script
                setTimeout(() => {
                    changeScriptTab(categoryKey);
                    
                    setTimeout(() => {
                        const card = document.querySelector(`.script-card[data-script-id="${id}"]`);
                        if (card) {
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            
                            // Destacar temporalmente
                            card.style.transition = 'background-color 0.5s ease';
                            card.style.backgroundColor = '#fff3cd';
                            
                            setTimeout(() => {
                                card.style.backgroundColor = '';
                            }, 2000);
                        } else {
                            console.warn('‚ö†Ô∏è Script card no encontrado para ID:', id);
                        }
                    }, 200);
                }, 200);
            } else {
                console.warn('‚ö†Ô∏è Categor√≠a no encontrada para script ID:', id);
                showToast('‚ùå Script no encontrado en la vista actual', 'error');
            }
        }

        // NAVEGACI√ìN DE PROCESO
        function showScriptsTab(category) {
            // Si estamos en otra vista, navegar primero a scripts
            if (currentView !== 'scripts') {
                showView('scripts');
                // Esperar a que se renderice y luego cambiar tab
                setTimeout(() => {
                    changeScriptTab(category);
                }, 200);
            } else {
                // Ya estamos en scripts, solo cambiar tab
                changeScriptTab(category);
            }
        }

        function changeScriptTab(category) {
            console.log('üìÇ Cambiando a tab:', category);
            
            // Actualizar tabs activos
            document.querySelectorAll('.script-tab').forEach(t => t.classList.remove('active'));
            
            // Activar tab correcto
            const activeTab = document.querySelector(`[data-category="${category}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Mostrar contenido del tab
            showScriptsTabContent(category);
        }

        // UTILIDADES
        function updateStats() {
            const totalScripts = SCRIPTS_DATA ? 
                Object.values(SCRIPTS_DATA).reduce((sum, cat) => 
                    sum + (Array.isArray(cat) ? cat.length : 0), 0
                ) : 0;
            
            const scriptCountEl = document.getElementById('scriptCount');
            const scriptsCountEl = document.getElementById('scriptsCount');
            
            if (scriptCountEl) scriptCountEl.textContent = totalScripts;
            if (scriptsCountEl) scriptsCountEl.textContent = `${totalScripts} scripts disponibles`;
        }

        function updateClientesCount() {
            const clientesCountEl = document.getElementById('clientesCount');
            if (clientesCountEl) {
                clientesCountEl.textContent = `${CLIENTES_POTENCIALES.length} perfiles documentados`;
            }
        }

        function showToast(message, type = 'default') {
            const toast = document.getElementById('toast');
            const toastText = toast.querySelector('.toast-text');
            const toastIcon = toast.querySelector('.toast-icon');
            
            const config = {
                'success': { icon: '‚úÖ', class: 'success' },
                'warning': { icon: '‚ö†Ô∏è', class: 'warning' },
                'error': { icon: '‚ùå', class: 'error' },
                'default': { icon: 'üí°', class: '' }
            };
            
            const { icon, class: className } = config[type] || config.default;
            
            toastText.textContent = message;
            toastIcon.textContent = icon;
            toast.className = `toast ${className}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // Hacer funciones globales
        window.switchMode = switchMode;
        window.handleAuth = handleAuth;
        window.cancelAuth = cancelAuth;
        window.showView = showView;
        window.handleSemaforo = handleSemaforo;
        window.showScriptsTab = showScriptsTab;
        window.changeScriptTab = changeScriptTab;
        window.showScriptsTabContent = showScriptsTabContent;
        window.toggleScriptText = toggleScriptText;
        window.copyAndTrack = copyAndTrack;
        window.cambiarVista = cambiarVista;
        window.filtrarPerfiles = filtrarPerfiles;
        window.abrirFormularioCliente = abrirFormularioCliente;
        window.cerrarFormularioCliente = cerrarFormularioCliente;
        window.editarCliente = editarCliente;
        window.eliminarCliente = eliminarCliente;
        window.copiarPerfil = copiarPerfil;
        window.editScript = editScript;
        window.deleteScript = deleteScript;
        window.clearForm = clearForm;
        window.renderAdminList = renderAdminList;
        window.scrollToScript = scrollToScript;
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.confirmModal = confirmModal;
    </script>
</body>
</html>
