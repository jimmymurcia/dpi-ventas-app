<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPI Publicidad - Sistema de Ventas Profesional</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0FA795; 
            --secondary-color: #8BC34A; 
            --danger-color: #dc3545;
            --warning-color: #ffc107; 
            --info-color: #17a2b8; 
            --success-color: #28a745;
            --dark-color: #2c3e50; 
            --light-color: #ffffff; 
            --white-color: #ffffff;
            --bg-color: #f4f7f6; 
            --border-color: #e3e8ee;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            min-height: 100vh; 
            padding: 10px; 
            font-size: 15px; 
            color: var(--dark-color); 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            transition: filter 0.3s ease; 
        }
        .header { 
            text-align: center; 
            color: var(--dark-color); 
            margin-bottom: 20px; 
        }
        .header h1 { 
            font-size: 2em; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        .header p { 
            font-size: 1em; 
            color: #7f8c8d; 
        }
        .header .status { 
            background-color: rgba(0,0,0,0.05); 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-size: 0.85em; 
            margin-top: 10px; 
            display: inline-block; 
            transition: all 0.3s ease; 
            border: 1px solid var(--border-color); 
        }
        .header .status.online { 
            background-color: var(--success-color); 
            color: white; 
            border-color: var(--success-color); 
        }
        .header .status.offline { 
            background-color: var(--danger-color); 
            color: white; 
            border-color: var(--danger-color); 
        }
        .mode-switcher-wrapper { 
            text-align: center; 
            margin-bottom: 20px; 
        }
        .mode-switcher { 
            background: #e0e5ec; 
            border-radius: 30px; 
            display: inline-flex; 
            padding: 4px; 
            box-shadow: inset 3px 3px 6px #caced4, inset -3px -3px 6px #f8f9fa; 
        }
        .mode-btn { 
            background: transparent; 
            color: #555; 
            border: none; 
            padding: 8px 20px; 
            border-radius: 25px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-size: 0.9em;
        }
        .mode-btn.active { 
            background: var(--primary-color); 
            color: white; 
            box-shadow: 0 4px 15px rgba(15, 167, 149, 0.3); 
        }
        .panel { 
            background: var(--light-color); 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06); 
            margin-bottom: 20px; 
        }
        .panel h2 { 
            font-size: 1.3em; 
            font-weight: 600; 
            margin-bottom: 15px; 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 10px; 
        }
        .loading, .empty-state { 
            text-align: center; 
            padding: 40px 20px; 
            color: #7f8c8d; 
        }
        
        /* üîç B√öSQUEDA MEJORADA PARA M√ìVIL */
        .search-box { 
            position: relative; 
            padding-bottom: 15px; 
            width: 100%;
        }
        .search-input { 
            width: 100%; 
            padding: 12px 15px 12px 40px; 
            border: 2px solid var(--border-color); 
            border-radius: 10px; 
            font-size: 0.95em; 
            max-width: 100%;
            box-sizing: border-box;
        }
        .search-input:focus { 
            outline: none; 
            border-color: var(--primary-color); 
        }
        .search-box::before { 
            content: 'üîç'; 
            position: absolute; 
            left: 15px; 
            top: 12px; 
            color: #aaa; 
            font-size: 1.1em; 
            pointer-events: none; 
        }
        .search-results { 
            position: absolute; 
            top: calc(100% - 5px); 
            left: 0; 
            right: 0; 
            background: var(--light-color); 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            max-height: 300px; 
            overflow-y: auto; 
            z-index: 1000; 
            display: none; 
        }
        .search-results.active { 
            display: block; 
        }
        .search-result-item { 
            padding: 10px 12px; 
            border-bottom: 1px solid #f1f3f4; 
            cursor: pointer; 
            font-size: 0.9em;
        }
        .search-result-item:hover {
            background-color: var(--bg-color);
        }
        .search-result-category {
            font-size: 0.75em;
            color: var(--primary-color);
            font-weight: 600;
            text-transform: uppercase;
        }
        mark { 
            background: #fff3cd; 
        }
        
        /* üö¶ SEM√ÅFORO DE CALIFICACI√ìN */
        .semaforo-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .semaforo-light {
            border-radius: 12px;
            padding: 20px;
            color: white;
            font-weight: 600;
            position: relative;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .semaforo-light:hover {
            transform: translateY(-3px);
        }
        
        .semaforo-light:hover .semaforo-icon {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.4);
        }
        
        .semaforo-light.verde {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }
        
        .semaforo-light.amarillo {
            background: linear-gradient(135deg, #FF9800, #FFB74D);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.3);
        }
        
        .semaforo-light.rojo {
            background: linear-gradient(135deg, #F44336, #EF5350);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3);
        }
        
        .semaforo-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            margin-bottom: 12px;
            align-self: flex-start;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        
        .semaforo-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .semaforo-description {
            font-style: italic;
            margin-bottom: 15px;
            opacity: 0.95;
            line-height: 1.3;
            font-size: 0.95em;
        }
        
        .semaforo-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .semaforo-list li {
            padding: 4px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9em;
        }
        
        .semaforo-list li::before {
            content: '‚úì';
            font-weight: bold;
            font-size: 1em;
        }
        
        .semaforo-light.amarillo .semaforo-list li::before {
            content: '!';
        }
        
        .semaforo-light.rojo .semaforo-list li::before {
            content: '‚Ä¢';
        }
        
        /* üìã PROCESO DE PRE-CALIFICACI√ìN */
        .precalificacion-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
        }
        
        .precalificacion-header p {
            margin-bottom: 12px;
            font-size: 1em;
        }
        
        .proceso-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .proceso-btn:hover {
            background: white;
            color: #667eea;
        }
        
        .proceso-panel {
            border-left: 4px solid var(--primary-color);
        }
        
        .etapas-container {
            display: grid;
            gap: 20px;
        }
        
        .etapa {
            background: var(--bg-color);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }
        
        .etapa:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .etapa-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .etapa-numero {
            background: var(--primary-color);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1em;
        }
        
        .etapa-header h3 {
            flex: 1;
            margin: 0;
            color: var(--dark-color);
            font-size: 1.1em;
        }
        
        .etapa-tiempo {
            background: var(--warning-color);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }
        
        .etapa-content {
            display: grid;
            gap: 12px;
        }
        
        .objetivo {
            background: rgba(15, 167, 149, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--primary-color);
            font-size: 0.9em;
        }
        
        .preguntas-clave {
            background: rgba(255, 193, 7, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--warning-color);
            font-size: 0.9em;
        }
        
        .preguntas-clave ul, .objetivo ul {
            margin: 8px 0 0 16px;
        }
        
        .preguntas-clave li, .objetivo li {
            margin: 4px 0;
            font-style: italic;
            font-size: 0.85em;
        }
        
        .se√±ales-alerta {
            background: rgba(220, 53, 69, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--danger-color);
            font-size: 0.9em;
        }
        
        .alerta {
            display: inline-block;
            background: var(--danger-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75em;
            margin: 2px;
        }
        
        .validacion-presupuesto {
            background: rgba(40, 167, 69, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--success-color);
            font-style: italic;
            font-size: 0.9em;
        }
        
        .usar-script-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            justify-self: start;
            font-size: 0.85em;
        }
        
        .usar-script-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }
        
        .decision-matrix {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .decision-verde, .decision-amarillo, .decision-rojo {
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }
        
        .decision-verde {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid var(--success-color);
        }
        
        .decision-amarillo {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid var(--warning-color);
        }
        
        .decision-rojo {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid var(--danger-color);
        }
        
        .decision-btn {
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 8px;
            width: 100%;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .decision-btn.verde {
            background: var(--success-color);
            color: white;
        }
        
        .decision-btn.amarillo {
            background: var(--warning-color);
            color: white;
        }
        
        .decision-btn.rojo {
            background: var(--danger-color);
            color: white;
        }
        
        .decision-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .proceso-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .cerrar-proceso-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .tiempo-total {
            font-weight: 600;
            color: var(--info-color);
            font-size: 0.9em;
        }
        
        /* üîç FILTROS DE CLIENTES IDEALES */
        .filtros-cliente {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .filtro-grupo {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filtro-grupo label {
            font-weight: 600;
            font-size: 0.85em;
            color: var(--dark-color);
        }
        
        .filtro-grupo select {
            padding: 6px 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.85em;
            background: white;
        }
        
        .perfil-count {
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.9em;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* üìã VISTA Y CONTROLES MEJORADOS */
        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 10px;
        }

        .view-toggle {
            display: flex;
            background: #e0e5ec;
            border-radius: 20px;
            padding: 3px;
            box-shadow: inset 2px 2px 5px #caced4, inset -2px -2px 5px #f8f9fa;
        }

        .view-toggle-btn {
            background: transparent;
            border: none;
            padding: 6px 12px;
            border-radius: 17px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .view-toggle-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(15, 167, 149, 0.3);
        }

        .bulk-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .bulk-btn {
            background: var(--info-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .bulk-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .bulk-btn.export { background: var(--warning-color); }
        .bulk-btn.share { background: var(--secondary-color); }
        
        /* üìã CARDS MEJORADAS CON BADGES INTELIGENTES */
        .perfil-card-enhanced {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .perfil-card-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .perfil-card-enhanced:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            transform: translateY(-3px);
            border-color: var(--primary-color);
        }

        .perfil-card-enhanced:hover::before {
            opacity: 1;
        }

        .perfil-card-enhanced.expandida {
            border-color: var(--primary-color);
            box-shadow: 0 6px 20px rgba(15, 167, 149, 0.15);
        }

        .perfil-card-enhanced.expandida::before {
            opacity: 1;
        }

        .perfil-header-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .perfil-nombre-enhanced {
            font-weight: 700;
            color: var(--dark-color);
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .perfil-badges {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-end;
        }

        .badge-smart {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .badge-smart::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .badge-smart:hover::before {
            left: 100%;
        }

        .badge-tipo { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .badge-presupuesto.alto { background: linear-gradient(135deg, #28a745, #20c997); color: white; }
        .badge-presupuesto.medio { background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; }
        .badge-presupuesto.bajo { background: linear-gradient(135deg, #6c757d, #495057); color: white; }
        .badge-urgencia.alta { background: linear-gradient(135deg, #dc3545, #e74c3c); color: white; }
        .badge-urgencia.media { background: linear-gradient(135deg, #fd7e14, #f39c12); color: white; }
        .badge-urgencia.baja { background: linear-gradient(135deg, #17a2b8, #20c997); color: white; }
        .badge-fecha { background: linear-gradient(135deg, #6f42c1, #e83e8c); color: white; }

        .perfil-preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .preview-item {
            background: var(--bg-color);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }

        .preview-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 4px;
            font-size: 0.85em;
        }

        .preview-item span {
            font-size: 0.9em;
            line-height: 1.3;
        }

        .perfil-actions-enhanced {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .action-group {
            display: flex;
            gap: 6px;
        }

        .action-btn {
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .action-btn:hover::before {
            width: 100px;
            height: 100px;
        }

        .action-btn.copy { background: var(--info-color); color: white; }
        .action-btn.share { background: var(--secondary-color); color: white; }
        .action-btn.edit { background: var(--warning-color); color: white; }
        .action-btn.delete { background: var(--danger-color); color: white; }
        .action-btn.expand { background: var(--primary-color); color: white; }

        .perfil-stats {
            display: flex;
            gap: 12px;
            font-size: 0.75em;
            color: #7f8c8d;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* VISTA LISTA COMPACTA */
        .perfil-list-view {
            display: none;
        }

        .perfil-list-view.active {
            display: block;
        }

        .perfil-list-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .perfil-list-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-1px);
            border-color: var(--primary-color);
        }

        .list-item-content {
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: center;
        }

        .list-item-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .list-item-info {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .list-item-badges {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .list-item-actions {
            display: flex;
            gap: 4px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .section-header h3 {
            margin: 0;
            font-size: 1.1em;
        }
        
        .agregar-cliente-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }
        
        .agregar-cliente-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }
        
        .section-description {
            background: rgba(255, 193, 7, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 0.85em;
            border-left: 3px solid var(--warning-color);
        }

        /* üìù SECCI√ìN DE SCRIPTS MEJORADA */
        .scripts-section-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .scripts-section-title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .scripts-section-description {
            background: rgba(15, 167, 149, 0.1);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
            border-left: 4px solid var(--primary-color);
            line-height: 1.4;
        }
        
        .formulario-cliente {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .form-header h4 {
            margin: 0;
            color: var(--primary-color);
            font-size: 1em;
        }
        
        .cerrar-form-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 12px;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
            font-size: 0.85em;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 8px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.85em;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 70px;
        }
        
        .form-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 15px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
        }
        
        .guardar-cliente-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.85em;
        }
        
        .guardar-cliente-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .cancelar-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .clientes-potenciales-lista {
            display: grid;
            gap: 12px;
        }
        
        .cliente-empty {
            text-align: center;
            padding: 30px 15px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        /* TABS MEJORADOS PARA M√ìVIL */
        .tabs { 
            display: flex; 
            border-bottom: 2px solid var(--border-color); 
            margin-bottom: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .tabs::-webkit-scrollbar {
            display: none;
        }
        .tab { 
            padding: 10px 16px; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 0.85em; 
            color: #7f8c8d; 
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: max-content;
        }
        .tab:after { 
            content: ''; 
            position: absolute; 
            bottom: -2px; 
            left: 0; 
            right: 0; 
            height: 3px; 
            background-color: var(--primary-color); 
            transform: scaleX(0); 
            transition: transform 0.3s ease; 
        }
        .tab.active { 
            color: var(--primary-color); 
        }
        .tab.active:after { 
            transform: scaleX(1); 
        }
        .script-card { 
            background: var(--bg-color); 
            border: 1px solid var(--border-color); 
            border-radius: 10px; 
            padding: 15px; 
            margin-bottom: 12px;
            transition: background-color 0.5s ease;
        }
        .script-title { 
            font-weight: 600; 
            font-size: 1em; 
            color: var(--dark-color); 
            display: flex; 
            align-items: center; 
            gap: 8px;
            flex-wrap: wrap;
        }
        .script-text { 
            line-height: 1.5; 
            margin: 12px 0; 
            white-space: pre-line; 
            font-size: 0.9em;
        }
        .script-badge { 
            padding: 3px 8px; 
            border-radius: 10px; 
            font-size: 0.7em; 
            color: var(--white-color); 
        }
        .usage-stats { 
            display: flex; 
            gap: 12px; 
            font-size: 0.75em; 
            color: #7f8c8d; 
            flex-wrap: wrap;
        }
        .script-actions { 
            margin-top: 12px; 
        }
        .copy-btn { 
            background: var(--primary-color); 
            color: var(--white-color); 
            border: none; 
            padding: 8px 16px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: background-color 0.3s ease;
            font-size: 0.85em;
        }
        .copy-btn.copied { 
            background: var(--success-color); 
        }
        .admin-mode { 
            display: none; 
        }
        .stats-bar { 
            display: flex; 
            justify-content: space-around; 
            background: var(--dark-color); 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
            gap: 10px;
        }
        .stats-item { 
            text-align: center; 
        }
        .stats-number { 
            font-size: 1.5em; 
            font-weight: 700; 
        }
        .stats-label { 
            font-size: 0.8em; 
            opacity: 0.8; 
        }
        .admin-controls { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 20px; 
        }
        .form-group label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 6px; 
        }
        .form-group select, .form-group input, .form-group textarea { 
            width: 100%; 
            padding: 10px; 
            border: 2px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 0.9em; 
            font-family: 'Inter', sans-serif;
        }
        .form-group textarea { 
            height: 120px; 
            resize: vertical; 
        }
        .admin-btn { 
            padding: 10px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            border: none; 
            transition: all 0.2s ease; 
            margin-right: 8px;
            font-size: 0.9em;
        }
        .admin-btn.success { 
            background-color: var(--success-color); 
            color: white; 
        }
        .admin-btn.danger { 
            background-color: var(--danger-color); 
            color: white; 
        }
        .scripts-list { 
            max-height: 400px; 
            overflow-y: auto; 
        }
        .script-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px; 
            background: var(--bg-color); 
            border-radius: 6px; 
            margin-bottom: 8px; 
        }
        .script-item h4 {
            margin: 0;
            flex: 1;
            font-size: 0.9em;
        }
        .script-item-actions button { 
            color: white; 
            font-size: 0.8em; 
            padding: 6px 12px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-left: 4px; 
        }
        .edit-btn { 
            background: var(--info-color); 
        }
        .delete-btn { 
            background: var(--danger-color); 
        }
        .auth-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(8px); 
            z-index: 9999; 
            display: none; 
            justify-content: center; 
            align-items: center; 
        }
        .auth-overlay.active { 
            display: flex; 
        }
        .auth-modal { 
            background: var(--light-color); 
            border-radius: 12px; 
            padding: 30px; 
            width: 90%; 
            max-width: 350px; 
            text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
        }
        .auth-error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 8px; 
            border-radius: 6px; 
            margin-bottom: 12px; 
            display: none; 
            font-size: 0.85em;
        }
        .auth-input { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 8px; 
            border: 2px solid var(--border-color); 
            border-radius: 6px; 
            font-size: 0.9em; 
        }
        .connection-status { 
            position: fixed; 
            bottom: 8px; 
            right: 8px; 
            padding: 6px 12px; 
            border-radius: 15px; 
            z-index: 1000; 
            font-weight: 600; 
            font-size: 0.8em;
        }
        .connection-status.online { 
            background: #d4edda; 
            color: #155724; 
        }
        .connection-status.offline { 
            background: #f8d7da; 
            color: #721c24; 
        }
        .hidden { 
            display: none; 
        }
        .alert { 
            padding: 10px; 
            border-radius: 5px; 
            margin-bottom: 12px; 
            font-weight: bold; 
            font-size: 0.9em;
        }
        .alert.success { 
            background: #d4edda; 
            color: #155724; 
        }
        .alert.error { 
            background: #f8d7da; 
            color: #721c24; 
        }
        
        .loading::after { 
            content: ''; 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid rgba(0,0,0,0.1); 
            border-top-color: var(--primary-color); 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
            margin-left: 10px; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-message { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 12px; 
            border-radius: 6px; 
            text-align: center; 
            font-size: 0.9em;
        }
        
        /* RESPONSIVE MEJORADO */
        @media (min-width: 768px) {
            body { padding: 20px; }
            .header h1 { font-size: 2.5em; }
            .header p { font-size: 1.1em; }
            .panel { padding: 25px; }
            .panel h2 { font-size: 1.4em; }
            .mode-btn { padding: 10px 25px; font-size: 1em; }
            .semaforo-container { grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
            .semaforo-light { min-height: 200px; padding: 25px; }
            .form-row { grid-template-columns: 1fr 1fr; }
            .admin-controls { grid-template-columns: 1fr 1.2fr; }
            .stats-bar { padding: 20px; }
            .stats-number { font-size: 2em; }
            .decision-matrix { grid-template-columns: 1fr 1fr 1fr; }
            .search-input { padding: 15px 20px 15px 50px; font-size: 1em; }
            .search-box::before { left: 20px; top: 15px; font-size: 1.2em; }
            .perfil-preview { grid-template-columns: 1fr 1fr; }
            .list-item-content { grid-template-columns: 2fr 1fr 1fr; }
        }
        
        @media (max-width: 480px) {
            body { padding: 5px; }
            .header h1 { font-size: 1.8em; }
            .panel { padding: 15px; }
            .semaforo-light { min-height: 140px; padding: 15px; }
            .semaforo-title { font-size: 1.1em; }
            .tab { padding: 8px 12px; font-size: 0.8em; }
            .form-actions { flex-direction: column; }
            .proceso-footer { flex-direction: column; text-align: center; }
            .section-header { flex-direction: column; align-items: flex-start; }
            .view-controls { flex-direction: column; }
            .perfil-preview { grid-template-columns: 1fr; }
            .list-item-content { grid-template-columns: 1fr; gap: 8px; }
            .bulk-actions { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status offline">üî¥ Conectando...</div>
    
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2>üîê Acceso Administrativo</h2>
            <p>Ingresa tus credenciales para continuar</p>
            <div id="authError" class="auth-error">Usuario o Contrase√±a incorrectos</div>
            <form id="authForm" style="margin-top: 20px;">
                <input type="text" id="authUsername" class="auth-input" placeholder="Usuario" required>
                <input type="password" id="authPassword" class="auth-input" placeholder="Contrase√±a" required>
                <button type="submit" class="admin-btn success">Ingresar</button>
                <button type="button" class="admin-btn danger" onclick="cancelAuth()">Cancelar</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainContent">
        <div class="header">
            <h1>DPI Publicidad - Sistema Scripts de Venta</h1>
            <p>R√≥tulos ‚Ä¢ Material POP ‚Ä¢ Stands ‚Ä¢ Banners ‚Ä¢ Viniles</p>
            <div class="status" id="systemStatus">Conectando al servidor...</div>
        </div>

        <div class="mode-switcher-wrapper">
            <div class="mode-switcher">
                <button class="mode-btn active" onclick="switchMode('ventas')" id="ventasModeBtn">üì± Modo Ventas</button>
                <button class="mode-btn" onclick="switchMode('admin')" id="adminModeBtn">‚öôÔ∏è Modo Admin</button>
            </div>
        </div>

        <div class="ventas-mode" id="ventasMode">
            <div class="panel">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar scripts..." autocomplete="off">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <!-- üö¶ SEM√ÅFORO DE CALIFICACI√ìN -->
            <div class="panel">
                <h2>üö¶ Sem√°foro de Calificaci√≥n</h2>
                <div class="precalificacion-header">
                    <p><strong>‚ö†Ô∏è IMPORTANTE:</strong> Completa esta pre-calificaci√≥n antes de hacer cotizaci√≥n formal</p>
                    <button class="proceso-btn" onclick="iniciarProceso()">üéØ Iniciar Proceso de Calificaci√≥n</button>
                </div>
                <div class="semaforo-container">
                    <div class="semaforo-light verde" onclick="handleSemaforoClick('verde')">
                        <div class="semaforo-icon">üü¢</div>
                        <div>
                            <div class="semaforo-title">LUZ VERDE: COTIZAR</div>
                            <div class="semaforo-description">
                                El cliente se siente escuchado, conf√≠a en nosotros y entiende el valor.
                            </div>
                            <ul class="semaforo-list">
                                <li>Entendimos su "porqu√©"</li>
                                <li>Validamos su presupuesto</li>
                                <li>Confirm√≥ que le gusta la idea</li>
                                <li>El decisor est√° involucrado</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="semaforo-light amarillo" onclick="handleSemaforoClick('amarillo')">
                        <div class="semaforo-icon">üü°</div>
                        <div>
                            <div class="semaforo-title">LUZ AMARILLA: INVESTIGAR</div>
                            <div class="semaforo-description">
                                A√∫n no entendemos la necesidad real. Es momento de preguntar, no de proponer.
                            </div>
                            <ul class="semaforo-list">
                                <li>Habla solo de precio</li>
                                <li>No tiene claro el objetivo</li>
                                <li>Pide "ideas" sin contexto</li>
                                <li>No es el decisor final</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="semaforo-light rojo" onclick="handleSemaforoClick('rojo')">
                        <div class="semaforo-icon">üî¥</div>
                        <div>
                            <div class="semaforo-title">LUZ ROJA: PAUSAR</div>
                            <div class="semaforo-description">
                                Riesgo alto de ser una "cotizaci√≥n fantasma". Invertir tiempo aqu√≠ es costoso.
                            </div>
                            <ul class="semaforo-list">
                                <li>"Solo para tener una idea"</li>
                                <li>Sin presupuesto ni urgencia</li>
                                <li>No responde preguntas clave</li>
                                <li>"Env√≠eme lo que tengas"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- üìã PROCESO DE CALIFICACI√ìN PASO A PASO -->
            <div class="panel proceso-panel" id="procesoPanel" style="display: none;">
                <h2>üìã Proceso de Calificaci√≥n por Etapas</h2>
                <div class="etapas-container">
                    <div class="etapa" data-etapa="1">
                        <div class="etapa-header">
                            <span class="etapa-numero">1</span>
                            <h3>üé¨ Apertura & Rapport</h3>
                            <span class="etapa-tiempo">2-3 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Generar confianza y entender la situaci√≥n general
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas Clave:</strong>
                                <ul>
                                    <li>"¬øC√≥mo nos conociste?"</li>
                                    <li>"¬øQu√© te lleva a buscar publicidad en este momento?"</li>
                                    <li>"¬øCu√°l es tu negocio/empresa?"</li>
                                </ul>
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('bienvenida')">üìù Ver Scripts de Apertura</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="2">
                        <div class="etapa-header">
                            <span class="etapa-numero">2</span>
                            <h3>üîç Investigaci√≥n & Necesidad</h3>
                            <span class="etapa-tiempo">5-7 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Entender el PORQU√â real detr√°s de su necesidad
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas OBLIGATORIAS:</strong>
                                <ul>
                                    <li>"¬øQu√© quieres lograr con esta publicidad?"</li>
                                    <li>"¬øQu√© pasar√≠a si no haces nada?"</li>
                                    <li>"¬øPara cu√°ndo necesitas tenerlo?"</li>
                                    <li>"¬øHas cotizado con alguien m√°s?"</li>
                                </ul>
                            </div>
                            <div class="se√±ales-alerta">
                                <strong>üö® Se√±ales de Alerta:</strong>
                                <span class="alerta">"Solo quiero precios"</span>
                                <span class="alerta">"No tengo prisa"</span>
                                <span class="alerta">"Para tener una idea"</span>
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('calificacion')">üîç Ver Scripts de Investigaci√≥n</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="3">
                        <div class="etapa-header">
                            <span class="etapa-numero">3</span>
                            <h3>üí∞ Presupuesto & Decisi√≥n</h3>
                            <span class="etapa-tiempo">3-5 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="objetivo">
                                <strong>Objetivo:</strong> Validar presupuesto real y proceso de decisi√≥n
                            </div>
                            <div class="preguntas-clave">
                                <strong>Preguntas CR√çTICAS:</strong>
                                <ul>
                                    <li>"¬øTienes presupuesto definido para esto?"</li>
                                    <li>"¬øEn qu√© rango est√°s pensando?"</li>
                                    <li>"¬øEres t√∫ quien autoriza la inversi√≥n?"</li>
                                    <li>"¬øQu√© necesitas para tomar la decisi√≥n?"</li>
                                </ul>
                            </div>
                            <div class="validacion-presupuesto">
                                <strong>üí° Validaci√≥n:</strong> "Para darte la mejor propuesta, nuestros proyectos van desde $X hasta $Y, ¬øest√°s dentro de ese rango?"
                            </div>
                            <button class="usar-script-btn" onclick="irACategoria('calificacion')">üí∞ Ver Scripts de Presupuesto</button>
                        </div>
                    </div>

                    <div class="etapa" data-etapa="4">
                        <div class="etapa-header">
                            <span class="etapa-numero">4</span>
                            <h3>üéØ Evaluaci√≥n & Pr√≥ximos Pasos</h3>
                            <span class="etapa-tiempo">2-3 min</span>
                        </div>
                        <div class="etapa-content">
                            <div class="decision-matrix">
                                <div class="decision-verde">
                                    <strong>üü¢ COTIZAR SI:</strong>
                                    <ul>
                                        <li>‚úÖ Necesidad clara y urgente</li>
                                        <li>‚úÖ Presupuesto validado</li>
                                        <li>‚úÖ Decisor identificado</li>
                                        <li>‚úÖ Timeline definido</li>
                                    </ul>
                                    <button class="decision-btn verde" onclick="tomarDecision('verde')">üéØ Proceder a Cotizaci√≥n</button>
                                </div>
                                <div class="decision-amarillo">
                                    <strong>üü° INVESTIGAR M√ÅS SI:</strong>
                                    <ul>
                                        <li>‚ö†Ô∏è Informaci√≥n incompleta</li>
                                        <li>‚ö†Ô∏è Presupuesto vago</li>
                                        <li>‚ö†Ô∏è No es el decisor</li>
                                    </ul>
                                    <button class="decision-btn amarillo" onclick="tomarDecision('amarillo')">üîç Programar Segunda Llamada</button>
                                </div>
                                <div class="decision-rojo">
                                    <strong>üî¥ PAUSAR SI:</strong>
                                    <ul>
                                        <li>‚ùå "Solo cotizaci√≥n"</li>
                                        <li>‚ùå Sin presupuesto</li>
                                        <li>‚ùå Sin urgencia</li>
                                    </ul>
                                    <button class="decision-btn rojo" onclick="tomarDecision('rojo')">‚è∏Ô∏è Pausar y Calificar M√°s</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="proceso-footer">
                    <button class="cerrar-proceso-btn" onclick="cerrarProceso()">‚ùå Cerrar Proceso</button>
                    <div class="tiempo-total">‚è±Ô∏è Tiempo total estimado: 12-18 minutos</div>
                </div>
            </div>
            
            <!-- üìù SECCI√ìN DE SCRIPTS MEJORADA -->
            <div class="panel">
                <div class="scripts-section-header">
                    <div class="scripts-section-title">
                        <h2>üìù Biblioteca de Scripts de Ventas</h2>
                    </div>
                    <div class="scripts-section-description">
                        <strong>üí° Prop√≥sito:</strong> Scripts probados y validados para cada etapa del proceso de venta. √ösalos como gu√≠a y ad√°ptalos a tu estilo personal. Cada script tiene m√©tricas de uso para identificar los m√°s efectivos del equipo.
                    </div>
                </div>
                
                <div class="tabs" id="categoryTabs"></div>
                <div class="tab-content" id="scriptsContainer">
                    <div class="loading">Cargando scripts...</div>
                </div>
            </div>

            <!-- üë§ PERFILES DE CLIENTES IDEALES MEJORADOS -->
            <div class="panel">
                <h2>üë§ Base de Conocimiento - Perfiles de Clientes Ideales</h2>
                <div class="cliente-ideal-container">
                    <div class="perfil-section neutral">
                        <div class="section-header">
                            <h3>üéØ Perfiles de Clientes IDEALES</h3>
                            <button class="agregar-cliente-btn" onclick="abrirFormularioCliente()">‚ûï Agregar Perfil</button>
                        </div>
                        <p class="section-description">
                            <strong>üí° Prop√≥sito:</strong> Arquetipos de clientes exitosos para consulta r√°pida del equipo. Cada perfil incluye caracter√≠sticas clave, necesidades t√≠picas y estrategias de approach efectivas.
                        </p>

                        <!-- Filtros de b√∫squeda estrat√©gicos -->
                        <div class="filtros-cliente">
                            <div class="filtro-grupo">
                                <label>üè¢ Sector:</label>
                                <select id="filtroTipo" onchange="filtrarPerfiles()">
                                    <option value="">Todos los sectores</option>
                                    <option value="restaurante">üçΩÔ∏è Restaurantes</option>
                                    <option value="retail">üè™ Retail/Tiendas</option>
                                    <option value="servicios">üíº Servicios</option>
                                    <option value="clinica">üè• Cl√≠nicas</option>
                                    <option value="empresa">üè¢ Empresas</option>
                                    <option value="otro">üìã Otros</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>üí∞ Presupuesto:</label>
                                <select id="filtroPresupuesto" onchange="filtrarPerfiles()">
                                    <option value="">Todos los rangos</option>
                                    <option value="bajo">üíµ Bajo ($500-$2K)</option>
                                    <option value="medio">üí¥ Medio ($2K-$5K)</option>
                                    <option value="alto">üí∏ Alto ($5K+)</option>
                                </select>
                            </div>
                            <div class="filtro-grupo">
                                <label>‚ö° Decisi√≥n:</label>
                                <select id="filtroUrgencia" onchange="filtrarPerfiles()">
                                    <option value="">Todos los tipos</option>
                                    <option value="alta">üöÄ Decisi√≥n R√°pida</option>
                                    <option value="media">‚è≥ Decisi√≥n Normal</option>
                                    <option value="baja">ü§î Planifican Mucho</option>
                                </select>
                            </div>
                        </div>

                        <!-- Controles de vista mejorados -->
                        <div class="view-controls">
                            <div class="view-toggle">
                                <button class="view-toggle-btn active" onclick="cambiarVista('cards')" id="cardsViewBtn">
                                    üìã Tarjetas
                                </button>
                                <button class="view-toggle-btn" onclick="cambiarVista('list')" id="listViewBtn">
                                    üìÉ Lista
                                </button>
                            </div>
                            
                            <div class="bulk-actions">
                                <button class="bulk-btn export" onclick="exportarPerfiles()" title="Exportar CSV para Excel">üìä CSV</button>
                                <button class="bulk-btn" onclick="exportarJSON()" title="Respaldo completo en JSON">üíæ Backup</button>
                                <button class="bulk-btn share" onclick="compartirPerfiles()" title="Compartir perfiles">üì§ Compartir</button>
                                <button class="bulk-btn" onclick="mostrarEstadisticas()" title="Ver estad√≠sticas">üìà Stats</button>
                            </div>
                        </div>
                        
                        <!-- Formulario para agregar/editar perfil ideal -->
                        <div class="formulario-cliente" id="formularioCliente" style="display: none;">
                            <div class="form-header">
                                <h4 id="tituloFormulario">‚ûï Agregar Nuevo Perfil de Cliente Ideal</h4>
                                <button class="cerrar-form-btn" onclick="cerrarFormularioCliente()">‚úñÔ∏è</button>
                            </div>
                            <form id="clienteForm">
                                <input type="hidden" id="clienteId" value="">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Nombre del Perfil/Arquetipo</label>
                                        <input type="text" id="clienteNombre" required placeholder="Ej: Restaurante Familiar Exitoso">
                                    </div>
                                    <div class="form-group">
                                        <label>Tipo de Negocio</label>
                                        <select id="clienteTipo" required>
                                            <option value="">Seleccionar tipo</option>
                                            <option value="restaurante">Restaurante/Bar</option>
                                            <option value="retail">Tienda/Retail</option>
                                            <option value="servicios">Servicios Profesionales</option>
                                            <option value="clinica">Cl√≠nica/Consultorio</option>
                                            <option value="empresa">Empresa/Corporativo</option>
                                            <option value="otro">Otro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Contacto T√≠pico (Cargo/Rol)</label>
                                        <input type="text" id="clienteContacto" placeholder="Ej: Due√±o/Gerente General">
                                    </div>
                                    <div class="form-group">
                                        <label>Ubicaci√≥n/Zona T√≠pica</label>
                                        <input type="text" id="clienteTelefono" placeholder="Ej: Zona comercial c√©ntrica">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Caracter√≠sticas que los hacen IDEALES</label>
                                    <textarea id="clienteCaracteristicas" required placeholder="Ej: Negocio establecido +2 a√±os, entienden el valor de la imagen, toman decisiones r√°pidas, invierten en calidad..."></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Qu√© tipo de publicidad necesitan t√≠picamente</label>
                                    <textarea id="clienteNecesidad" required placeholder="Ej: R√≥tulo de fachada de calidad, material POP para promociones, banners estacionales..."></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Rango de Presupuesto T√≠pico</label>
                                        <select id="clientePresupuesto">
                                            <option value="">No especificado</option>
                                            <option value="bajo">Bajo ($500 - $2,000)</option>
                                            <option value="medio">Medio ($2,000 - $5,000)</option>
                                            <option value="alto">Alto ($5,000+)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Ciclo de Decisi√≥n</label>
                                        <select id="clienteUrgencia">
                                            <option value="">No especificado</option>
                                            <option value="baja">Lento (Planifican con tiempo)</option>
                                            <option value="media">Normal (1-2 meses)</option>
                                            <option value="alta">R√°pido (Deciden pronto)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Mejores Estrategias de Approach</label>
                                    <textarea id="clienteProximosPasos" placeholder="Ej: Mostrar portfolio similar, enfocarse en calidad y durabilidad, ofrecer garant√≠a extendida..."></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Vendedor que Identific√≥ el Perfil</label>
                                        <input type="text" id="clienteVendedor" placeholder="Nombre del vendedor">
                                    </div>
                                    <div class="form-group">
                                        <label>Fecha de Documentaci√≥n</label>
                                        <input type="date" id="clienteFecha">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="guardar-cliente-btn">üíæ Guardar Perfil</button>
                                    <button type="button" class="cancelar-btn" onclick="cerrarFormularioCliente()">‚ùå Cancelar</button>
                                </div>
                            </form>
                        </div>

                        <!-- Contador y lista din√°mica de perfiles -->
                        <div class="perfil-count" id="perfilesCount">üìä Cargando perfiles...</div>
                        
                        <!-- Vista de tarjetas -->
                        <div class="clientes-potenciales-lista" id="clientesPotencialesList">
                            <div class="loading">Cargando perfiles de clientes ideales...</div>
                        </div>
                        
                        <!-- Vista de lista -->
                        <div class="perfil-list-view" id="perfilListView">
                            <div class="loading">Cargando vista de lista...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-mode" id="adminMode">
            <!-- El contenido del modo admin se generar√° aqu√≠ -->
        </div>
    </div>

    <script>
        // ‚úÖ CONFIGURACI√ìN
        // Modo Local: deja vac√≠o para guardar en navegador
        // Modo Servidor: usa tu URL de Railway para datos compartidos
        const API_BASE_URL = 'https://scripts-ventas-dpi.up.railway.app'; // Modo servidor activado
        
        let SCRIPTS_DATA = {};
        let currentEditingId = null;
        let isAuthenticated = false;
        let debounceTimer = null;
        let connectionInterval = null;
        let CLIENTES_POTENCIALES = [];
        let currentEditingClienteId = null;
        let currentView = 'cards'; // 'cards' o 'list'

        // ‚úÖ FUNCI√ìN DE ALERTAS
        function showAlert(message, type = 'success', containerId = 'alertContainer') {
            let container = document.getElementById(containerId);
            if (!container) {
                container = document.getElementById('mainContent');
                if (!container) return;
            }
            
            const alertEl = document.createElement('div');
            alertEl.className = `alert ${type}`;
            alertEl.textContent = message;
            container.prepend(alertEl);
            
            setTimeout(() => {
                if (alertEl.parentNode) {
                    alertEl.remove();
                }
            }, 4000);
        }

        // ‚úÖ LLAMADAS A API
        async function apiCall(endpoint, options = {}) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                console.log('API Call:', url);
                
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                
                updateConnectionStatus(true);
                
                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                    } catch {
                        errorData = { error: `Error HTTP: ${response.status}` };
                    }
                    throw new Error(errorData.error || `Error HTTP: ${response.status}`);
                }
                
                const contentType = response.headers.get("content-type");
                if (contentType?.includes("application/json")) {
                    return await response.json();
                } else {
                    return await response.blob();
                }
            } catch (error) {
                console.error('API Error:', error);
                updateConnectionStatus(false);
                showAlert(`Error de conexi√≥n: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // ‚úÖ CARGA DE DATOS
        async function fetchAllData() {
            const container = document.getElementById('scriptsContainer');
            if (container) {
                container.innerHTML = '<div class="loading">Cargando scripts...</div>';
            }
            
            try {
                const data = await apiCall('/api/scripts');
                SCRIPTS_DATA = data;
                renderVentasUI();
                updateSystemStatus();
            } catch (error) {
                if (container) {
                    container.innerHTML = `
                        <div class="error-message">
                            ‚ùå Error al cargar scripts: ${error.message}
                            <br><br>
                            <button onclick="fetchAllData()" class="copy-btn">üîÑ Reintentar</button>
                        </div>
                    `;
                }
            }
        }

        // ‚úÖ CARGA DE CLIENTES POTENCIALES
        async function cargarClientesPotenciales() {
            try {
                // Si no hay servidor, usar localStorage como fallback
                if (!API_BASE_URL) {
                    const localData = localStorage.getItem('dpi_clientes_potenciales');
                    CLIENTES_POTENCIALES = localData ? JSON.parse(localData) : [];
                    renderClientesPotenciales();
                    showAlert('üíæ Datos cargados desde almacenamiento local', 'success');
                    return;
                }
                
                const data = await apiCall('/api/clientes-potenciales');
                CLIENTES_POTENCIALES = data;
                renderClientesPotenciales();
            } catch (error) {
                console.error('Error al cargar perfiles de clientes ideales:', error);
                
                // Fallback a localStorage si falla el servidor
                const localData = localStorage.getItem('dpi_clientes_potenciales');
                if (localData) {
                    CLIENTES_POTENCIALES = JSON.parse(localData);
                    renderClientesPotenciales();
                    showAlert('‚ö†Ô∏è Servidor no disponible. Usando datos locales.', 'error');
                    return;
                }
                
                const container = document.getElementById('clientesPotencialesList');
                if (container) {
                    container.innerHTML = `
                        <div class="error-message">
                            ‚ùå Error al cargar perfiles: ${error.message}
                            <br><br>
                            <button onclick="cargarClientesPotenciales()" class="copy-btn">üîÑ Reintentar</button>
                        </div>
                    `;
                }
            }
        }

        // ‚úÖ GUARDAR EN LOCALSTORAGE
        function guardarEnLocal() {
            if (!API_BASE_URL) {
                localStorage.setItem('dpi_clientes_potenciales', JSON.stringify(CLIENTES_POTENCIALES));
            }
        }
        
        // ‚úÖ AUTENTICACI√ìN
        function handleAuth(e) {
            e.preventDefault();
            console.log('üîê Intentando autenticaci√≥n...');
            
            const username = document.getElementById('authUsername')?.value;
            const password = document.getElementById('authPassword')?.value;
            const errorEl = document.getElementById('authError');
            
            console.log('Usuario:', username ? '‚úÖ' : '‚ùå', 'Password:', password ? '‚úÖ' : '‚ùå');
            
            if (!username || !password) {
                if (errorEl) {
                    errorEl.textContent = 'Por favor ingresa usuario y contrase√±a';
                    errorEl.style.display = 'block';
                }
                return;
            }
            
            if (username === 'admin' && password === 'DPI2025Admin') {
                console.log('‚úÖ Autenticaci√≥n exitosa');
                isAuthenticated = true;
                
                // Cerrar modal
                const overlay = document.getElementById('authOverlay');
                if (overlay) overlay.classList.remove('active');
                
                // Quitar blur
                const mainContent = document.getElementById('mainContent');
                if (mainContent) mainContent.style.filter = 'none';
                
                // Cambiar a modo admin
                switchMode('admin', true);
                
                // Limpiar formulario
                const form = document.getElementById('authForm');
                if (form) form.reset();
                if (errorEl) errorEl.style.display = 'none';
                
                showAlert('‚úÖ Acceso administrativo concedido', 'success');
            } else {
                console.log('‚ùå Credenciales incorrectas');
                if (errorEl) {
                    errorEl.textContent = 'Usuario o contrase√±a incorrectos';
                    errorEl.style.display = 'block';
                }
            }
        }

        function cancelAuth() {
            console.log('‚ùå Autenticaci√≥n cancelada');
            const overlay = document.getElementById('authOverlay');
            const mainContent = document.getElementById('mainContent');
            
            if (overlay) overlay.classList.remove('active');
            if (mainContent) mainContent.style.filter = 'none';
            
            const form = document.getElementById('authForm');
            if (form) form.reset();
            
            const errorEl = document.getElementById('authError');
            if (errorEl) errorEl.style.display = 'none';
        }

        function showAuthModal() {
            console.log('üîê Mostrando modal de autenticaci√≥n');
            const overlay = document.getElementById('authOverlay');
            const mainContent = document.getElementById('mainContent');
            
            if (!overlay) {
                console.error('‚ùå Modal de autenticaci√≥n no encontrado');
                showAlert('‚ùå Error: Modal de autenticaci√≥n no disponible', 'error');
                return;
            }
            
            overlay.classList.add('active');
            if (mainContent) mainContent.style.filter = 'blur(5px)';
            
            // Focus en el campo de usuario despu√©s de un momento
            setTimeout(() => {
                const usernameInput = document.getElementById('authUsername');
                if (usernameInput) {
                    usernameInput.focus();
                    console.log('üéØ Focus en campo usuario');
                }
            }, 100);
        }

        // ‚úÖ HACER FUNCIONES GLOBALES PARA ACCESO DESDE HTML
        window.switchMode = switchMode;
        window.showAuthModal = showAuthModal;
        window.handleAuth = handleAuth;
        window.cancelAuth = cancelAuth;
        function switchMode(mode, fromAuth = false) {
            console.log('üîÑ Cambiando a modo:', mode, 'fromAuth:', fromAuth);
            
            const ventasMode = document.getElementById('ventasMode');
            const adminMode = document.getElementById('adminMode');
            const modeButtons = document.querySelectorAll('.mode-btn');

            if (mode === 'admin' && !fromAuth && !isAuthenticated) { 
                console.log('üîê Mostrando modal de autenticaci√≥n...');
                showAuthModal(); 
                return; 
            }
            
            // Remover clase active de todos los botones
            modeButtons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'ventas') {
                console.log('üì± Activando modo ventas');
                if (ventasMode) ventasMode.style.display = 'block';
                if (adminMode) adminMode.style.display = 'none';
                
                const ventasBtn = document.getElementById('ventasModeBtn');
                if (ventasBtn) ventasBtn.classList.add('active');
                
            } else if (mode === 'admin') {
                console.log('‚öôÔ∏è Activando modo admin');
                if (ventasMode) ventasMode.style.display = 'none';
                if (adminMode) {
                    adminMode.style.display = 'block';
                    loadAdminData();
                }
                
                const adminBtn = document.getElementById('adminModeBtn');
                if (adminBtn) adminBtn.classList.add('active');
            }
        }

        // ‚úÖ RENDERIZADO DE UI
        function renderVentasUI() {
            const tabsContainer = document.getElementById('categoryTabs');
            const scriptsContainer = document.getElementById('scriptsContainer');
            
            if (!tabsContainer || !scriptsContainer) return;
            
            tabsContainer.innerHTML = '';
            scriptsContainer.innerHTML = '';
            
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(categoryNames).forEach((category, index) => {
                const tab = document.createElement('button');
                tab.className = `tab ${index === 0 ? 'active' : ''}`;
                tab.textContent = categoryNames[category];
                tab.onclick = (e) => showTab(category, e.target);
                tabsContainer.appendChild(tab);
                
                const section = document.createElement('div');
                section.id = category;
                section.className = `tab-section ${index > 0 ? 'hidden' : ''}`;
                
                if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].length > 0) {
                    section.innerHTML = SCRIPTS_DATA[category].map(createScriptCardHTML).join('');
                } else {
                    section.innerHTML = `<div class="empty-state">No hay scripts en esta categor√≠a.</div>`;
                }
                
                scriptsContainer.appendChild(section);
            });
        }
        
        // ‚úÖ CREACI√ìN DE CARDS
        function createScriptCardHTML(script) {
            const badgeHTML = script.badge ? 
                `<span class="script-badge" style="background-color: ${script.badge.color || '#6c757d'}">
                    ${script.badge.icon} ${script.badge.text}
                </span>` : '';
            
            return `
                <div class="script-card" data-script-id="${script.id}">
                    <div class="script-title">
                        ${script.title}
                        ${badgeHTML}
                    </div>
                    <div class="script-text">${script.text}</div>
                    <div class="usage-stats">
                        <span>üìä ${script.usage_30_days || 0} usos (30d)</span>
                        <span>üìà ${script.usage_7_days || 0} usos (7d)</span>
                    </div>
                    <div class="script-actions">
                        <button class="copy-btn" onclick="copyAndTrack(${script.id})">üìã Copiar</button>
                    </div>
                </div>
            `;
        }
        
        // ‚úÖ NAVEGACI√ìN ENTRE TABS
        function showTab(category, clickedTab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-section').forEach(s => s.classList.add('hidden'));
            
            if (clickedTab) clickedTab.classList.add('active');
            
            const section = document.getElementById(category);
            if (section) section.classList.remove('hidden');
        }

        // ‚úÖ ESTADO DEL SISTEMA
        function updateSystemStatus() {
            const totalCount = SCRIPTS_DATA ? 
                Object.values(SCRIPTS_DATA).reduce((sum, cat) => 
                    sum + (Array.isArray(cat) ? cat.length : 0), 0
                ) : 0;
            
            const statusEl = document.getElementById('systemStatus');
            if (statusEl) {
                const storageMode = !API_BASE_URL ? ' ‚Ä¢ Modo Local' : ' ‚Ä¢ Servidor Online';
                statusEl.className = 'status online';
                statusEl.innerHTML = `‚úÖ Sistema activo - ${totalCount} scripts disponibles${storageMode} - ${new Date().toLocaleTimeString()}`;
            }
        }

        // ‚úÖ ESTADO DE CONEXI√ìN
        function updateConnectionStatus(isOnline) {
            const statusEl = document.getElementById('connectionStatus');
            const headerStatus = document.getElementById('systemStatus');
            
            if (statusEl) {
                statusEl.textContent = isOnline ? 'üü¢ En l√≠nea' : 'üî¥ Sin conexi√≥n';
                statusEl.className = `connection-status ${isOnline ? 'online' : 'offline'}`;
            }
            
            if (headerStatus) {
                headerStatus.className = `status ${isOnline ? 'online' : 'offline'}`;
                if (!isOnline) {
                    headerStatus.textContent = 'üî¥ Error de Servidor';
                }
            }
        }
        
        // ‚úÖ COPIAR Y RASTREAR
        async function copyAndTrack(scriptId) {
            const card = document.querySelector(`.script-card[data-script-id="${scriptId}"]`);
            if (!card) return;
            
            const textElement = card.querySelector('.script-text');
            const button = card.querySelector('.copy-btn');
            
            if (!textElement || !button) return;
            
            const text = textElement.innerText;
            
            try {
                await navigator.clipboard.writeText(text);
                
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copiado';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                
                try {
                    await apiCall(`/api/scripts/${scriptId}/track`, { method: 'POST' });
                } catch (trackError) {
                    console.warn('Error al rastrear uso:', trackError);
                }
                
            } catch (copyError) {
                console.error('Error al copiar:', copyError);
                showAlert('Error al copiar al portapapeles', 'error');
            }
        }

        // ‚úÖ FUNCIONES DEL PROCESO DE PRE-CALIFICACI√ìN
        function iniciarProceso() {
            const procesoPanel = document.getElementById('procesoPanel');
            if (procesoPanel) {
                procesoPanel.style.display = 'block';
                
                setTimeout(() => {
                    procesoPanel.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
                
                showAlert('üéØ Proceso de calificaci√≥n iniciado. Sigue cada etapa en orden.', 'success');
            }
        }
        
        function cerrarProceso() {
            const procesoPanel = document.getElementById('procesoPanel');
            if (procesoPanel) {
                procesoPanel.style.display = 'none';
                showAlert('üìã Proceso de calificaci√≥n cerrado', 'success');
            }
        }
        
        function irACategoria(categoria) {
            cerrarProceso();
            
            const tabs = Array.from(document.querySelectorAll('.tab'));
            const targetTab = tabs.find(tab => {
                const tabText = tab.textContent.toLowerCase();
                return tabText.includes(categoria);
            });
            
            if (targetTab) {
                showTab(categoria, targetTab);
                
                setTimeout(() => {
                    document.getElementById('categoryTabs').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                }, 100);
                
                showAlert(`üìù Mostrando scripts de ${getCategoryName(categoria)}`, 'success');
            }
        }
        
        function tomarDecision(decision) {
            const messages = {
                'verde': {
                    title: 'üü¢ DECISI√ìN: PROCEDER A COTIZACI√ìN',
                    message: 'Cliente calificado correctamente. Puedes invertir tiempo en una cotizaci√≥n formal.',
                    category: 'cierre'
                },
                'amarillo': {
                    title: 'üü° DECISI√ìN: INVESTIGAR M√ÅS',
                    message: 'Cliente necesita m√°s calificaci√≥n. Programa una segunda llamada con preguntas espec√≠ficas.',
                    category: 'calificacion'
                },
                'rojo': {
                    title: 'üî¥ DECISI√ìN: PAUSAR PROCESO',
                    message: 'Cliente no calificado. No inviertas tiempo en cotizaci√≥n. Usa scripts b√°sicos.',
                    category: 'bienvenida'
                }
            };
            
            const msg = messages[decision];
            showAlert(msg.message, decision === 'verde' ? 'success' : 'error');
            
            if (confirm(`${msg.title}\n\n${msg.message}\n\n¬øQuieres ver los scripts recomendados para esta situaci√≥n?`)) {
                irACategoria(msg.category);
            } else {
                cerrarProceso();
            }
        }

        // ‚úÖ NUEVO SISTEMA DE VISTAS PARA CLIENTES IDEALES

        // Cambiar entre vista de tarjetas y lista
        function cambiarVista(vista) {
            currentView = vista;
            
            const cardsViewBtn = document.getElementById('cardsViewBtn');
            const listViewBtn = document.getElementById('listViewBtn');
            const cardsContainer = document.getElementById('clientesPotencialesList');
            const listContainer = document.getElementById('perfilListView');
            
            if (vista === 'cards') {
                cardsViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                cardsContainer.style.display = 'grid';
                listContainer.classList.remove('active');
                renderClientesPotenciales();
            } else {
                listViewBtn.classList.add('active');
                cardsViewBtn.classList.remove('active');
                cardsContainer.style.display = 'none';
                listContainer.classList.add('active');
                renderVistaLista();
            }
        }

        // Renderizar vista de lista compacta
        function renderVistaLista() {
            const container = document.getElementById('perfilListView');
            if (!container) return;
            
            const perfilesFiltrados = filtrarPerfilesData();
            
            if (perfilesFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="cliente-empty">
                        üìö No hay perfiles que coincidan con los filtros.<br>
                        ${CLIENTES_POTENCIALES.length === 0 ? '¬°Agrega el primer perfil usando el bot√≥n de arriba!' : 'Prueba ajustando los filtros.'}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = perfilesFiltrados.map(cliente => createPerfilListItem(cliente)).join('');
        }

        function createPerfilListItem(cliente) {
            const tipoLabels = {
                restaurante: "üçΩÔ∏è Restaurante",
                retail: "üè™ Retail", 
                servicios: "üíº Servicios",
                clinica: "üè• Cl√≠nica",
                empresa: "üè¢ Empresa",
                otro: "üìã Otro"
            };
            
            const presupuestoLabels = {
                bajo: "Bajo",
                medio: "Medio", 
                alto: "Alto"
            };
            
            const urgenciaLabels = {
                baja: "Planifican",
                media: "Normal",
                alta: "R√°pidos"
            };
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            return `
                <div class="perfil-list-item" onclick="verDetallesPerfil(${cliente.id})">
                    <div class="list-item-content">
                        <div>
                            <div class="list-item-name">${cliente.nombre}</div>
                            <div class="list-item-info">${cliente.contacto || 'Sin contacto'} ‚Ä¢ ${cliente.telefono || 'Sin ubicaci√≥n'}</div>
                        </div>
                        <div class="list-item-info">
                            ${tipoLabels[cliente.tipo] || cliente.tipo}
                        </div>
                        <div class="list-item-badges">
                            ${cliente.presupuesto ? `<span class="badge-smart badge-presupuesto ${cliente.presupuesto}">${presupuestoLabels[cliente.presupuesto]}</span>` : ''}
                            ${cliente.urgencia ? `<span class="badge-smart badge-urgencia ${cliente.urgencia}">${urgenciaLabels[cliente.urgencia]}</span>` : ''}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="action-btn copy" onclick="event.stopPropagation(); copiarPerfil(${cliente.id})" title="Copiar perfil">
                            üìã
                        </button>
                        <button class="action-btn edit" onclick="event.stopPropagation(); editarCliente(${cliente.id})" title="Editar">
                            ‚úèÔ∏è
                        </button>
                        <button class="action-btn delete" onclick="event.stopPropagation(); eliminarCliente(${cliente.id})" title="Eliminar">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `;
        }

        // Ver detalles del perfil en modal o expandir
        function verDetallesPerfil(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            const modal = `
                <div class="auth-overlay active" onclick="cerrarModal(event)">
                    <div class="auth-modal" style="max-width: 600px; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">${cliente.nombre}</h2>
                            <button onclick="cerrarModal()" style="background: var(--danger-color); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">‚úñÔ∏è</button>
                        </div>
                        
                        <div style="text-align: left;">
                            <div style="margin-bottom: 15px;">
                                <strong>üè¢ Tipo de Negocio:</strong><br>
                                ${cliente.tipo}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>üë§ Contacto T√≠pico:</strong><br>
                                ${cliente.contacto || 'No especificado'}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>üìç Ubicaci√≥n T√≠pica:</strong><br>
                                ${cliente.telefono || 'No especificado'}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>üéØ Caracter√≠sticas IDEALES:</strong><br>
                                ${cliente.caracteristicas}
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <strong>üì¢ Publicidad que necesitan:</strong><br>
                                ${cliente.necesidad}
                            </div>
                            
                            ${proximosPasos ? `
                                <div style="margin-bottom: 15px;">
                                    <strong>üí° Estrategias de Approach:</strong><br>
                                    ${proximosPasos}
                                </div>
                            ` : ''}
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                                <button class="action-btn copy" onclick="copiarPerfil(${cliente.id})">üìã Copiar Perfil</button>
                                <button class="action-btn share" onclick="compartirPerfil(${cliente.id})">üì§ Compartir</button>
                                <button class="action-btn edit" onclick="editarCliente(${cliente.id}); cerrarModal();">‚úèÔ∏è Editar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function cerrarModal(event) {
            if (event && event.target.classList.contains('auth-overlay')) {
                event.target.remove();
            } else if (!event) {
                document.querySelector('.auth-overlay')?.remove();
            }
        }

        // Copiar perfil al portapapeles
        function copiarPerfil(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            const texto = `
üéØ PERFIL DE CLIENTE IDEAL: ${cliente.nombre}

üè¢ Tipo: ${cliente.tipo}
üë§ Contacto t√≠pico: ${cliente.contacto || 'No especificado'}
üìç Ubicaci√≥n: ${cliente.telefono || 'No especificado'}

üí∞ Presupuesto: ${cliente.presupuesto || 'No especificado'}
‚ö° Decisi√≥n: ${cliente.urgencia || 'No especificado'}

üéØ CARACTER√çSTICAS IDEALES:
${cliente.caracteristicas}

üì¢ PUBLICIDAD QUE NECESITAN:
${cliente.necesidad}

${proximosPasos ? `üí° ESTRATEGIAS DE APPROACH:
${proximosPasos}` : ''}

üìù Documentado por: ${cliente.vendedor || 'No especificado'}
üìÖ Fecha: ${fechaContacto ? new Date(fechaContacto).toLocaleDateString() : 'No especificada'}

---
Generado por DPI Sistema de Ventas
            `.trim();
            
            navigator.clipboard.writeText(texto).then(() => {
                showAlert('‚úÖ Perfil copiado al portapapeles', 'success');
            }).catch(() => {
                showAlert('‚ùå Error al copiar perfil', 'error');
            });
        }

        // Compartir perfil espec√≠fico
        function compartirPerfil(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            if (navigator.share) {
                navigator.share({
                    title: `Perfil de Cliente Ideal: ${cliente.nombre}`,
                    text: `Caracter√≠sticas y estrategias para ${cliente.nombre} - ${cliente.tipo}`,
                    url: window.location.href
                }).catch(err => console.log('Error al compartir:', err));
            } else {
                copiarPerfil(id);
                showAlert('üìã Perfil copiado. Comp√°rtelo peg√°ndolo donde necesites.', 'success');
            }
        }

        // ‚úÖ EXPORTAR JSON para reimportar
        function exportarJSON() {
            const perfilesFiltrados = filtrarPerfilesData();
            
            if (perfilesFiltrados.length === 0) {
                showAlert('‚ùå No hay perfiles para exportar con los filtros actuales', 'error');
                return;
            }
            
            const jsonData = JSON.stringify(perfilesFiltrados, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `perfiles_dpi_${new Date().toISOString().split('T')[0]}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            const storageInfo = !API_BASE_URL ? ' (respaldo local)' : '';
            showAlert(`üíæ ${perfilesFiltrados.length} perfiles exportados en JSON${storageInfo}`, 'success');
        }

        // ‚úÖ EXPORTAR todos los perfiles filtrados
        function exportarPerfiles() {
            const perfilesFiltrados = filtrarPerfilesData();
            
            if (perfilesFiltrados.length === 0) {
                showAlert('‚ùå No hay perfiles para exportar con los filtros actuales', 'error');
                return;
            }
            
            let csvContent = "Nombre,Tipo,Contacto,Ubicaci√≥n,Caracter√≠sticas,Necesidad,Presupuesto,Urgencia,Estrategias,Vendedor,Fecha\n";
            
            perfilesFiltrados.forEach(cliente => {
                const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos || '';
                const fechaContacto = cliente.fecha_contacto || cliente.fecha || '';
                
                csvContent += `"${cliente.nombre}","${cliente.tipo}","${cliente.contacto || ''}","${cliente.telefono || ''}","${cliente.caracteristicas}","${cliente.necesidad}","${cliente.presupuesto || ''}","${cliente.urgencia || ''}","${proximosPasos}","${cliente.vendedor || ''}","${fechaContacto}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `perfiles_clientes_ideales_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            const storageInfo = !API_BASE_URL ? ' (datos locales)' : '';
            showAlert(`üìä ${perfilesFiltrados.length} perfiles exportados exitosamente${storageInfo}`, 'success');
        }

        // Compartir todos los perfiles
        function compartirPerfiles() {
            const perfilesFiltrados = filtrarPerfilesData();
            
            if (perfilesFiltrados.length === 0) {
                showAlert('‚ùå No hay perfiles para compartir con los filtros actuales', 'error');
                return;
            }
            
            let resumen = `üéØ PERFILES DE CLIENTES IDEALES - DPI PUBLICIDAD\n\n`;
            resumen += `üìä Total de perfiles: ${perfilesFiltrados.length}\n`;
            resumen += `üìÖ Generado: ${new Date().toLocaleDateString()}\n\n`;
            
            perfilesFiltrados.forEach((cliente, index) => {
                resumen += `${index + 1}. ${cliente.nombre} (${cliente.tipo})\n`;
                resumen += `   üí∞ ${cliente.presupuesto || 'N/A'} | ‚ö° ${cliente.urgencia || 'N/A'}\n`;
                resumen += `   ${cliente.caracteristicas.substring(0, 100)}...\n\n`;
            });
            
            if (navigator.share) {
                navigator.share({
                    title: 'Perfiles de Clientes Ideales - DPI Publicidad',
                    text: resumen,
                    url: window.location.href
                }).catch(err => console.log('Error al compartir:', err));
            } else {
                navigator.clipboard.writeText(resumen).then(() => {
                    showAlert('üìã Resumen de perfiles copiado al portapapeles', 'success');
                }).catch(() => {
                    showAlert('‚ùå Error al copiar resumen', 'error');
                });
            }
        }

        // Mostrar estad√≠sticas de perfiles
        function mostrarEstadisticas() {
            const total = CLIENTES_POTENCIALES.length;
            const perfilesFiltrados = filtrarPerfilesData();
            
            // Estad√≠sticas por tipo
            const porTipo = {};
            const porPresupuesto = {};
            const porUrgencia = {};
            
            CLIENTES_POTENCIALES.forEach(cliente => {
                porTipo[cliente.tipo] = (porTipo[cliente.tipo] || 0) + 1;
                if (cliente.presupuesto) porPresupuesto[cliente.presupuesto] = (porPresupuesto[cliente.presupuesto] || 0) + 1;
                if (cliente.urgencia) porUrgencia[cliente.urgencia] = (porUrgencia[cliente.urgencia] || 0) + 1;
            });
            
            const modoAlmacenamiento = !API_BASE_URL ? 
                '<div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid #ffc107;"><strong>üíæ Modo Local:</strong> Los datos se guardan en tu navegador. Exporta regularmente como respaldo.</div>' :
                '<div style="background: #d4edda; padding: 10px; border-radius: 5px; margin-bottom: 15px; border-left: 4px solid #28a745;"><strong>üåê Modo Servidor:</strong> Los datos se sincronizan autom√°ticamente.</div>';
            
            const estadisticas = `
                <div class="auth-overlay active" onclick="cerrarModal(event)">
                    <div class="auth-modal" style="max-width: 500px;" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="margin: 0;">üìà Estad√≠sticas de Perfiles</h2>
                            <button onclick="cerrarModal()" style="background: var(--danger-color); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">‚úñÔ∏è</button>
                        </div>
                        
                        <div style="text-align: left;">
                            ${modoAlmacenamiento}
                            
                            <div style="background: var(--bg-color); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4>üìä Resumen General</h4>
                                <p><strong>Total de perfiles:</strong> ${total}</p>
                                <p><strong>Perfiles filtrados:</strong> ${perfilesFiltrados.length}</p>
                            </div>
                            
                            <div style="background: var(--bg-color); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4>üè¢ Por Tipo de Negocio</h4>
                                ${Object.entries(porTipo).map(([tipo, count]) => 
                                    `<p>${tipo}: <strong>${count}</strong> (${Math.round(count/total*100)}%)</p>`
                                ).join('')}
                            </div>
                            
                            <div style="background: var(--bg-color); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h4>üí∞ Por Presupuesto</h4>
                                ${Object.entries(porPresupuesto).map(([presupuesto, count]) => 
                                    `<p>${presupuesto}: <strong>${count}</strong> (${Math.round(count/total*100)}%)</p>`
                                ).join('')}
                            </div>
                            
                            <div style="background: var(--bg-color); padding: 15px; border-radius: 8px;">
                                <h4>‚ö° Por Urgencia</h4>
                                ${Object.entries(porUrgencia).map(([urgencia, count]) => 
                                    `<p>${urgencia}: <strong>${count}</strong> (${Math.round(count/total*100)}%)</p>`
                                ).join('')}
                            </div>
                            
                            ${!API_BASE_URL ? `
                                <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button onclick="exportarPerfiles(); cerrarModal();" class="action-btn export" style="flex: 1;">üìä Exportar Respaldo</button>
                                    <button onclick="importarRespaldo(); cerrarModal();" class="action-btn" style="flex: 1;">üì• Importar Datos</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', estadisticas);
        }

        // ‚úÖ IMPORTAR RESPALDO DE DATOS
        function importarRespaldo() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.csv';
            input.style.display = 'none';
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        let importedData;
                        
                        if (file.name.endsWith('.json')) {
                            importedData = JSON.parse(event.target.result);
                        } else if (file.name.endsWith('.csv')) {
                            // Aqu√≠ podr√≠as agregar l√≥gica para parsear CSV
                            showAlert('‚ùå Importaci√≥n de CSV no implementada a√∫n. Usa archivos JSON.', 'error');
                            return;
                        }
                        
                        if (Array.isArray(importedData)) {
                            const respuesta = confirm(`¬øImportar ${importedData.length} perfiles?\n\n‚ö†Ô∏è Esto reemplazar√° todos los datos actuales.`);
                            if (respuesta) {
                                CLIENTES_POTENCIALES = importedData;
                                guardarEnLocal();
                                renderClientesPotenciales();
                                showAlert(`‚úÖ ${importedData.length} perfiles importados exitosamente`, 'success');
                            }
                        } else {
                            showAlert('‚ùå Formato de archivo no v√°lido', 'error');
                        }
                        
                    } catch (error) {
                        showAlert(`‚ùå Error al importar: ${error.message}`, 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        // ‚úÖ RENDERIZADO MEJORADO DE PERFILES
        function renderClientesPotenciales() {
            if (currentView === 'list') {
                renderVistaLista();
                return;
            }
            
            const container = document.getElementById('clientesPotencialesList');
            if (!container) return;
            
            const perfilesFiltrados = filtrarPerfilesData();
            
            // Mostrar contador
            const countEl = document.getElementById('perfilesCount');
            if (countEl) {
                countEl.textContent = `üìä ${perfilesFiltrados.length} perfil${perfilesFiltrados.length !== 1 ? 'es' : ''} encontrado${perfilesFiltrados.length !== 1 ? 's' : ''}`;
            }
            
            if (perfilesFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="cliente-empty">
                        üìö No hay perfiles que coincidan con los filtros.<br>
                        ${CLIENTES_POTENCIALES.length === 0 ? '¬°Agrega el primer perfil usando el bot√≥n de arriba!' : 'Prueba ajustando los filtros.'}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = perfilesFiltrados.map(cliente => createPerfilCardEnhanced(cliente)).join('');
        }
        
        function createPerfilCardEnhanced(cliente) {
            const tipoLabels = {
                restaurante: "üçΩÔ∏è Restaurante",
                retail: "üè™ Retail", 
                servicios: "üíº Servicios",
                clinica: "üè• Cl√≠nica",
                empresa: "üè¢ Empresa",
                otro: "üìã Otro"
            };
            
            const presupuestoLabels = {
                bajo: "Bajo",
                medio: "Medio", 
                alto: "Alto"
            };
            
            const urgenciaLabels = {
                baja: "Planifican",
                media: "Normal",
                alta: "R√°pidos"
            };
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            return `
                <div class="perfil-card-enhanced" id="perfil-${cliente.id}">
                    <div class="perfil-header-enhanced">
                        <div class="perfil-nombre-enhanced">
                            ${cliente.nombre}
                        </div>
                        <div class="perfil-badges">
                            <span class="badge-smart badge-tipo">${tipoLabels[cliente.tipo] || cliente.tipo}</span>
                            ${cliente.presupuesto ? `<span class="badge-smart badge-presupuesto ${cliente.presupuesto}">${presupuestoLabels[cliente.presupuesto]}</span>` : ''}
                            ${cliente.urgencia ? `<span class="badge-smart badge-urgencia ${cliente.urgencia}">${urgenciaLabels[cliente.urgencia]}</span>` : ''}
                            ${fechaContacto ? `<span class="badge-smart badge-fecha">${new Date(fechaContacto).toLocaleDateString()}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="perfil-preview">
                        <div class="preview-item">
                            <strong>üë§ Contacto t√≠pico:</strong>
                            <span>${cliente.contacto || 'No especificado'}</span>
                        </div>
                        <div class="preview-item">
                            <strong>üìç Ubicaci√≥n t√≠pica:</strong>
                            <span>${cliente.telefono || 'No especificado'}</span>
                        </div>
                    </div>
                    
                    <div class="preview-item" style="grid-column: 1 / -1;">
                        <strong>üéØ Caracter√≠sticas IDEALES:</strong>
                        <span>${cliente.caracteristicas.length > 150 ? cliente.caracteristicas.substring(0, 150) + '...' : cliente.caracteristicas}</span>
                    </div>
                    
                    <div class="perfil-actions-enhanced">
                        <div class="perfil-stats">
                            <div class="stat-item">
                                <span>üìù</span>
                                <span>Por: ${cliente.vendedor || 'No especificado'}</span>
                            </div>
                            <div class="stat-item">
                                <span>üìÖ</span>
                                <span>${fechaContacto ? new Date(fechaContacto).toLocaleDateString() : 'Sin fecha'}</span>
                            </div>
                        </div>
                        
                        <div class="action-group">
                            <button class="action-btn copy" onclick="copiarPerfil(${cliente.id})" title="Copiar perfil">
                                üìã
                            </button>
                            <button class="action-btn share" onclick="compartirPerfil(${cliente.id})" title="Compartir">
                                üì§
                            </button>
                            <button class="action-btn expand" onclick="verDetallesPerfil(${cliente.id})" title="Ver detalles">
                                üëÅÔ∏è
                            </button>
                            <button class="action-btn edit" onclick="editarCliente(${cliente.id})" title="Editar">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn delete" onclick="eliminarCliente(${cliente.id})" title="Eliminar">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ‚úÖ FUNCIONES DE FILTRADO
        function filtrarPerfilesData() {
            const filtroTipo = document.getElementById('filtroTipo')?.value || '';
            const filtroPresupuesto = document.getElementById('filtroPresupuesto')?.value || '';
            const filtroUrgencia = document.getElementById('filtroUrgencia')?.value || '';
            
            return CLIENTES_POTENCIALES.filter(cliente => {
                const cumpleTipo = !filtroTipo || cliente.tipo === filtroTipo;
                const cumplePresupuesto = !filtroPresupuesto || cliente.presupuesto === filtroPresupuesto;
                const cumpleUrgencia = !filtroUrgencia || cliente.urgencia === filtroUrgencia;
                
                return cumpleTipo && cumplePresupuesto && cumpleUrgencia;
            });
        }
        
        function filtrarPerfiles() {
            renderClientesPotenciales();
        }
        
        function abrirFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                document.getElementById('clienteForm').reset();
                document.getElementById('clienteId').value = '';
                currentEditingClienteId = null;
                
                titulo.textContent = '‚ûï Agregar Nuevo Perfil de Cliente Ideal';
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
                
                showAlert('üìù Formulario abierto. Documenta un perfil de cliente ideal para el equipo.', 'success');
            }
        }
        
        function cerrarFormularioCliente() {
            const formulario = document.getElementById('formularioCliente');
            if (formulario) {
                formulario.style.display = 'none';
                currentEditingClienteId = null;
            }
        }
        
        function editarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) {
                showAlert('Cliente no encontrado', 'error');
                return;
            }
            
            const proximosPasos = cliente.proximos_pasos || cliente.proximosPasos;
            const fechaContacto = cliente.fecha_contacto || cliente.fecha;
            
            document.getElementById('clienteId').value = cliente.id;
            document.getElementById('clienteNombre').value = cliente.nombre;
            document.getElementById('clienteTipo').value = cliente.tipo;
            document.getElementById('clienteContacto').value = cliente.contacto || '';
            document.getElementById('clienteTelefono').value = cliente.telefono || '';
            document.getElementById('clienteCaracteristicas').value = cliente.caracteristicas;
            document.getElementById('clienteNecesidad').value = cliente.necesidad;
            document.getElementById('clientePresupuesto').value = cliente.presupuesto || '';
            document.getElementById('clienteUrgencia').value = cliente.urgencia || '';
            document.getElementById('clienteProximosPasos').value = proximosPasos || '';
            document.getElementById('clienteVendedor').value = cliente.vendedor || '';
            document.getElementById('clienteFecha').value = fechaContacto || '';
            
            currentEditingClienteId = id;
            
            const formulario = document.getElementById('formularioCliente');
            const titulo = document.getElementById('tituloFormulario');
            
            if (formulario && titulo) {
                titulo.textContent = `‚úèÔ∏è Editando: ${cliente.nombre}`;
                formulario.style.display = 'block';
                
                setTimeout(() => {
                    formulario.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }
        }

        async function eliminarCliente(id) {
            const cliente = CLIENTES_POTENCIALES.find(c => c.id === id);
            if (!cliente) return;
            
            if (!confirm(`¬øEst√°s seguro de que quieres eliminar a "${cliente.nombre}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                // Si no hay servidor, solo eliminar localmente
                if (!API_BASE_URL) {
                    CLIENTES_POTENCIALES = CLIENTES_POTENCIALES.filter(c => c.id !== id);
                    guardarEnLocal();
                    renderClientesPotenciales();
                    showAlert('Cliente eliminado exitosamente (guardado localmente)', 'success');
                    return;
                }
                
                await apiCall(`/api/clientes-potenciales/${id}`, { 
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                CLIENTES_POTENCIALES = CLIENTES_POTENCIALES.filter(c => c.id !== id);
                renderClientesPotenciales();
                showAlert('Cliente eliminado exitosamente', 'success');
                
            } catch (error) {
                showAlert(`Error al eliminar cliente: ${error.message}`, 'error');
            }
        }

        // ‚úÖ B√öSQUEDA
        function performSearch(query) {
            const resultsContainer = document.getElementById('searchResults');
            if (!resultsContainer) return;
            
            resultsContainer.innerHTML = `<div class="loading" style="padding:10px;">Buscando...</div>`;
            resultsContainer.classList.add('active');
            
            if (window.searchController) {
                window.searchController.abort();
            }
            
            window.searchController = new AbortController();
            
            apiCall(`/api/scripts/search?q=${encodeURIComponent(query)}`, {
                signal: window.searchController.signal
            })
                .then(results => {
                    if (!results || !Array.isArray(results)) {
                        resultsContainer.innerHTML = `<div class="search-result-item error-message">Error en formato de respuesta</div>`;
                        return;
                    }
                    
                    if (results.length > 0) {
                        resultsContainer.innerHTML = results.map(result => `
                            <div class="search-result-item" onclick="scrollToScript(${result.id})">
                                <div class="search-result-category">${getCategoryName(result.category)}</div>
                                <div>${result.highlightedTitle}</div>
                                <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 5px;">${result.highlightedText || ''}</div>
                            </div>
                        `).join('');
                    } else {
                        resultsContainer.innerHTML = `
                            <div class="search-result-item" style="text-align: center; color: #7f8c8d;">
                                üîç No se encontraron resultados para "${query}"
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    if (error.name === 'AbortError') return;
                    
                    resultsContainer.innerHTML = `
                        <div class="search-result-item error-message">
                            ‚ùå Error en la b√∫squeda: ${error.message}
                        </div>
                    `;
                });
        }
        
        function getCategoryName(category) {
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            return categoryNames[category] || category;
        }

        function scrollToScript(id) {
            const searchResults = document.getElementById('searchResults');
            if (searchResults) {
                searchResults.classList.remove('active');
            }
            
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            
            const card = document.querySelector(`.script-card[data-script-id="${id}"]`);
            if (!card) {
                showAlert('Script no encontrado en la vista actual', 'error');
                return;
            }
            
            let categoryKey = null;
            for (const category in SCRIPTS_DATA) {
                if (SCRIPTS_DATA[category].some(s => s.id == id)) {
                    categoryKey = category;
                    break;
                }
            }
            
            if (categoryKey) {
                const tabs = Array.from(document.querySelectorAll('.tab'));
                const targetTab = tabs.find(tab => {
                    const tabText = tab.textContent.toLowerCase();
                    return tabText.includes(categoryKey) || 
                           tabText.includes(getCategoryName(categoryKey).toLowerCase());
                });
                
                if (targetTab) {
                    showTab(categoryKey, targetTab);
                }
            }
            
            setTimeout(() => {
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                card.style.transition = 'background-color 0.5s ease';
                card.style.backgroundColor = '#fff3cd';
                
                setTimeout(() => {
                    card.style.backgroundColor = '';
                }, 2000);
            }, 100);
        }

        // ‚úÖ MANEJO DEL SEM√ÅFORO
        function handleSemaforoClick(color) {
            const categoryMap = {
                'verde': 'cierre',
                'amarillo': 'calificacion',
                'rojo': 'bienvenida'
            };
            
            const targetCategory = categoryMap[color];
            
            const messages = {
                'verde': 'üü¢ Cliente LISTO para cotizar ‚Üí Ir a scripts de CIERRE',
                'amarillo': 'üü° Cliente necesita INVESTIGACI√ìN ‚Üí Ir a scripts de CALIFICACI√ìN', 
                'rojo': 'üî¥ Cliente PROBLEM√ÅTICO ‚Üí Usar scripts b√°sicos de BIENVENIDA'
            };
            
            showAlert(messages[color], 'success');
            
            setTimeout(() => {
                const tabs = Array.from(document.querySelectorAll('.tab'));
                const targetTab = tabs.find(tab => {
                    const tabText = tab.textContent.toLowerCase();
                    return tabText.includes(targetCategory);
                });
                
                if (targetTab) {
                    showTab(targetCategory, targetTab);
                    
                    setTimeout(() => {
                        document.getElementById('categoryTabs').scrollIntoView({ 
                            behavior: 'smooth' 
                        });
                    }, 100);
                }
            }, 1500);
        }

        // ‚úÖ CARGA DE DATOS ADMIN
        function loadAdminData() {
            const adminContainer = document.getElementById('adminMode');
            if (!adminContainer) return;
            
            if (!adminContainer.querySelector('.admin-controls')) {
                adminContainer.innerHTML = `
                    <div class="panel stats-bar" id="statsBar">
                        <div class="stats-item">
                            <span class="stats-number">---</span>
                            <span class="stats-label">Cargando...</span>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h2>üìä Analytics</h2>
                        <div id="analyticsContainer">
                            <div class="loading">Cargando analytics...</div>
                        </div>
                    </div>
                    
                    <div class="admin-controls">
                        <div class="panel">
                            <h2 id="formTitle">‚ûï Agregar Script</h2>
                            <div id="alertContainer"></div>
                            <form id="scriptForm">
                                <div class="form-group">
                                    <label>Categor√≠a</label>
                                    <select id="scriptCategory" required>
                                        <option value="">Seleccionar categor√≠a</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>T√≠tulo</label>
                                    <input type="text" id="scriptTitle" required placeholder="Ingresa el t√≠tulo del script">
                                </div>
                                <div class="form-group">
                                    <label>Texto</label>
                                    <textarea id="scriptText" required placeholder="Ingresa el contenido del script"></textarea>
                                </div>
                                <button type="submit" class="admin-btn success">üíæ Guardar</button>
                                <button type="button" class="admin-btn danger" onclick="clearForm()">üóëÔ∏è Limpiar</button>
                            </form>
                        </div>
                        
                        <div class="panel">
                            <h2>üìù Scripts Existentes</h2>
                            <div class="form-group">
                                <label>Filtrar por categor√≠a</label>
                                <select id="filterCategory">
                                    <option value="all">Todas las categor√≠as</option>
                                </select>
                            </div>
                            <div class="scripts-list" id="scriptsList">
                                <div class="loading">Cargando scripts...</div>
                            </div>
                        </div>
                    </div>
                `;
                
                const scriptForm = document.getElementById('scriptForm');
                if (scriptForm) {
                    scriptForm.addEventListener('submit', handleAdminFormSubmit);
                }
                
                const filterCategory = document.getElementById('filterCategory');
                if (filterCategory) {
                    filterCategory.addEventListener('change', renderAdminList);
                }
            }
            
            populateCategorySelect('scriptCategory');
            populateCategorySelect('filterCategory');
            renderAdminList();
            loadAnalyticsDashboard();
            updateAdminStats();
        }

        // ‚úÖ POBLAR SELECTS
        function populateCategorySelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            select.innerHTML = '';
            
            if (selectId === 'filterCategory') {
                select.innerHTML = `<option value="all">Todas las categor√≠as</option>`;
            } else {
                select.innerHTML = `<option value="">Seleccionar categor√≠a</option>`;
            }
            
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(categoryNames).forEach(key => {
                select.innerHTML += `<option value="${key}">${categoryNames[key]}</option>`;
            });
            
            if (currentValue && (currentValue === 'all' || categoryNames[currentValue])) {
                select.value = currentValue;
            }
        }

        // ‚úÖ RENDERIZADO LISTA ADMIN
        function renderAdminList() {
            const listContainer = document.getElementById('scriptsList');
            const filterSelect = document.getElementById('filterCategory');
            
            if (!listContainer) return;
            
            const filter = filterSelect ? filterSelect.value : 'all';
            listContainer.innerHTML = '';
            
            let hasScripts = false;
            const categoryNames = {
                bienvenida: "üí¨ Bienvenida", 
                calificacion: "üîç Calificaci√≥n", 
                objeciones: "üõ°Ô∏è Objeciones", 
                seguimiento: "üìû Seguimiento", 
                cierre: "üéØ Cierre"
            };
            
            Object.keys(SCRIPTS_DATA).forEach(category => {
                if (filter === 'all' || filter === category) {
                    if (SCRIPTS_DATA[category] && SCRIPTS_DATA[category].length > 0) {
                        hasScripts = true;
                        
                        if (filter === 'all') {
                            listContainer.innerHTML += `
                                <div style="margin: 20px 0 10px 0; font-weight: 600; color: var(--primary-color);">
                                    ${categoryNames[category] || category}
                                </div>
                            `;
                        }
                        
                        SCRIPTS_DATA[category].forEach(script => {
                            listContainer.innerHTML += `
                                <div class="script-item">
                                    <div>
                                        <h4>${script.title}</h4>
                                        <small style="color: #7f8c8d;">${script.text.substring(0, 60)}...</small>
                                    </div>
                                    <div class="script-item-actions">
                                        <button class="edit-btn" onclick="editScript(${script.id})">‚úèÔ∏è Editar</button>
                                        <button class="delete-btn" onclick="deleteScript(${script.id})">üóëÔ∏è Eliminar</button>
                                    </div>
                                </div>
                            `;
                        });
                    }
                }
            });
            
            if (!hasScripts) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        ${filter === 'all' ? 'No hay scripts disponibles.' : `No hay scripts en la categor√≠a "${categoryNames[filter] || filter}".`}
                    </div>
                `;
            }
        }

        // ‚úÖ MANEJO DE FORMULARIO ADMIN
        async function handleAdminFormSubmit(e) {
            e.preventDefault();
            
            const categoryEl = document.getElementById('scriptCategory');
            const titleEl = document.getElementById('scriptTitle');
            const textEl = document.getElementById('scriptText');
            
            if (!categoryEl || !titleEl || !textEl) {
                showAlert('Error: elementos del formulario no encontrados', 'error');
                return;
            }
            
            const category = categoryEl.value.trim();
            const title = titleEl.value.trim();
            const text = textEl.value.trim();
            
            if (!category) {
                showAlert('Por favor selecciona una categor√≠a', 'error');
                categoryEl.focus();
                return;
            }
            
            if (!title) {
                showAlert('Por favor ingresa un t√≠tulo', 'error');
                titleEl.focus();
                return;
            }
            
            if (!text) {
                showAlert('Por favor ingresa el texto del script', 'error');
                textEl.focus();
                return;
            }
            
            const payload = { category, title, text };
            const endpoint = currentEditingId ? `/api/scripts/${currentEditingId}` : '/api/scripts';
            const method = currentEditingId ? 'PUT' : 'POST';
            
            try {
                await apiCall(endpoint, { 
                    method, 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': 'Bearer DPI2025Admin' 
                    }, 
                    body: JSON.stringify(payload) 
                });
                
                const action = currentEditingId ? 'actualizado' : 'creado';
                showAlert(`Script ${action} exitosamente`, 'success');
                
                clearForm();
                await fetchAllData();
                renderAdminList();
                updateAdminStats();
                
            } catch (error) {
                showAlert(`Error al ${currentEditingId ? 'actualizar' : 'crear'} script: ${error.message}`, 'error');
            }
        }

        // ‚úÖ EDICI√ìN
        function editScript(id) {
            let scriptToEdit = null;
            let categoryKey = null;
            
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptToEdit = found;
                    categoryKey = category;
                    break;
                }
            }
            
            if (!scriptToEdit) {
                showAlert('Script no encontrado', 'error');
                return;
            }
            
            currentEditingId = id;
            
            const formTitle = document.getElementById('formTitle');
            const categorySelect = document.getElementById('scriptCategory');
            const titleInput = document.getElementById('scriptTitle');
            const textArea = document.getElementById('scriptText');
            
            if (formTitle) formTitle.textContent = `‚úèÔ∏è Editando: ${scriptToEdit.title}`;
            if (categorySelect) categorySelect.value = categoryKey;
            if (titleInput) titleInput.value = scriptToEdit.title;
            if (textArea) textArea.value = scriptToEdit.text;
            
            if (formTitle) {
                formTitle.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ‚úÖ ELIMINACI√ìN
        async function deleteScript(id) {
            let scriptTitle = `ID ${id}`;
            for (const category in SCRIPTS_DATA) {
                const found = SCRIPTS_DATA[category].find(s => s.id === id);
                if (found) {
                    scriptTitle = found.title;
                    break;
                }
            }
            
            if (!confirm(`¬øEst√°s seguro de que quieres eliminar el script "${scriptTitle}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                return;
            }
            
            try {
                await apiCall(`/api/scripts/${id}`, { 
                    method: 'DELETE', 
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                showAlert('Script eliminado exitosamente', 'success');
                await fetchAllData();
                renderAdminList();
                updateAdminStats();
                
            } catch (error) {
                showAlert(`Error al eliminar script: ${error.message}`, 'error');
            }
        }

        // ‚úÖ LIMPIAR FORMULARIO
        function clearForm() {
            currentEditingId = null;
            
            const form = document.getElementById('scriptForm');
            const formTitle = document.getElementById('formTitle');
            
            if (form) form.reset();
            if (formTitle) formTitle.textContent = '‚ûï Agregar Script';
            
            const alertContainer = document.getElementById('alertContainer');
            if (alertContainer) {
                alertContainer.innerHTML = '';
            }
        }

        // ‚úÖ ANALYTICS
        async function loadAnalyticsDashboard() {
            const container = document.getElementById('analyticsContainer');
            if (!container) return;
            
            container.innerHTML = '<div class="loading">Cargando analytics...</div>';
            
            try {
                const data = await apiCall('/api/analytics', { 
                    headers: { 'Authorization': 'Bearer DPI2025Admin' } 
                });
                
                let html = '<div style="display: grid; gap: 20px;">';
                
                html += '<div><h4>üèÜ Scripts M√°s Usados (30 d√≠as)</h4>';
                if (data.topScripts && data.topScripts.length > 0) {
                    data.topScripts.forEach((script, index) => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <span>${index + 1}. ${script.title}</span>
                                <strong>${script.uses_30_days} usos</strong>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="color: #7f8c8d; font-style: italic;">No hay datos disponibles</div>';
                }
                html += '</div>';
                
                html += '<div><h4>üìä Uso por Categor√≠a (30 d√≠as)</h4>';
                if (data.categoryStats && data.categoryStats.length > 0) {
                    const categoryNames = {
                        bienvenida: "üí¨ Bienvenida", 
                        calificacion: "üîç Calificaci√≥n", 
                        objeciones: "üõ°Ô∏è Objeciones", 
                        seguimiento: "üìû Seguimiento", 
                        cierre: "üéØ Cierre"
                    };
                    
                    data.categoryStats.forEach(stat => {
                        html += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <span>${categoryNames[stat.category] || stat.category}</span>
                                <strong>${stat.usage_count} usos</strong>
                            </div>
                        `;
                    });
                } else {
                    html += '<div style="color: #7f8c8d; font-style: italic;">No hay datos disponibles</div>';
                }
                html += '</div></div>';
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `
                    <div class="error-message">
                        ‚ùå Error al cargar analytics: ${error.message}
                        <br><br>
                        <button onclick="loadAnalyticsDashboard()" class="copy-btn">üîÑ Reintentar</button>
                    </div>
                `;
            }
        }

        // ‚úÖ ESTAD√çSTICAS ADMIN
        function updateAdminStats() {
            const statsBar = document.getElementById('statsBar');
            if (!statsBar) return;
            
            const totalScripts = SCRIPTS_DATA ? 
                Object.values(SCRIPTS_DATA).reduce((sum, category) => 
                    sum + (Array.isArray(category) ? category.length : 0), 0
                ) : 0;
            
            const lastUpdate = new Date().toLocaleTimeString();
            
            statsBar.innerHTML = `
                <div class="stats-item">
                    <span class="stats-number">${totalScripts}</span>
                    <span class="stats-label">Scripts Totales</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">${Object.keys(SCRIPTS_DATA).length}</span>
                    <span class="stats-label">Categor√≠as</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">${lastUpdate}</span>
                    <span class="stats-label">√öltima Actualizaci√≥n</span>
                </div>
                <div class="stats-item">
                    <span class="stats-number">‚úÖ</span>
                    <span class="stats-label">Estado Sistema</span>
                </div>
            `;
        }

        // ‚úÖ INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Iniciando DPI Sistema de Ventas...');
            console.log('üåê API Base URL:', API_BASE_URL || 'Modo Local');
            
            // Verificar elementos cr√≠ticos
            const authOverlay = document.getElementById('authOverlay');
            const authForm = document.getElementById('authForm');
            const adminModeBtn = document.getElementById('adminModeBtn');
            
            console.log('Elementos encontrados:');
            console.log('- Modal auth:', authOverlay ? '‚úÖ' : '‚ùå');
            console.log('- Formulario auth:', authForm ? '‚úÖ' : '‚ùå');
            console.log('- Bot√≥n admin:', adminModeBtn ? '‚úÖ' : '‚ùå');
            
            if (!authOverlay || !authForm) {
                console.error('‚ùå CR√çTICO: Elementos de autenticaci√≥n no encontrados');
                showAlert('‚ùå Error cr√≠tico: Sistema de autenticaci√≥n no disponible', 'error');
            }
            
            // Configurar formulario de autenticaci√≥n
            if (authForm) {
                authForm.addEventListener('submit', handleAuth);
                console.log('‚úÖ Event listener de autenticaci√≥n configurado');
            }
            
            // Test del bot√≥n admin
            if (adminModeBtn) {
                adminModeBtn.addEventListener('click', () => {
                    console.log('üîß Click en bot√≥n admin detectado');
                    switchMode('admin');
                });
                console.log('‚úÖ Event listener del bot√≥n admin configurado');
            }
            
            // Configurar b√∫squeda con debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    if (debounceTimer) {
                        clearTimeout(debounceTimer);
                    }
                    
                    debounceTimer = setTimeout(() => {
                        const query = e.target.value.trim();
                        const searchResults = document.getElementById('searchResults');
                        
                        if (query.length > 1) {
                            performSearch(query);
                        } else {
                            if (searchResults) {
                                searchResults.classList.remove('active');
                            }
                        }
                    }, 300);
                });
            }

            // Cerrar b√∫squeda al hacer click fuera
            document.addEventListener('click', (e) => {
                const searchBox = e.target.closest('.search-box');
                if (!searchBox) {
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) {
                        searchResults.classList.remove('active');
                    }
                }
            });

            // Agregar listener para formulario de clientes
            const clienteForm = document.getElementById('clienteForm');
            if (clienteForm) {
                clienteForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const clienteData = {
                        nombre: document.getElementById('clienteNombre').value.trim(),
                        tipo: document.getElementById('clienteTipo').value,
                        contacto: document.getElementById('clienteContacto').value.trim(),
                        telefono: document.getElementById('clienteTelefono').value.trim(),
                        caracteristicas: document.getElementById('clienteCaracteristicas').value.trim(),
                        necesidad: document.getElementById('clienteNecesidad').value.trim(),
                        presupuesto: document.getElementById('clientePresupuesto').value,
                        urgencia: document.getElementById('clienteUrgencia').value,
                        proximosPasos: document.getElementById('clienteProximosPasos').value.trim(),
                        vendedor: document.getElementById('clienteVendedor').value.trim(),
                        fecha: document.getElementById('clienteFecha').value
                    };
                    
                    if (!clienteData.nombre || !clienteData.tipo || !clienteData.caracteristicas || !clienteData.necesidad) {
                        showAlert('Por favor completa todos los campos obligatorios', 'error');
                        return;
                    }
                    
                    try {
                        if (!API_BASE_URL) {
                            // Guardar localmente si no hay servidor
                            if (currentEditingClienteId) {
                                const index = CLIENTES_POTENCIALES.findIndex(c => c.id === currentEditingClienteId);
                                if (index !== -1) {
                                    CLIENTES_POTENCIALES[index] = { ...clienteData, id: currentEditingClienteId };
                                }
                                showAlert('Perfil actualizado exitosamente (guardado localmente)', 'success');
                            } else {
                                const nuevoPerfil = { ...clienteData, id: Date.now() };
                                CLIENTES_POTENCIALES.push(nuevoPerfil);
                                showAlert('Perfil de cliente ideal agregado exitosamente (guardado localmente)', 'success');
                            }
                            guardarEnLocal();
                            await cargarClientesPotenciales();
                            cerrarFormularioCliente();
                            return;
                        }
                        
                        // Usar servidor si est√° disponible
                        if (currentEditingClienteId) {
                            await apiCall(`/api/clientes-potenciales/${currentEditingClienteId}`, { 
                                method: 'PUT', 
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer DPI2025Admin' 
                                },
                                body: JSON.stringify(clienteData) 
                            });
                            showAlert('Perfil actualizado exitosamente', 'success');
                        } else {
                            await apiCall('/api/clientes-potenciales', { 
                                method: 'POST', 
                                headers: { 
                                    'Content-Type': 'application/json',
                                    'Authorization': 'Bearer DPI2025Admin' 
                                },
                                body: JSON.stringify(clienteData) 
                            });
                            showAlert('Perfil de cliente ideal agregado exitosamente', 'success');
                        }
                        
                        await cargarClientesPotenciales();
                        cerrarFormularioCliente();
                        
                    } catch (error) {
                        showAlert(`Error al guardar perfil: ${error.message}`, 'error');
                    }
                });
            }
            
            // Cargar datos iniciales
            fetchAllData();
            cargarClientesPotenciales();
            
            // Mostrar modo de almacenamiento
            if (!API_BASE_URL) {
                showAlert('üíæ Modo local activado. Los datos se guardan en tu navegador.', 'success');
            } else {
                showAlert('üåê Modo servidor activado. Los datos se sincronizan autom√°ticamente.', 'success');
            }
            
            // Configurar monitoreo de conexi√≥n
            connectionInterval = setInterval(() => {
                updateConnectionStatus(navigator.onLine);
            }, 10000);
            
            window.addEventListener('online', () => updateConnectionStatus(true));
            window.addEventListener('offline', () => updateConnectionStatus(false));
            
            console.log('‚úÖ Sistema inicializado correctamente');
            
            // Test inmediato de funciones cr√≠ticas
            setTimeout(() => {
                console.log('üß™ Ejecutando test de funciones...');
                
                // Test: verificar que las funciones existen
                const funciones = ['switchMode', 'showAuthModal', 'handleAuth'];
                funciones.forEach(fn => {
                    console.log(`- ${fn}:`, typeof window[fn] === 'function' ? '‚úÖ' : '‚ùå');
                });
                
                // Test: verificar elementos DOM
                const elementos = ['authOverlay', 'authForm', 'adminModeBtn', 'ventasModeBtn'];
                elementos.forEach(el => {
                    const elem = document.getElementById(el);
                    console.log(`- #${el}:`, elem ? '‚úÖ' : '‚ùå');
                });
            }, 1000);
        });

        // ‚úÖ LIMPIEZA AL CERRAR
        window.addEventListener('beforeunload', () => {
            if (connectionInterval) {
                clearInterval(connectionInterval);
            }
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }
            if (window.searchController) {
                window.searchController.abort();
            }
        });
    </script>
</body>
</html>
